<template><h1 id="ç”Ÿäº§è®¾ç½®" tabindex="-1"><a class="header-anchor" href="#ç”Ÿäº§è®¾ç½®" aria-hidden="true">#</a> ç”Ÿäº§è®¾ç½®</h1>
<p>å¦‚æœæ‚¨æƒ³å¼€å§‹ä½¿ç”¨ Vue Storefront å¼€å‘ç«™ç‚¹ï¼Œæ‚¨åº”è¯¥ä»<a href="https://docs.vuestorefront.io/v1/guide/installation/linux-mac.html" target="_blank" rel="noopener noreferrer">å®‰è£…æŒ‡å—<OutboundLink/></a>å¼€å§‹ã€‚å‡ºäºå¼€å‘ç›®çš„ï¼Œæ‚¨å¯èƒ½ä¼šä½¿ç”¨è¯¥<code>yarn install</code>åºåˆ—ï¼Œå®ƒå°†ä½¿ç”¨è‡ªåŠ¨å®‰è£…ç¨‹åºåœ¨æœ¬åœ°è®¾ç½® Vue Storefrontï¼Œå¹¶å‡†å¤‡å¥½ Docker æ˜ åƒä»¥è·å¾— Elasticsearch å’Œ Redis æ”¯æŒã€‚</p>
<p>å¼€å‘æ¨¡å¼æ„å‘³ç€æ‚¨ä½¿ç”¨åŸºäº node.js çš„æœåŠ¡å™¨ä½œä¸º HTTP æœåŠ¡å¹¶åœ¨<code>3000</code>TCP ç«¯å£ä¸Šè¿è¡Œåº”ç”¨ç¨‹åºã€‚ç”±äºå®ƒéå¸¸é€‚åˆæœ¬åœ°æµ‹è¯•ï¼Œå› æ­¤ä¸å»ºè®®åœ¨ç”Ÿäº§é…ç½®ä¸­ä½¿ç”¨å®‰è£…ç¨‹åºå’Œç›´æ¥ç”¨æˆ·è®¿é—® node.jsã€‚</p>
<h2 id="ç”Ÿäº§è®¾ç½®-è£¸-vps" tabindex="-1"><a class="header-anchor" href="#ç”Ÿäº§è®¾ç½®-è£¸-vps" aria-hidden="true">#</a> <a href="https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#production-setup-bare-vps" target="_blank" rel="noopener noreferrer">#<OutboundLink/></a>ç”Ÿäº§è®¾ç½®ï¼šè£¸ VPS</h2>
<p>è¦åœ¨æ²¡æœ‰ Docker/Kubernetes çš„ç”Ÿäº§æ¨¡å¼ä¸‹è¿è¡Œ Vue Storefrontï¼Œæ‚¨éœ€è¦å…·æœ‰<code>root</code>è®¿é—®æƒé™çš„è™šæ‹Ÿä¸“ç”¨æœåŠ¡å™¨ï¼ˆç”¨äºè®¾ç½®ç›®çš„ï¼‰ã€‚æˆ‘ä»¬å‡è®¾æ‚¨<code>Debian GNU Linux</code>åœ¨ä»¥ä¸‹æ­¥éª¤ä¸­ä½¿ç”¨ã€‚</p>
<p>æœ¬æ•™ç¨‹å…¶ä½™éƒ¨åˆ†çš„å‡è®¾ï¼š</p>
<ul>
<li>æ‚¨æ‹¥æœ‰ Debian Linux æœºå™¨çš„ root è®¿é—®æƒé™ã€‚</li>
<li>æˆ‘ä»¬å°†ä½¿ç”¨é»˜è®¤çš„æœ¬åœ°ç«¯å£<code>3000</code>ä¸º<a href="https://github.com/vuestorefront/vue-storefront" target="_blank" rel="noopener noreferrer"><code>vue-storefront</code> ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰<OutboundLink/></a>å¹¶<code>8080</code>ä¸º<a href="https://github.com/vuestorefront/vue-storefront-api" target="_blank" rel="noopener noreferrer"><code>vue-storefront-api</code> ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰<OutboundLink/></a>; ç«¯å£<strong>ä¸åº”æš´éœ²</strong>ï¼Œå› ä¸ºå®ƒä»¬å°†éšè—åœ¨<strong>NGINX ä»£ç†ä¹‹å</strong>ã€‚</li>
<li>æˆ‘ä»¬ä½¿ç”¨<strong>prod.vuestorefront.io</strong>ä½œä¸ºåŸŸåã€‚è¯·å°†å…¶æ›¿æ¢ä¸ºæ‚¨çš„ä¸»æœº URL åœ°å€ã€‚</li>
<li>æˆ‘ä»¬å‡è®¾æ‚¨æ‹¥æœ‰<strong>prod.vuestorefront.io</strong>ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥æ˜¯æ‚¨çš„åŸŸï¼‰çš„ SSL è¯ä¹¦ã€‚PWA å’Œ Service Workers éœ€è¦ SSL åŠ å¯†ã€‚</li>
</ul>
<p>é€šç”¨æ–¹æ¡ˆæ¶æ„ï¼š <em>USER -&gt; NGINX ä»£ç† -&gt; vue-storefront / vue-storefront-api</em></p>
<p>æˆ‘ä»¬å°†éšè—NGINX ä»£ç†èƒŒåçš„<code>vue-storefront</code>å’Œ<code>vue-storefront-api</code>æœåŠ¡ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ NGINX æ¥ç¼“å­˜ä»£ç†ï¼Œä½†åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå®ƒåªä¼šè½¬å‘æ²¡æœ‰ç¼“å­˜çš„è¯·æ±‚ï¼ˆå› ä¸º VS éå¸¸å¿«å¹¶ä¸”ä¸éœ€è¦ç¼“å­˜ï¼‰ã€‚æˆ‘ä»¬ä½¿ç”¨çš„ä¸»è¦åŠŸèƒ½æ˜¯ï¼šSSL åŠ å¯†ã€gzip ç¼–ç å’Œ URL è·¯ç”±ï¼ˆåœ¨ä¸€ä¸ªåŸŸä¸‹åˆå¹¶<code>vue-storefront</code>å’Œ<code>vue-storefront-api</code>æœåŠ¡ï¼‰ã€‚</p>
<h3 id="å…ˆå†³æ¡ä»¶" tabindex="-1"><a class="header-anchor" href="#å…ˆå†³æ¡ä»¶" aria-hidden="true">#</a> <a href="https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#prerequisites" target="_blank" rel="noopener noreferrer">#<OutboundLink/></a>å…ˆå†³æ¡ä»¶</h3>
<p>ç¬”è®°</p>
<p>æœ¬æŒ‡å—åœ¨<em>Ubuntu 18.04</em>å’Œå…¶ä»–ä¸»è¦å‘è¡Œç‰ˆä¸Šè¿›è¡Œäº†æµ‹è¯•ã€‚è¯¥åˆ—è¡¨å°†ä¸æ–­æ›´æ–°ã€‚</p>
<p>Vue Storefront éœ€è¦å®‰è£…<strong>Elasticsearch</strong>å’Œ<strong>Redis æœåŠ¡å™¨</strong>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼Œè¿™ä¸¤ä¸ªä¾èµ–é¡¹éƒ½éš<code>docker-compose.yml</code>Docker é•œåƒä¸€èµ·æä¾›ã€‚ä½†æ˜¯ï¼Œå‡ºäºç”Ÿäº§ç›®çš„ï¼Œæˆ‘ä»¬å»ºè®®æœ¬åœ°å®‰è£…æœåŠ¡å™¨ã€‚</p>
<p>å‡ºäºæœ¬æ•™ç¨‹çš„ç›®çš„ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸ Debian æ“ä½œç³»ç»Ÿä¸€èµ·åˆ†å‘çš„é»˜è®¤åŒ…ï¼Œæ²¡æœ‰ä»»ä½•å®‰å…¨åŠ å›ºã€é…ç½®åŠ å›ºæ“ä½œã€‚</p>
<p><strong>è¯·ç¡®ä¿</strong>æ‚¨çš„å®‰å…¨/å¼€å‘è¿è¥å›¢é˜Ÿå·²æŸ¥çœ‹æ‚¨æ­£åœ¨ä½¿ç”¨çš„é…ç½®ï¼Œå¹¶åœ¨å…¬å¼€å‘å¸ƒæ‚¨çš„åº”ç”¨ç¨‹åºä¹‹å‰å¼ºåŒ–æœåŠ¡å™¨é…ç½®ï¼</p>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ›å»ºç”¨æˆ·ï¼ˆä½œä¸º root ç”¨æˆ·ï¼‰ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token function">mkdir</span> /home/www
<span class="token function">useradd</span> -m -d /home/www/vuestorefront vuestorefront
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ç„¶åå®‰è£… Elasticsearch å’Œ Redisï¼ˆä»¥ root ç”¨æˆ·èº«ä»½ï¼‰ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token function">apt-get</span> update
<span class="token function">apt-get</span> <span class="token function">install</span> <span class="token function">curl</span>
<span class="token function">apt-get</span> <span class="token function">install</span> <span class="token function">git</span>

<span class="token function">curl</span> -sL https://deb.nodesource.com/setup_10.x <span class="token operator">|</span> <span class="token function">bash</span> -
<span class="token function">apt-get</span> <span class="token function">install</span> -y nodejs
<span class="token function">npm</span> <span class="token function">install</span> -g <span class="token function">yarn</span>

<span class="token function">apt-get</span> <span class="token function">install</span> redis-server

<span class="token function">apt-get</span> <span class="token function">install</span> openjdk-8-jre
<span class="token function">curl</span> -L -O https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.6.16.deb
dpkg -i elasticsearch-5.6.16.deb
/etc/init.d/elasticsearch start

<span class="token function">apt-get</span> <span class="token function">install</span> imagemagick
<span class="token function">apt-get</span> <span class="token function">install</span> nginx
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="nginx" tabindex="-1"><a class="header-anchor" href="#nginx" aria-hidden="true">#</a> <a href="https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#nginx" target="_blank" rel="noopener noreferrer">#<OutboundLink/></a>nginx</h3>
<p>æˆ‘ä»¬å†³å®šä½¿ç”¨<strong>NGINX</strong>ä½œä¸º HTTP ä»£ç†ï¼Œæš´éœ²åœ¨ç”¨æˆ·é¢å‰ï¼Œå¤„ç†ç½‘ç»œæµé‡ï¼Œå¹¶ä½œä¸ºåç«¯å¤„ç†åº”ç”¨ç¨‹åº<code>vue-storefront</code>å’Œ<code>vue-storefront-api</code>åº”ç”¨ç¨‹åºã€‚</p>
<p>è¿™æ˜¯è®¾ç½®ç”Ÿäº§ node.js åº”ç”¨ç¨‹åºçš„ä¸€èˆ¬è§„åˆ™ï¼Œå®ƒåœ¨ SSLã€gzip å‹ç¼©ã€URL è·¯ç”±å’Œå…¶ä»–é…ç½®æŠ€æœ¯æ–¹é¢ä¸ºæ‚¨æä¾›äº†å¾ˆå¤§çš„çµæ´»æ€§ï¼Œè€Œæ— éœ€é¢å¤–éº»çƒ¦ã€‚ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»»ä½•å…¶ä»–ä»£ç†æœåŠ¡å™¨ï¼Œä¾‹å¦‚ Varnish æˆ– Apache2 + mod_proxyã€‚</p>
<p>ä¸€äº›é¢å¤–çš„ææ–™ï¼š</p>
<ul>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-node-js-application-for-production-on-ubuntu-16-04" target="_blank" rel="noopener noreferrer">å¦‚ä½•åœ¨ Digital Ocean ç¯å¢ƒ (Ubuntu 16) ä¸­è®¾ç½®ç”Ÿäº§ Node.js åº”ç”¨ç¨‹åºï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰<OutboundLink/></a></li>
<li><a href="https://docs.nginx.com/nginx/admin-guide/web-server/reverse-proxy/" target="_blank" rel="noopener noreferrer">å¦‚ä½•è®¾ç½® NGINX åå‘ä»£ç†ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰<OutboundLink/></a></li>
</ul>
<h4 id="nginx-é…ç½®" tabindex="-1"><a class="header-anchor" href="#nginx-é…ç½®" aria-hidden="true">#</a> <a href="https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#nginx-configuration" target="_blank" rel="noopener noreferrer">#<OutboundLink/></a>NGINX é…ç½®</h4>
<p>å¯é€‰çš„</p>
<p>å¦‚æœæ‚¨å·²ç»åœ¨è‡ªå·±çš„åŸŸä¸Šè®¾ç½®äº† SSLï¼Œè¯·è·³åˆ°<a href="https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#now-you-can-run-the-nginx-with-ssl-applied" target="_blank" rel="noopener noreferrer">ä¸‹ä¸€æ­¥<OutboundLink/></a>ã€‚</p>
<p>ä»æ¨¡æ¿åˆ›å»º NGINX é…ç½®æ–‡ä»¶ï¼ˆè¯·ä»¥ root ç”¨æˆ·èº«ä»½è¿è¡Œï¼‰ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token function">curl</span> https://raw.githubusercontent.com/DivanteLtd/vue-storefront/develop/docs/guide/installation/prod.vuestorefront.io <span class="token operator">></span> /etc/nginx/sites-available/prod.vuestorefront.io
<span class="token function">ln</span> -s /etc/nginx/sites-available/prod.vuestorefront.io /etc/nginx/sites-enabled/prod.vuestorefront.io
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>æ‚¨éœ€è¦å°†åˆšåˆšä¸‹è½½çš„ä¸¤è¡Œé…ç½®æ›¿æ¢ä¸ºè¯ä¹¦æ–‡ä»¶çš„å®é™…è·¯å¾„åŠå…¶å¯†é’¥ã€‚</p>
<p><strong>å®‰è£… SSL è¯ä¹¦</strong></p>
<p>æ ¹æ®å…¶è§„èŒƒï¼ŒSSL å®‰å…¨è¿æ¥æ˜¯PWA å’ŒæœåŠ¡å·¥ä½œè€…çš„<em><strong>å¿…å¤‡æ¡ä»¶</strong></em>ã€‚</p>
<p>åœ¨æœ¬æŒ‡å—ä¸­ï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å…è´¹çš„<em><strong>Let's Enrypt</strong></em>æœåŠ¡æ¥è·å– SSL è¯ä¹¦ã€‚ä¸ºäº†ä½¿ç”¨<em><strong>Let's Encrypt</strong></em>ï¼Œæ‚¨éœ€è¦å®‰è£…<code>certbot</code>ï¼ŒæŒ‡å—åœ¨<a href="https://certbot.eff.org/lets-encrypt/ubuntubionic-nginx" target="_blank" rel="noopener noreferrer">è¿™é‡Œ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰<OutboundLink/></a>.</p>
<p>ç¬”è®°</p>
<p>å¯ä»¥è‚¯å®šçš„æ˜¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æœ€é€‚åˆæ‚¨éœ€è¦çš„ä»»ä½•å…¶ä»– SSL æœåŠ¡æä¾›å•†ã€‚ä¸è¿‡å¤§éƒ¨åˆ†æ—¶é—´éƒ½ä¸æ˜¯å…è´¹çš„ã€‚</p>
<p>ä¸€æ—¦<code>certbot</code>å®‰è£…å®Œæˆåï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥è·å–è¯ä¹¦ä¿¡æ¯ã€‚</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>certbot certificates
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>ç»“æœå¦‚ä¸‹ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>Saving debug log to /var/log/letsencrypt/letsencrypt.log

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Found the following certs:
  Certificate Name: prod.vuestorefront.io
    Domains: prod.vuestorefront.io
    Expiry Date: <span class="token number">2020</span>-04-19 <span class="token number">22</span>:47:19+00:00 <span class="token punctuation">(</span>VALID: <span class="token number">89</span> days<span class="token punctuation">)</span>
    Certificate Path: /etc/letsencrypt/live/prod.vuestorefront.io/fullchain.pem
    Private Key Path: /etc/letsencrypt/live/prod.vuestorefront.io/privkey.pem
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>ç”¨<code>/etc/nginx/sites-available/prod.vuestorefront.io</code>ä¸Šé¢çš„ä¿¡æ¯æ›¿æ¢è¯ä¹¦åŠå…¶å¯†é’¥çš„è·¯å¾„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token comment"># ... abridged</span>

  ssl on<span class="token punctuation">;</span>

  ssl_certificate /etc/letsencrypt/live/prod.vuestorefront.io/fullchain.pem<span class="token punctuation">;</span>
  ssl_certificate_key /etc/letsencrypt/live/prod.vuestorefront.io/privkey.pem<span class="token punctuation">;</span>

  ssl_protocols TLSv1 TLSv1.1 TLSv1.2<span class="token punctuation">;</span>

<span class="token comment"># abridged ...</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>ç¬”è®°</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>server <span class="token punctuation">{</span>
  listen <span class="token number">80</span><span class="token punctuation">;</span>
  server_name prod.vuestorefront.io<span class="token punctuation">;</span> 
  <span class="token builtin class-name">return</span> <span class="token number">301</span> https://prod.vuestorefront.io<span class="token variable">$request_uri</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>æœ¬èŠ‚è¿è¡Œæ ‡å‡†<code>http://prod.vuestorefront.io</code>å¹¶ä»<code>http://prod.vuestorefront.io/*</code>-&gt;åˆ›å»ºé€šé…ç¬¦é‡å®šå‘<code>https://prod.vuestorefront.io/*</code>ã€‚</p>
<h4 id="ç°åœ¨ä½ å¯ä»¥åœ¨åº”ç”¨äº†-ssl-çš„æƒ…å†µä¸‹è¿è¡Œ-nginx" tabindex="-1"><a class="header-anchor" href="#ç°åœ¨ä½ å¯ä»¥åœ¨åº”ç”¨äº†-ssl-çš„æƒ…å†µä¸‹è¿è¡Œ-nginx" aria-hidden="true">#</a> <a href="https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#now-you-can-run-the-nginx-with-ssl-applied" target="_blank" rel="noopener noreferrer">#<OutboundLink/></a>ç°åœ¨ä½ å¯ä»¥åœ¨åº”ç”¨äº† SSL çš„æƒ…å†µä¸‹è¿è¡Œ NGINXï¼š</h4>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>/etc/init.d/nginx restart
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>æç¤º</p>
<p>ä¹‹åä½ å®‰è£…ï¼Œå†æ¬¡å¼€åš<code>/etc/nginx/sites-available/prod.vuestorefront.io</code>ï¼Œå¹¶æ·»åŠ <code>http2</code>åçš„<code>listen 443 ssl</code>ï¼ˆä½†ä¹‹å‰åˆ†å·ï¼ï¼‰ã€‚å®ƒåº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>server {
    listen 443 ssl http2;
    server_name prod.vuestorefront.io;

	ssl on;
	(...the rest of the config...)
}
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><code>http2</code>ä¸æ˜¯å¿…éœ€çš„ï¼Œä½†å¯ä»¥ä¼˜åŒ–æ”¯æŒå®ƒçš„æµè§ˆå™¨çš„ä½“éªŒã€‚å¯ä»¥åœ¨<a href="https://developers.google.com/web/fundamentals/performance/http2/" target="_blank" rel="noopener noreferrer">æ­¤å¤„<OutboundLink/></a>æ‰¾åˆ°æœ‰å…³ http/2 çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯<a href="https://developers.google.com/web/fundamentals/performance/http2/" target="_blank" rel="noopener noreferrer">ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰<OutboundLink/></a></p>
<h4 id="å…³äºæä¾›çš„-nginx-é…ç½®çš„ä¸€äº›è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#å…³äºæä¾›çš„-nginx-é…ç½®çš„ä¸€äº›è¯´æ˜" aria-hidden="true">#</a> <a href="https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#some-notes-on-the-provided-nginx-config" target="_blank" rel="noopener noreferrer">#<OutboundLink/></a>å…³äºæä¾›çš„ nginx é…ç½®çš„ä¸€äº›è¯´æ˜</h4>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ ¹æ®è¿‡å»çš„æœ€ä½³ç»éªŒä½¿ç”¨ SSL è®¾ç½®ã€‚è¯·é˜…è¯»<a href="http://nginx.org/en/docs/http/configuring_https_servers.html" target="_blank" rel="noopener noreferrer">NGINX æ–‡æ¡£ä¸­çš„<OutboundLink/></a>è¯¦ç»†ä¿¡æ¯ <a href="http://nginx.org/en/docs/http/configuring_https_servers.html" target="_blank" rel="noopener noreferrer"> ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰<OutboundLink/></a>å¦‚æœä½ å–œæ¬¢ğŸ˜‰</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>  gzip on;
  gzip_proxied any;
  gzip_types
  text/css
  text/javascript
  text/xml
  application/javascript
  application/json
  text/json;
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Vue Storefront SSR å“åº”åŒ…å«å®Œæ•´çš„æ ‡è®°å’Œ JSON å¯¹è±¡ï¼Œç”¨äºåŠ å¿«ç¬¬ä¸€ä¸ªé¡µé¢çš„æµè§ˆé€Ÿåº¦ã€‚ä¸å¹¸çš„æ˜¯ï¼Œç”±äº JS åŒ…çš„å¤§å°å¾ˆå¤§ï¼Œå®ƒä¼šäº§ç”Ÿå¤§é‡çš„ç½‘ç»œè´Ÿè½½ã€‚æˆ‘ä»¬æ­£åœ¨é€šè¿‡ä½¿ç”¨ gzip å‹ç¼©æœåŠ¡å™¨ç«¯å¯¹å…¶è¿›è¡Œä¼˜åŒ–ã€‚</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>location / {
  proxy_pass http://localhost:3000/;
}
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ <a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass" target="_blank" rel="noopener noreferrer"><code>proxy_pass</code> ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰<OutboundLink/></a>ä»<code>ngx_http_proxy_module</code>ä¼ é€’æ¥è‡ª Vue Storefront node.js æœåŠ¡å™¨çš„å†…å®¹ã€‚æ ¹æ®é…ç½®ï¼Œå†…å®¹åº”è¯¥åœ¨***https://prod.vuestorefront.io/***ä¸‹å¯ç”¨ã€‚</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>location /assets/ {
  proxy_pass http://localhost:3000/assets/;
}
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>å®ƒä¹Ÿä¸å­ç›®å½•çš„å·¥ä½œæ–¹å¼ç›¸åŒã€‚</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>location /api/ {
  proxy_pass http://localhost:8080/api/;
}
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ä¸‹ä¸€ä¸ªä»£ç†éƒ¨åˆ†ç”¨äºæä¾› APIã€‚è¿™æ˜¯ä¸€ä¸ªä»£ç†<a href="https://github.com/vuestorefront/vue-storefront-api" target="_blank" rel="noopener noreferrer"><code>vue-storefront-api</code> ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰<OutboundLink/></a>åœ¨<code>8080</code>ç«¯å£ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºï¼ˆé»˜è®¤é…ç½®ï¼‰ã€‚API å°†åœ¨<em><strong>https://prod.vuestorefront.io/api</strong></em>ä¸‹å¯ç”¨</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>location /img/ {
  proxy_pass http://localhost:8080/img/;
}
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>æœ€åä¸€ä¸ªä»£ç†ç”¨äºæä¾›äº§å“å›¾åƒã€‚è¿™æ˜¯ä¸€ä¸ªä»£ç†<a href="https://github.com/vuestorefront/vue-storefront-api" target="_blank" rel="noopener noreferrer"><code>vue-storefront-api</code> ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰<OutboundLink/></a>åœ¨<code>8080</code>ç«¯å£ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºï¼ˆé»˜è®¤é…ç½®ï¼‰ã€‚å›¾ç‰‡å°†åœ¨<em><strong>https://prod.vuestorefront.io/img</strong></em>ä¸‹æä¾›</p>
<h4 id="apache2-é…ç½®" tabindex="-1"><a class="header-anchor" href="#apache2-é…ç½®" aria-hidden="true">#</a> <a href="https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#apache2-configuration" target="_blank" rel="noopener noreferrer">#<OutboundLink/></a>Apache2 é…ç½®</h4>
<p>å¦‚æœæ‚¨å·²ç»åœ¨æ‚¨çš„ç¯å¢ƒä¸­ä½¿ç”¨ apache2 Web æœåŠ¡å™¨å¹¶ä¸”ä¸èƒ½ï¼ˆæˆ–ä¸æƒ³ï¼‰ä½¿ç”¨ NGINXï¼Œæ‚¨è¿˜å¯ä»¥å°† apache2 è®¾ç½®ä¸ºåå‘ä»£ç†è€Œä¸æ˜¯ NGINXã€‚è¿™æ˜¯é€šè¿‡å°†æ­¤å—æ·»åŠ åˆ°æ‚¨çš„ apache2 è™šæ‹Ÿä¸»æœºæ¥å®Œæˆçš„ã€‚</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>ProxyRequests off

ProxyPass /api/ http://localhost:8080/api/
ProxyPassReverse /api http://localhost:8080/api/

ProxyPass /img/ http://localhost:8080/img/
ProxyPassReverse /img http://localhost:8080/img/

ProxyPass /assets/ http://localhost:3000/assets/
ProxyPassReverse /assets http://localhost:3000/assets/

ProxyPass / http://localhost:3000/
ProxyPassReverse / http://localhost:3000/
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>æ‚¨è¿˜éœ€è¦å¯ç”¨<a href="https://httpd.apache.org/docs/current/mod/mod_proxy.html" target="_blank" rel="noopener noreferrer">mod_proxy ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰<OutboundLink/></a>ä¸ºäº†è¿™ã€‚</p>
<h3 id="vue-åº—é¢å’Œ-vue-åº—é¢-api" tabindex="-1"><a class="header-anchor" href="#vue-åº—é¢å’Œ-vue-åº—é¢-api" aria-hidden="true">#</a> <a href="https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#vue-storefront-and-vue-storefront-api" target="_blank" rel="noopener noreferrer">#<OutboundLink/></a>Vue åº—é¢å’Œ Vue åº—é¢ API</h3>
<p>è®¾ç½®å¥½ NGINX åï¼Œæ‚¨åº”è¯¥<code>502 error</code>åœ¨è®¿é—® https://prod.vuestorefront.io æ—¶å¾—åˆ°ä¸€ä¸ªã€‚è¿™å®Œå…¨æ²¡é—®é¢˜ï¼æˆ‘ä»¬åˆšåˆšé”™è¿‡äº†æœ€é‡è¦çš„ä¸€æ­¥ï¼Œå³è¿è¡Œåç«¯æœåŠ¡ï¼Œä¸ºæˆ‘ä»¬çš„å®‰è£…æä¾›åŠ¨åŠ›ã€‚ç°åœ¨ NGINX æ­£åœ¨å°è¯•è¿æ¥<code>localhost:3000</code>for<code>vue-storefront</code>å’Œ<code>localhost:8080</code>for ï¼Œ<code>vue-storefront-api</code>ä½†æ²¡æœ‰ä»»ä½•æˆåŠŸã€‚</p>
<p>æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º<code>vuestorefront</code>å¹¶è½¬åˆ°<code>/home/www/vuestorefront</code>æˆ‘ä»¬çš„ä¸»ç›®å½•çš„ Linux ç”¨æˆ·ã€‚</p>
<p>æ‚¨éœ€è¦ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç›¸åº”åœ°å…‹éš†<code>vue-storefront</code>å’Œå­˜å‚¨<code>vue-storefront-api</code>åº“ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token function">su</span> vuestorefront
<span class="token builtin class-name">cd</span> /home/www/vuestorefront
<span class="token function">git</span> clone --single-branch --branch master https://github.com/vuestorefront/vue-storefront.git
<span class="token function">git</span> clone https://github.com/vuestorefront/vue-storefront-api.git
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ç„¶åï¼Œæ‚¨éœ€è¦å®‰è£…æ‰€éœ€çš„èŠ‚ç‚¹åŒ…ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token builtin class-name">cd</span> /home/www/vuestorefront/vue-storefront-api
<span class="token function">yarn</span> <span class="token function">install</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>... å’Œ ...</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token builtin class-name">cd</span> /home/www/vuestorefront/vue-storefront
<span class="token function">yarn</span> <span class="token function">install</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´ã€‚phantomjs ä¾èµ–éœ€è¦å®‰è£… bzip2ã€‚å®‰è£…æ¨¡å—åï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºè¿™ä¸¤ä¸ªæœåŠ¡è®¾ç½®é…ç½®æ–‡ä»¶ã€‚</p>
<h4 id="vueåº—é¢é…ç½®" tabindex="-1"><a class="header-anchor" href="#vueåº—é¢é…ç½®" aria-hidden="true">#</a> <a href="https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#vue-storefront-configuration" target="_blank" rel="noopener noreferrer">#<OutboundLink/></a>Vueåº—é¢é…ç½®</h4>
<p>å®Œæ•´çš„é…ç½®æ–‡ä»¶å¯ä»¥åœ¨è¿™é‡Œä¸‹è½½ï¼š<a href="https://github.com/vuestorefront/vue-storefront/blob/develop/docs/guide/installation/vue-storefront/config" target="_blank" rel="noopener noreferrer">vue-storefront ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰<OutboundLink/></a>å’Œ<a href="https://github.com/vuestorefront/vue-storefront/blob/develop/docs/guide/installation/vue-storefront-api/config" target="_blank" rel="noopener noreferrer">vue-storefront-api ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰<OutboundLink/></a>.</p>
<p>è¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤é€šè¿‡å°† default.json å¤åˆ¶åˆ° local.json æ¥ç›¸åº”åœ°åˆ›å»º<code>vue-storefront-api/config/local.json</code>å’Œ<code>vue-storefront/config/local.json</code>æ–‡ä»¶<code>cp</code>ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token function">cp</span> /home/www/vuestorefront/vue-storefront-api/config/default.json /home/www/vuestorefront/vue-storefront-api/config/local.json
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>...å’Œ ...</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token function">cp</span> /home/www/vuestorefront/vue-storefront/config/default.json /home/www/vuestorefront/vue-storefront/config/local.json
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>è¯·æ‰¾åˆ°<code>vue-storefront/config/local.json</code>ä¸‹é¢æè¿°çš„æ–‡ä»¶çš„å…³é”®éƒ¨åˆ†ï¼š</p>
<div class="language-json ext-json line-numbers-mode"><pre v-pre class="language-json"><code><span class="token property">"elasticsearch"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"httpAuth"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
    <span class="token property">"host"</span><span class="token operator">:</span> <span class="token string">"https://prod.vuestorefront.io/api/catalog"</span><span class="token punctuation">,</span>
    <span class="token property">"index"</span><span class="token operator">:</span> <span class="token string">"vue_storefront_catalog"</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token property">"storeViews"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"mapStoreUrlsFor"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"de"</span><span class="token punctuation">,</span>
        <span class="token string">"it"</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"multistore"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"de"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"elasticsearch"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"httpAuth"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token property">"host"</span><span class="token operator">:</span> <span class="token string">"https://prod.vuestorefront.io/api/catalog"</span><span class="token punctuation">,</span>
            <span class="token property">"index"</span><span class="token operator">:</span> <span class="token string">"vue_storefront_catalog_de"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"it"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"elasticsearch"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"httpAuth"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token property">"host"</span><span class="token operator">:</span> <span class="token string">"https://prod.vuestorefront.io/api/catalog"</span><span class="token punctuation">,</span>
            <span class="token property">"index"</span><span class="token operator">:</span> <span class="token string">"vue_storefront_catalog_it"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>æˆ‘ä»¬æ­£åœ¨å°†äº§å“çš„ç«¯ç‚¹è®¾ç½®ä¸º https://prod.vuestorefront.io/api/catalogï¼ˆå½“ç„¶è¯·ç›¸åº”åœ°ä½¿ç”¨æ‚¨çš„åŸŸï¼‰ã€‚æ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°ï¼Œè¯¥<code>/api</code>url ç”± NGINX ä»£ç†åˆ°<code>localhost:8080</code>- æˆ‘ä»¬çš„<code>vue-storefront-api</code>å®ä¾‹ã€‚</p>
<div class="language-json ext-json line-numbers-mode"><pre v-pre class="language-json"><code><span class="token property">"cart"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"synchronize"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token property">"synchronize_totals"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token property">"create_endpoint"</span><span class="token operator">:</span> <span class="token string">"https://prod.vuestorefront.io/api/cart/create?token={{token}}"</span><span class="token punctuation">,</span>
      <span class="token property">"updateitem_endpoint"</span><span class="token operator">:</span> <span class="token string">"https://prod.vuestorefront.io/api/cart/update?token={{token}}&amp;cartId={{cartId}}"</span><span class="token punctuation">,</span>
      <span class="token property">"deleteitem_endpoint"</span><span class="token operator">:</span> <span class="token string">"https://prod.vuestorefront.io/api/cart/delete?token={{token}}&amp;cartId={{cartId}}"</span><span class="token punctuation">,</span>
      <span class="token property">"pull_endpoint"</span><span class="token operator">:</span> <span class="token string">"https://prod.vuestorefront.io/api/cart/pull?token={{token}}&amp;cartId={{cartId}}"</span><span class="token punctuation">,</span>
      <span class="token property">"totals_endpoint"</span><span class="token operator">:</span> <span class="token string">"https://prod.vuestorefront.io/api/cart/totals?token={{token}}&amp;cartId={{cartId}}"</span><span class="token punctuation">,</span>
      <span class="token property">"paymentmethods_endpoint"</span><span class="token operator">:</span> <span class="token string">"https://prod.vuestorefront.io/api/cart/payment-methods?token={{token}}&amp;cartId={{cartId}}"</span><span class="token punctuation">,</span>
      <span class="token property">"shippingmethods_endpoint"</span><span class="token operator">:</span> <span class="token string">"https://prod.vuestorefront.io/api/cart/shipping-methods?token={{token}}&amp;cartId={{cartId}}"</span><span class="token punctuation">,</span>
      <span class="token property">"shippinginfo_endpoint"</span><span class="token operator">:</span> <span class="token string">"https://prod.vuestorefront.io/api/cart/shipping-information?token={{token}}&amp;cartId={{cartId}}"</span><span class="token punctuation">,</span>
      <span class="token property">"collecttotals_endpoint"</span><span class="token operator">:</span> <span class="token string">"https://prod.vuestorefront.io/api/cart/collect-totals?token={{token}}&amp;cartId={{cartId}}"</span><span class="token punctuation">,</span>
      <span class="token property">"deletecoupon_endpoint"</span><span class="token operator">:</span> <span class="token string">"https://prod.vuestorefront.io/api/cart/delete-coupon?token={{token}}&amp;cartId={{cartId}}"</span><span class="token punctuation">,</span>
      <span class="token property">"applycoupon_endpoint"</span><span class="token operator">:</span> <span class="token string">"https://prod.vuestorefront.io/api/cart/apply-coupon?token={{token}}&amp;cartId={{cartId}}&amp;coupon={{coupon}}"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><code>prod.vuestorefront.io</code>åœ¨æ­¤æ–‡ä»¶ä¸­ï¼Œè¿˜æœ‰ 27 ä¸ªè¦æ›¿æ¢ä¸ºæ‚¨çš„ç”Ÿäº§ URL åœ°å€çš„å®ä¾‹ã€‚è¯·å°±è¿™æ ·å§ğŸ˜ƒ</p>
<p>å¦‚æœæ‚¨æƒ³æŸ¥çœ‹ä¿®æ”¹åçš„ local.json åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­ï¼Œæˆ‘ä»¬å‡†å¤‡çš„é…ç½®<code>prod.vuestorefront.io</code>å¯ä»¥åœ¨ä»¥ä¸‹ä½ç½®æ‰¾åˆ°ï¼š</p>
<p><a href="https://raw.githubusercontent.com/DivanteLtd/vue-storefront/develop/docs/guide/installation/vue-storefront-api/config/local.json" target="_blank" rel="noopener noreferrer">Vueåº—é¢local.jsonï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰<OutboundLink/></a></p>
<p><a href="https://raw.githubusercontent.com/DivanteLtd/vue-storefront/develop/docs/guide/installation/vue-storefront/config/local.json" target="_blank" rel="noopener noreferrer">vue-storefront-api local.jsonï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰<OutboundLink/></a></p>
<h4 id="vue-storefront-api-é…ç½®" tabindex="-1"><a class="header-anchor" href="#vue-storefront-api-é…ç½®" aria-hidden="true">#</a> <a href="https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#vue-storefront-api-configuration" target="_blank" rel="noopener noreferrer">#<OutboundLink/></a>Vue Storefront API é…ç½®</h4>
<p>åœ¨<a href="https://github.com/vuestorefront/vue-storefront/blob/develop/docs/guide/installation/vue-storefront-api/config" target="_blank" rel="noopener noreferrer">æä¾›VUEçš„åº—é¢-APIé…ç½® ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰<OutboundLink/></a>å‡ ä¹ä¸éœ€è¦æ”¹å˜ã€‚</p>
<p>æ‚¨éœ€è¦æ›´æ”¹çš„å”¯ä¸€è¡Œæ˜¯ï¼š</p>
<div class="language-json ext-json line-numbers-mode"><pre v-pre class="language-json"><code><span class="token property">"imageable"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"namespace"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
    <span class="token property">"maxListeners"</span><span class="token operator">:</span> <span class="token number">512</span><span class="token punctuation">,</span>
    <span class="token property">"imageSizeLimit"</span><span class="token operator">:</span> <span class="token number">1024</span><span class="token punctuation">,</span>
    <span class="token property">"timeouts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"convert"</span><span class="token operator">:</span> <span class="token number">5000</span><span class="token punctuation">,</span>
        <span class="token property">"identify"</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
        <span class="token property">"download"</span><span class="token operator">:</span> <span class="token number">1000</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"whitelist"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"allowedHosts"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">".*divante.pl"</span><span class="token punctuation">,</span>
            <span class="token string">".*vuestorefront.io"</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"keepDownloads"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"maxDownloadCacheSize"</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
    <span class="token property">"tmpPathRoot"</span><span class="token operator">:</span> <span class="token string">"/tmp"</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token property">"elasticsearch"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"host"</span><span class="token operator">:</span> <span class="token string">"localhost"</span><span class="token punctuation">,</span>
    <span class="token property">"port"</span><span class="token operator">:</span> <span class="token string">"9200"</span><span class="token punctuation">,</span>
    <span class="token property">"indices"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"vue_storefront_catalog"</span><span class="token punctuation">,</span>
        <span class="token string">"vue_storefront_catalog_it"</span><span class="token punctuation">,</span>
        <span class="token string">"vue_storefront_catalog_de"</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>æ‚¨åº”è¯¥åœ¨æ­¤å¤„<code>allowedHosts</code>æ”¾ç½®<em>å¯æˆåƒ</em>èŠ‚ç‚¹ä»¥ä¸‹è½½äº§å“å›¾åƒã€‚åŸŸåæŒ‡å‘å›¾åƒæ¥æºçš„ Magento 2 å®ä¾‹ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒMagento 2 åœ¨<strong>http://demo-magento2.vuestorefront.io</strong>ä¸‹è¿è¡Œã€‚</p>
<h4 id="ä½¿ç”¨æ‚¨è‡ªå·±çš„-magento-2-å®ä¾‹" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨æ‚¨è‡ªå·±çš„-magento-2-å®ä¾‹" aria-hidden="true">#</a> <a href="https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#using-your-own-magento-2-instance" target="_blank" rel="noopener noreferrer">#<OutboundLink/></a>ä½¿ç”¨æ‚¨è‡ªå·±çš„ Magento 2 å®ä¾‹</h4>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¿…é¡»<code>magento2</code>åœ¨ vue-storefront-api é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨æ­£ç¡®çš„ä¸»æœºåæ›´æ–°é…ç½®èŠ‚ç‚¹ã€‚è¦è·å–<code>api</code>èŠ‚ç‚¹çš„æ‰€æœ‰å¿…è¦ Magento 2 API æ•°æ®ï¼Œè¯·å¯¼èˆªåˆ° Magento 2 ç®¡ç†ä¸­çš„ç³»ç»Ÿ -&gt; æ‰©å±• -&gt; é›†æˆã€‚èŠ‚ç‚¹ï¼Œå¯¼èˆªåˆ° Magento 2 ç®¡ç†ä¸­çš„ç³»ç»Ÿ -&gt; æ‰©å±• -&gt; é›†æˆã€‚</p>
<ul>
<li>å•å‡»æ·»åŠ æ–°é›†æˆ</li>
<li>æ£€æŸ¥å¿…è¦çš„æƒé™ï¼ˆæ£€æŸ¥ API æƒé™é€‰é¡¹å¡ä¸Šçš„ç›®å½•ã€é”€å”®ã€æˆ‘çš„å¸æˆ·å’Œè´­ç‰©è½¦ï¼‰</li>
<li>ç‚¹å‡»æ¿€æ´»</li>
<li>å°†å¿…è¦çš„å¯†é’¥ã€ç§˜å¯†å’Œä»¤ç‰Œå¤åˆ¶åˆ° vue-storefront-api é…ç½®çš„ api éƒ¨åˆ†</li>
</ul>
<h4 id="æ„å»º-vs" tabindex="-1"><a class="header-anchor" href="#æ„å»º-vs" aria-hidden="true">#</a> <a href="https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#build-vs" target="_blank" rel="noopener noreferrer">#<OutboundLink/></a>æ„å»º VS</h4>
<p>åœ¨æˆ‘ä»¬å¯ä»¥è¿è¡Œ Vue Storefront å’Œ Vue Storefront API ä¹‹å‰ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨ç”Ÿäº§æ¨¡å¼ä¸‹æ„å»ºå®ƒã€‚ä¸ºæ­¤ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token builtin class-name">cd</span> /home/www/vuestorefront/vue-storefront/
<span class="token function">yarn</span> build
<span class="token builtin class-name">cd</span> /home/www/vuestorefront/vue-storefront-api/
<span class="token function">yarn</span> build
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="æ•°æ®å¯¼å…¥" tabindex="-1"><a class="header-anchor" href="#æ•°æ®å¯¼å…¥" aria-hidden="true">#</a> <a href="https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#data-import" target="_blank" rel="noopener noreferrer">#<OutboundLink/></a>æ•°æ®å¯¼å…¥</h4>
<p>Vue Storefront éœ€è¦åœ¨ Elasticsearch ä¸­æœ‰ä¸€äº›æ•°æ®æ‰èƒ½æ­£ç¡®æ˜¾ç¤ºäº§å“å’Œç±»åˆ«ã€‚å½“ç„¶ä½ å¯ä»¥å®‰è£…<a href="https://github.com/vuestorefront/mage2vuestorefront" target="_blank" rel="noopener noreferrer">mage2vuestorefront ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰<OutboundLink/></a>å¹¶é…ç½®æ•°æ®æ³µä»¥åœ¨ Magento ä¸­æ›´æ”¹æ•°æ®æ—¶åŒæ­¥å’Œæ›´æ–° Elasticsearch ç´¢å¼•ã€‚å‡ºäºæœ¬æ•™ç¨‹çš„ç›®çš„ï¼Œæˆ‘ä»¬å°†ä»…ä» JSON æ–‡ä»¶ä¸­æ¢å¤æ•°æ®ã€‚</p>
<p>æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼ˆæ‚¨çš„æœ¬åœ°å®‰è£…ï¼‰è½»æ¾è½¬å‚¨å½“å‰çš„ VS ç´¢å¼•ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token builtin class-name">cd</span> vue-storefront-api
<span class="token function">rm</span> var/catalog.json
<span class="token function">yarn</span> dump
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ç°åœ¨ï¼Œ<code>var/catalog.json</code>æ‚¨æ‹¥æœ‰å½“å‰çš„æ•°æ®åº“è½¬å‚¨ã€‚è¯·å°†æ­¤æ–‡ä»¶ä¼ è¾“åˆ°æœåŠ¡å™¨â€”â€”ä¾‹å¦‚ï¼Œä½¿ç”¨ä»¥ä¸‹ ssh å‘½ä»¤ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token function">ssh</span> vuestorefront@prod.vuestorefront.io <span class="token function">rm</span> ~/vue-storefront-api/var/catalog.json
<span class="token function">scp</span> vue-storefront-api/var/catalog.json vuestorefront@prod.vuestorefront.io:~/vue-storefront-api/var/catalog.json
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ç„¶åï¼Œåœ¨ä»¥<code>prod.vuestorefront.io</code>èº«ä»½ç™»å½•åˆ°æ‚¨çš„æœåŠ¡å™¨å<code>vuestorefront</code>ï¼Œæ‚¨å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å¯¼å…¥æ•°æ®ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token builtin class-name">cd</span> vue-storefront-api
<span class="token function">yarn</span> db new
<span class="token function">yarn</span> restore2main
<span class="token function">yarn</span> db rebuild
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="è¿è¡Œ-vue-storefront-å’Œ-vue-storefront-api" tabindex="-1"><a class="header-anchor" href="#è¿è¡Œ-vue-storefront-å’Œ-vue-storefront-api" aria-hidden="true">#</a> <a href="https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#running-the-vue-storefront-and-vue-storefront-api" target="_blank" rel="noopener noreferrer">#<OutboundLink/></a>è¿è¡Œ Vue Storefront å’Œ Vue Storefront API</h4>
<p>ä¸€åˆ‡è®¾ç½®å¥½åï¼Œæ‚¨å°±å¯ä»¥å¯åŠ¨<code>vue-storefront</code>and äº†<code>vue-storefront-api</code>ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token builtin class-name">cd</span> vue-storefront-api
<span class="token function">yarn</span> start
<span class="token builtin class-name">cd</span> vue-storefront
<span class="token function">yarn</span> start
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ä¸¤ä¸ªåº”ç”¨ç¨‹åºéƒ½ä½¿ç”¨<a href="https://pm2.keymetrics.io/docs/usage/process-management/" target="_blank" rel="noopener noreferrer"><code>PM2</code>è¿›ç¨‹ç®¡ç†å™¨ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰<OutboundLink/></a>åœ¨ç”Ÿäº§æ¨¡å¼ï¼ˆ<code>start</code>å‘½ä»¤ï¼‰ä¸­åœ¨éœ€è¦æ—¶ç®¡ç†å’Œé‡æ–°ç”Ÿæˆ node.js è¿›ç¨‹ã€‚</p>
<h2 id="ç¼“å­˜ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜ç­–ç•¥" aria-hidden="true">#</a> <a href="https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#cache-strategies" target="_blank" rel="noopener noreferrer">#<OutboundLink/></a>ç¼“å­˜ç­–ç•¥</h2>
<h3 id="vsf-çš„æ¸…æ¼†ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#vsf-çš„æ¸…æ¼†ç¼“å­˜" aria-hidden="true">#</a> <a href="https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#varnish-cache-for-vsf" target="_blank" rel="noopener noreferrer">#<OutboundLink/></a>VSF çš„æ¸…æ¼†ç¼“å­˜</h3>
<p><em>Vue Storefront</em>æœ‰å¤šå±‚ç¼“å­˜ï¼Œæœ€å‰é¢çš„ç¼“å­˜æ˜¯<em>Varnish</em>ï¼Œä¸€æ—¦è¯·æ±‚è¢«ç‚¹å‡»ï¼Œå®ƒå°±ä¼šåƒé™æ€ HTML é¡µé¢ä¸€æ ·å¿«é€Ÿåœ°å¤„ç†è¯·æ±‚ã€‚ä½ å¯ä»¥ä»<a href="https://github.com/new-fantastic/vsf-cache-varnish" target="_blank" rel="noopener noreferrer">è¿™é‡Œ<OutboundLink/></a>å®‰è£…å®ƒ<a href="https://github.com/new-fantastic/vsf-cache-varnish" target="_blank" rel="noopener noreferrer"> ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰<OutboundLink/></a>.</p>
<h3 id="vue-åº—é¢ä»£ç†" tabindex="-1"><a class="header-anchor" href="#vue-åº—é¢ä»£ç†" aria-hidden="true">#</a> <a href="https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#vue-storefront-proxy" target="_blank" rel="noopener noreferrer">#<OutboundLink/></a>Vue åº—é¢ä»£ç†</h3>
<p><em>Vue Storefront</em>å¯ä»¥ä½¿ç”¨<a href="http://openresty.org/en/" target="_blank" rel="noopener noreferrer">OpenResty<OutboundLink/></a>è¿›è¡Œè®¾ç½®<a href="http://openresty.org/en/" target="_blank" rel="noopener noreferrer"> ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰<OutboundLink/></a>åŸºäºåå‘ä»£ç†ä» Redis æä¾›ç¼“å­˜é¡µé¢ï¼Œæ— éœ€ Vue StoreFrontï¼ˆVSF æˆ– VSF APIï¼‰è°ƒç”¨ï¼Œä½¿ç”¨ LUAã€‚<a href="https://github.com/ClickAndMortar/docker/tree/master/vue-storefront/proxy" target="_blank" rel="noopener noreferrer">è¿™é‡Œ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰<OutboundLink/></a>æ˜¯ github ä»“åº“ã€‚</p>
<h2 id="ç”Ÿäº§è®¾ç½®-ä½¿ç”¨-docker-kubernetes" tabindex="-1"><a class="header-anchor" href="#ç”Ÿäº§è®¾ç½®-ä½¿ç”¨-docker-kubernetes" aria-hidden="true">#</a> <a href="https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#production-setup-using-docker-kubernetes" target="_blank" rel="noopener noreferrer">#<OutboundLink/></a>ç”Ÿäº§è®¾ç½® - ä½¿ç”¨ Docker / Kubernetes</h2>
<p>åšå¥½å‡†å¤‡ã€‚</p>
</template>
