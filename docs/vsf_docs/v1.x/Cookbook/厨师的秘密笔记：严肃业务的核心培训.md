# å¨å¸ˆçš„ç§˜å¯†ç¬”è®°ï¼šä¸¥è‚ƒä¸šåŠ¡çš„æ ¸å¿ƒåŸ¹è®­

æŒ‡å¯¼

è¿™æœ¬é£Ÿè°±æ²¡æœ‰é£Ÿè°±ï¼Œä½†åœ¨å°†*VSF*æŠ•å…¥ç”Ÿäº§ä¹‹å‰ä¸ºæ‚¨æä¾›äº†ä¸€ä¸ªæ¸…å•ã€‚æ‚¨å¯ä»¥ä¸æ‚¨çš„å®ä¾‹è¿›è¡Œæ¯”è¾ƒï¼Œä¸€ä¸€å‹¾é€‰åˆ—è¡¨ï¼Œä»¥ä¾¿è®©æ‚¨çš„*é¤å…*ä¸º*ç±³å…¶æ—æ£€æŸ¥*åšå¥½å‡†å¤‡ã€‚

åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»ï¼š



- [0. ä»‹ç»](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_0-introduction)
- [1. å†…å­˜æ³„æ¼](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_1-memory-leaks)
- [2. SSR è¾“å‡ºç¼“å­˜](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_2-ssr-output-cache)
- [3. é¿å…ä»·æ ¼ä¸åŒæ­¥](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_3-avoiding-prices-desynchronization)
- [4. é¿å…åº“å­˜ä¸åŒæ­¥](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_4-avoiding-stock-desynchronization)
- [5. Vue Storefront å¦‚ä½•è®¡ç®—ä»·æ ¼å’Œç¨æ”¶](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_5-how-vue-storefront-calculates-prices-and-taxes)
- [6. é™åˆ¶ SSR HTML å¤§å°ï¼Œå³ INITIAL_STATE ä¼˜åŒ–](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_6-limiting-ssr-html-size-a-k-a-initial-state-optimization)
- [7. Url Dispatcher è§£é‡Š](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_7-url-dispatcher-explained)
- [8. Multistore é…ç½®è¯´æ˜](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_8-multistore-configuration-explained)
- [9. HTML æœ€å°åŒ–ã€å‹ç¼©ã€æ ‡é¢˜](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_9-html-minimization-compression-headers)
- [10.ç”Ÿäº§ç›®å½•ç´¢å¼•+ç¼“å­˜å¤±æ•ˆ](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_10-production-catalog-indexing-cache-invalidation)
- [11. ä½¿ç”¨ Magento Checkout](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_11-using-magento-checkout)
- [12. Elasticsearch ç”Ÿäº§è®¾ç½®](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_12-elasticsearch-production-setup)
- [13. .htaccessã€æœåŠ¡å™¨ç«¯é‡å®šå‘ã€HTTP ä»£ç å’Œæ ‡å¤´ã€ä¸­é—´ä»¶](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_13-htaccess-server-side-redirects-http-codes-and-headers-middlewares)
- [14. VSF çœŸæ­£ä½¿ç”¨çš„äº§å“ã€ç±»åˆ«å’Œå±æ€§çš„å“ªäº›å­—æ®µ](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_14-which-fields-of-product-category-and-attribute-are-really-used-by-vsf)
- [15. é…ç½®æ–‡ä»¶å±æ€§ä¸­éå¸¸æ–¹ä¾¿çš„åŠŸèƒ½](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_15-quite-handy-features-in-config-file-properties)
- [16. Cloudflare è‡ªåŠ¨æ¸…é™¤](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_16-cloudflare-autopurge)
- [17. VSF ç¼“å­˜æ¸…æ¼†](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_17-vsf-cache-varnish)
- [18.VSFç¼“å­˜NGINX](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_18-vsf-cache-nginx)
- [19. é€‚ç”¨äº Magento 1 å’Œ Magento 2 çš„ Vue Storefront 1 é…ç½®éªŒè¯å™¨](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_19-vue-storefront-1-config-validator-for-magento-1-and-magento-2)
- [20. ä¸€ä¸ªç¤ºä¾‹ä¸»é¢˜å¼€å§‹](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_20-a-sample-theme-to-start-with)
- [21ã€é’ˆå¯¹Vue Storefront 1å¼€å‘ä¼˜åŒ–Webpacké…ç½®](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_21-optimized-webpack-configuration-for-vue-storefront-1-development)
- [22. åœ¨ VSF 1.12+ ä¸­æ‘†è„± depracatedActions](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_22-get-rid-of-depracatedactions-in-vsf-1-12)



å®‰å…¨æœ€ä½³å®è·µ

æœ‰ä¸€ä¸ªä¸“é—¨ç”¨äº PWA å®‰å…¨çš„å•ç‹¬ç«™ç‚¹ï¼Œæ‚¨å¯ä»¥ä»è¡Œä¸šä¸“å®¶é‚£é‡Œè·å¾—ä¸€äº›å»ºè®®æ¥ç”³è¯·æ‚¨çš„ä¸šåŠ¡ã€‚ [æ— å¤´å®‰å…¨æœ€ä½³å®è·µï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://headless-security.org/vsf-best-practices.html)

## [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_0-introduction)0. ä»‹ç»

Vue Storefront å¾—åˆ°äº†å¸‚åœºçš„æå¤§å…³æ³¨ï¼Œå¹¶å¾—åˆ°äº†å¼€å‘äººå‘˜çš„é’çï¼Œæ‹¥æœ‰ 20 å¤šä¸ªç”Ÿäº§ç«™ç‚¹ã€‚ä¸æ­¤åŒæ—¶ï¼ŒVue Storefront æ¡†æ¶éšç€æ¯ä¸ªæ–°ç‰ˆæœ¬çš„å‘å¸ƒè€Œå‘å±•ï¼Œæ–‡æ¡£å‡ ä¹è·Ÿä¸ä¸Šå®ƒï¼

è¿™äº›åŸ¹è®­ææ–™æ˜¯ä¸€å¥—ä¸»è¦é…æ–¹ï¼Œä»æˆ˜å£•ä¸­å­¦åˆ°çš„ç»éªŒã€‚æˆ‘è¯•å›¾å›ç­”å¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œ Vue Storefrontï¼Œè§£å†³å¤§å¤šæ•°å¸¸è§é—®é¢˜å¹¶è§£é‡Š Vue Storefront çš„æ‰€æœ‰éšè—åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½å¯ä»¥å¸®åŠ©æ‚¨æ‰©å±•åº”ç”¨ç¨‹åºå¹¶è§£å†³å¤§å¤šæ•°å¸¸è§é—®é¢˜ã€‚

è¿™é‡Œçš„ä¸€äº›ä¸»é¢˜æ‘˜è‡ª[æˆ‘ä»¬è®ºå›ä¸­çš„å¸¸è§é—®é¢˜ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://forum.vuestorefront.io/c/help). æœ‰äº›[æ¥è‡ª Slack ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](http://slack.vuestorefront.io/). æœ‰äº›æ¥è‡ªæ ¸å¿ƒå’¨è¯¢å’Œæˆ‘ä»¬è‡ªå·±çš„å·¥ä½œã€‚ä¸€ä»¶äº‹æ˜¯å…±åŒçš„ï¼›æ¯ä¸€ä¸ªé…æ–¹å¯¹äºåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç¨³å®šè¿è¡Œçš„ Vue Storefront éƒ½éå¸¸å…³é”®ï¼Œå¦‚æœä¸å°å¿ƒæ‰§è¡Œå®ƒä»¬éƒ½ä¼šå¯¼è‡´ä¸€äº›ä¸¥é‡çš„ç»“æœã€‚

## [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_1-memory-leaks)1. å†…å­˜æ³„æ¼

Vue Storefront ç”±ä¸¤ä¸ª Node.js åº”ç”¨ç¨‹åºç»„æˆï¼š

- `vue-storefront` - è¿™æ˜¯å‰ç«¯åº”ç”¨ç¨‹åºï¼Œå…¥å£ç‚¹ä¸º [`core/scripts/server.js`ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/4ed26d7f1978a9e798edcddf1cf2f970c3e64e4f/core/scripts/server.js#L269)
- `vue-storefornt-api` - è¿™æ˜¯åç«¯/api åº”ç”¨ç¨‹åºã€‚

å¦‚æœæ‚¨ç†Ÿæ‚‰ PHP Web åº”ç”¨ç¨‹åºå¹¶åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œ PHPï¼Œæ— è®ºæ˜¯ fastCGI è¿˜æ˜¯ FPMï¼Œ*Node.js çš„*å·¥ä½œæ–¹å¼éƒ½å®Œå…¨ä¸åŒã€‚å®ƒä¸æ˜¯`node`é’ˆå¯¹æ¯ä¸ªè¯·æ±‚æ‰§è¡Œè¿›ç¨‹ï¼Œè€Œæ˜¯è¿è¡Œä¸€ä¸ªå†…éƒ¨ http æœåŠ¡å™¨æ¥ä¸ºæ‰€æœ‰åç»­è¯·æ±‚æä¾›æœåŠ¡ã€‚å®ƒæ˜¯å•çº¿ç¨‹ã€é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¾ˆå®¹æ˜“é™·å…¥å†…å­˜æ³„æ¼é—®é¢˜çš„åŸå› ï¼›ç‰¹åˆ«æ˜¯å¯¹äº`vue-storefront`æ¯” API å¤æ‚å¾—å¤šçš„åº”ç”¨ç¨‹åºã€‚

### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#protip)ä¸“å®¶æç¤º

#### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_1-first-thing-first-monitor-memory-leaks)1. é¦–å…ˆï¼Œç›‘æ§å†…å­˜æ³„æ¼

ä½ æ€ä¹ˆçŸ¥é“ä½ æœ‰å†…å­˜æ³„æ¼å§åº•ï¼Ÿ

ä» Vue Storefront æ ¹ç›®å½•å¼€å§‹`yarn pm2 status`æˆ–`yarn pm2 monit`è·å–è¯¦ç»†ä¿¡æ¯ã€‚

è¯¥`pm2` [å†…å­˜ä½¿ç”¨æƒ…å†µ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](http://pm2.keymetrics.io/docs/usage/monitoring/)éšç€æ¯æ¬¡é¡µé¢åˆ·æ–°è€Œå¢é•¿ã€‚

*PM2*åœ¨[1GB RAM](https://github.com/vuestorefront/vue-storefront/blob/master/ecosystem.json#L5)åé‡æ–°å¯åŠ¨è¿›ç¨‹[ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼‰ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/master/ecosystem.json#L5)æ­£åœ¨ä½¿ç”¨ä¸­ï¼›è¿™å¯ä»¥è°ƒæ•´ï¼Œå¹¶ä¸`instances`åœ¨ ä¸­è®¾ç½®çš„å¤šä¸ªèŠ‚ç‚¹ä¸€èµ·`ecosystem.json`ï¼Œè¿™æ˜¯å†…å­˜æ³„æ¼çš„ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ³•ã€‚

æ­¤å¤–ï¼Œæœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥è·Ÿè¸ªå†…å­˜æ³„æ¼ï¼Œä½†æ˜¯æˆ‘ä»¬å¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨ä½¿ç”¨æµè§ˆå™¨å·¥å…·ï¼ˆå†…å­˜é…ç½®æ–‡ä»¶ï¼‰ã€‚[åœ¨è¿™é‡Œä½ æœ‰è¯¦ç»†çš„è§£é‡Š ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://marmelab.com/blog/2018/04/03/how-to-track-and-fix-memory-leak-with-nodejs.html). å¦ä¸€ä¸ªæœ‰ç”¨çš„å·¥å…·æ˜¯[New Relic APM ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](http://newrelic.com/)å’Œ[è°·æ­Œè·Ÿè¸ªï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://cloud.google.com/trace/docs/setup/nodejs)

#### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_2-how-to-use-vue-plugins)2.å¦‚ä½•ä½¿ç”¨Vueæ’ä»¶

æ‚¨å¿…é¡»é¿å…çš„ä¸€ä»¶äº‹æ˜¯`Vue.use`å¤šæ¬¡ä½¿ç”¨ï¼Œæ‚¨å¯ä»¥é€šè¿‡å§‹ç»ˆåœ¨ inside è°ƒç”¨å®ƒæ¥ç¡®ä¿å®ƒ`once`ã€‚åœ¨ Vue Storefront ä»£ç ä¸­ï¼Œä½ ç»å¸¸å¯ä»¥æ‰¾åˆ°è¿™æ ·çš„ç‰‡æ®µï¼š

```js
import { once } from '@vue-storefront/core/helpers'
once('__VUE_EXTEND_RR__', () => {
  Vue.use(VueRouter)
})
```

è¿™æ˜¯ä¸€ä¸ª**å¸®åŠ©**æ‚¨å®‰å…¨ä½¿ç”¨æ’ä»¶çš„åŠ©æ‰‹ã€‚éšæ„å°†å®ƒä¸æ‰€æœ‰æ’ä»¶å’Œ mixins å®ä¾‹åŒ–ä¸€èµ·ä½¿ç”¨ã€‚

è¿›ä¸€æ­¥ç ”ç©¶

Vue.js æ–‡æ¡£ä¸­æœ‰å…³äº[å¦‚ä½•é¿å… Vue.js å†…å­˜æ³„æ¼çš„](https://vuejs.org/v2/cookbook/avoiding-memory-leaks.html)å¾ˆå¥½çš„éƒ¨åˆ†[ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://vuejs.org/v2/cookbook/avoiding-memory-leaks.html).

#### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_3-handling-events-in-a-proper-way)3.ä»¥é€‚å½“çš„æ–¹å¼å¤„ç†*äº‹ä»¶*

å¦ä¸€ä»¶äº‹æ˜¯æ­£ç¡®å¤„ç†äº‹ä»¶ã€‚æ¯ä¸ª`EventBus.$on`å¿…é¡»æœ‰å…¶å¯¹åº”çš„`EventBus.$off`. æ‚¨åº”è¯¥åœ¨å…¶ç”Ÿå‘½å‘¨æœŸä¸­å°å¿ƒåœ°æ‰“å¼€å’Œå…³é—­å®ƒä»¬ã€‚

å…¶æ¬¡ï¼Œè¯·å°½é‡é¿å…**åœ¨`created`hookä¸­ç»‘å®šäº‹ä»¶çš„** æƒ…å†µã€‚åœ¨`created`è¢«ç§°ä¸ºçº¯è‹±æ–‡çš„SSRæ¨¡å¼æˆ–æœåŠ¡å™¨ç«¯; ä½†æ˜¯ï¼Œå¦‚æœæ‚¨ç»‘å®š`beforeMount`å®ƒï¼Œå®ƒå°†ä»…åœ¨ CSRï¼ˆä»£è¡¨å®¢æˆ·ç«¯æ¸²æŸ“æˆ–ç®€å•çš„å®¢æˆ·ç«¯æµè§ˆå™¨ï¼‰ä¸­æ‰§è¡Œï¼Œè¿™æ˜¯ 99% æ‰€éœ€çš„è¡Œä¸ºï¼Œå¹¶ä¸”æ‚¨ä¸ä¼šå†’äº‹ä»¶å‘ç”Ÿå†…å­˜æ³„æ¼çš„é£é™©ã€‚

#### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_4-stateful-singleton)4. æœ‰çŠ¶æ€å•ä¾‹

ç¡®ä¿æ‚¨å·²`runInNewContext`è®¾ç½®ä¸º`true`ï¼ˆé»˜è®¤å€¼ï¼ï¼‰[`core/scripts/utils/ssr-renderer.js` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/master/core/scripts/utils/ssr-renderer.js#L16).

é€šè¿‡è®¾ç½®`false`ï¼Œ[Stateful Singletons ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/issues/2664)å–œæ¬¢`RouteManager`æˆ–`i18n`æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨å°†å¯¼è‡´ huuuuuge è§„æ¨¡çš„å†…å­˜æ³„æ¼ã€‚

#### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_5-static-pages-generator)5. é™æ€é¡µé¢ç”Ÿæˆå™¨

æˆ‘ä»¬ç¡®å®æœ‰**é™æ€é¡µé¢ç”Ÿæˆå™¨**- ç›®å‰æ˜¯å®éªŒæ€§åŠŸèƒ½ - å¯ä»¥å°†æ•´ä¸ªç«™ç‚¹ç”Ÿæˆä¸ºä¸€ç»„é™æ€ HTML æ–‡ä»¶ï¼Œå› æ­¤å®ƒä»¬ç”šè‡³å¯ä»¥ç›´æ¥ä»äº‘æä¾›å•†/CDN æä¾›æœåŠ¡ - ä¸å¯èƒ½å‡ºç°å†…å­˜æ³„æ¼ï¼›åœ¨æ­¤æ¨¡å¼ä¸‹æ‚¨éœ€è¦å¤„ç†çš„æ˜¯ç¼“å­˜å¤±æ•ˆï¼ˆå½“å‰ä¸æ”¯æŒä½†æ˜“äºæ·»åŠ ï¼‰ã€‚[é˜…è¯»æœ‰å…³é™æ€é¡µé¢ç”Ÿæˆå™¨çš„æ›´å¤šä¿¡æ¯ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/pull/3256).

#### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_6-learn-from-core-team)6. å‘æ ¸å¿ƒå›¢é˜Ÿå­¦ä¹ 

å¦‚æœæ‚¨æƒ³æ·±å…¥æŒ–æ˜ä¸å†…å­˜æ³„æ¼ç›¸å…³çš„ä»»ä½•é—®é¢˜ï¼Œè¯·[äº†è§£æ ¸å¿ƒå›¢é˜Ÿå¦‚ä½•å¤„ç†å†…å­˜æ³„æ¼ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/pulls?utf8=âœ“&q=is%3Apr+memory+is%3Aclosed+leak)åœ¨ Vue Storefront æ ¸å¿ƒä¸­ - å¹¶æ£€æŸ¥è§£å†³çš„ä»»ä½•è¾¹ç¼˜æ¡ˆä¾‹æ˜¯å¦å¯ä»¥ä¸ºæ‚¨çš„é¡¹ç›®æä¾›çµæ„Ÿã€‚





## [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_2-ssr-output-cache)2. SSR è¾“å‡ºç¼“å­˜

Vue Storefront æ”¯æŒ[æœåŠ¡ç«¯æ¸²æŸ“ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://vuejs.org/v2/guide/ssr.html). åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œåœ¨æµè§ˆå™¨ï¼ˆCSRï¼›å®¢æˆ·ç«¯æ¸²æŸ“ï¼‰ä¸­æ‰§è¡Œçš„ç›¸åŒä»£ç åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œä»¥ç”Ÿæˆ HTML æ ‡è®°ã€‚ç„¶åï¼Œæ ‡è®°è¢«ä¼ è¾“åˆ°æµè§ˆå™¨ï¼Œå‘ˆç°ï¼ˆéå¸¸å¿«ï¼Œå› ä¸ºæµè§ˆå™¨éƒ½ç»è¿‡ä¼˜åŒ–......åœ¨è¿‡å» 20 å¤šå¹´ä¸­å‘ˆç° html æ–‡æœ¬ï¼‰å¹¶[æ°´åˆ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://ssr.vuejs.org/guide/hydration.html)ä»[åˆå§‹çŠ¶æ€ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://ssr.vuejs.org/guide/data.html#final-state-injection). åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯æˆ–æµè§ˆå™¨è„šæœ¬å¯ä»¥æ™®éä½¿ç”¨å®Œå…¨ç›¸åŒçš„ä»£ç åº“ã€‚å¦ä¸€ä¸ªå¾ˆé…·çš„åŠŸèƒ½æ˜¯é™æ€ HTML æ ‡è®°è¢«æœç´¢å¼•æ“çˆ¬è™«å¾ˆå¥½åœ°ç´¢å¼•ï¼Œè¿™å¯¹ SEO éå¸¸é‡è¦ã€‚

é€šå¸¸ï¼ŒVue Storefront çš„è¿è¡Œé€Ÿåº¦éå¸¸å¿«ï¼Œæ‰€æœ‰ SSR è¯·æ±‚éƒ½åœ¨ 100-300 æ¯«ç§’ä¹‹é—´å®Œæˆï¼›ä½†æ˜¯ï¼Œå¦‚æœæ‚¨çš„æ•°æ®åº“å¾ˆå¤§æˆ–æ‚¨çš„æœåŠ¡å™¨èµ„æºå¾ˆå°‘ï¼Œæˆ–è€…æµé‡å¯èƒ½éå¸¸é«˜ï¼Œæ‚¨å¯èƒ½éœ€è¦å¯ç”¨è¾“å‡ºç¼“å­˜ã€‚å¦ä¸€ä¸ªåŸå› æ˜¯ä½ å¯èƒ½æƒ³ä½¿ç”¨ SSR ç¼“å­˜æ¥é˜²æ­¢å†…å­˜æ³„æ¼ï¼Œæˆ–è€…æˆ‘åº”è¯¥è¯´ï¼Œéšè—å®ƒä»¬ğŸ˜‰ã€‚

### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#protip-2)ä¸“å®¶æç¤º

#### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_1-ssr-cache-docs)1. SSR ç¼“å­˜æ–‡æ¡£

SSR ç¼“å­˜[åœ¨æˆ‘ä»¬çš„æ–‡æ¡£ä¸­æœ‰å¾ˆå¥½çš„è®°å½•](https://docs.vuestorefront.io/v1/guide/basics/ssr-cache.html)ã€‚ä»€ä¹ˆæ˜¯é‡è¦çš„ï¼›å®ƒé€‚ç”¨äºï¼š`vue-storefront`å’Œ`vue-storefront-api`ã€‚

[é˜…è¯»æ‰€æœ‰ç¼“å­˜æœºåˆ¶ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://medium.com/the-vue-storefront-journal/caching-on-production-10b00a5614f8)Vue Storefront æ­£åœ¨ä½¿ç”¨çš„é‚£ä¸ªã€‚

#### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_2-using-redis-tagging)2. ä½¿ç”¨Redisæ ‡ç­¾

å¯ç”¨ SSR è¾“å‡ºç¼“å­˜æ¨¡å¼åï¼Œ [`core/server.js` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/e96bc3c0d1ef8239bc2e64c399f1fe924cebed36/core/scripts/server.js#L187)å°†æ¸²æŸ“çš„è¾“å‡ºé¡µé¢ä¸ http æ ‡å¤´ä¸€èµ·å­˜å‚¨åˆ° Redis ç¼“å­˜ä¸­ã€‚å¦‚æœé¡µé¢å­˜åœ¨äº Redis ä¸­ï¼Œé‚£ä¹ˆå®ƒç”šè‡³ä¸éœ€è¦å¯åŠ¨ Vue SSR æ¸²æŸ“å™¨å°±å¯ä»¥å¾—åˆ°æœåŠ¡ã€‚

Vue Storefront ä½¿ç”¨ Redis æ¥ä½¿ç”¨ [`redis-tagging` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://www.npmjs.com/package/redis-tagging)å›¾ä¹¦é¦†ã€‚å‘½åå’Œç¼“å­˜æ˜¯è½¯ä»¶å¼€å‘ä¸­ä¸¤ä¸ªæœ€å›°éš¾çš„é¢†åŸŸã€‚ç¼“å­˜æ ‡è®°å¸®åŠ©æˆ‘ä»¬å¤„ç†ç¼“å­˜å¤±æ•ˆã€‚

Vue Storefront ä½¿ç”¨[äº§å“](https://github.com/vuestorefront/vue-storefront/blob/e96bc3c0d1ef8239bc2e64c399f1fe924cebed36/core/modules/catalog/helpers/search.ts#L69)æ ‡è®°è¾“å‡ºé¡µé¢[ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/e96bc3c0d1ef8239bc2e64c399f1fe924cebed36/core/modules/catalog/helpers/search.ts#L69)å’Œ[ç±»åˆ« ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/e96bc3c0d1ef8239bc2e64c399f1fe924cebed36/core/modules/catalog/store/category/actions.ts#L121)æ ‡ç­¾ã€‚ç„¶åæ‰€æœ‰ç´¢å¼•å™¨åŒ…æ‹¬ï¼š`magento1-vsbridge-indexer`ï¼Œ`mage2vuestorefront`å¹¶ä¸”`magento2-vsbridge-indexer`å°†æ ¹æ®ç‰¹å®š*äº§å“*æˆ–*ç±»åˆ«* *ID*ä½¿ç¼“å­˜æ— æ•ˆã€‚è¿™æ„å‘³ç€[`invalidate` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/e96bc3c0d1ef8239bc2e64c399f1fe924cebed36/core/scripts/server.js#L156)æ–¹æ³•å°†æ¸…é™¤æ ‡è®°æœ‰æ­¤ç‰¹å®š*äº§å“ id*çš„ç¼“å­˜é¡µé¢ã€‚

ç¬”è®°

æ­¤ URL è¦æ±‚æ‚¨ä¼ é€’[é…ç½®ä¸­](https://github.com/vuestorefront/vue-storefront/blob/e96bc3c0d1ef8239bc2e64c399f1fe924cebed36/config/default.json#L12)è®¾ç½®çš„å¤±æ•ˆä»¤ç‰Œ[ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/e96bc3c0d1ef8239bc2e64c399f1fe924cebed36/config/default.json#L12).

æ‚¨å¯ä»¥æ·»åŠ ä»»æ„æ•°é‡çš„ç‰¹å®šç¼“å­˜æ ‡ç­¾ - åªéœ€æ‰©å±• [`availableCacheTags` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/e96bc3c0d1ef8239bc2e64c399f1fe924cebed36/config/default.json#L11)å’Œ/æˆ–[å°†æ ‡ç­¾æ¨é€åˆ°`ssrContext` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/e96bc3c0d1ef8239bc2e64c399f1fe924cebed36/core/pages/Home.js#L19)æ‰€ä»¥å®ƒä»¬å¯ä»¥è¢«`core/scripts/server`.

`context`ä¼ é€’ç»™çš„è¿™ä¸ªå‚æ•°`asyncData()`å®é™…ä¸Šæ˜¯è¢«ä½¿ç”¨çš„åŒä¸€ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡[`core/scripts/server.js` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/e96bc3c0d1ef8239bc2e64c399f1fe924cebed36/core/scripts/server.js#L168)ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†å®ƒç”¨ä½œä¼ è¾“å¯¹è±¡ï¼Œç”¨äºåœ¨æœåŠ¡å™¨å’Œ Vue.js åº”ç”¨ç¨‹åºä¹‹é—´æ¥å›ä¼ é€’æ ‡ç­¾ã€‚

#### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_3-invalidating-ssr-cache)3. ä½¿ SSR ç¼“å­˜å¤±æ•ˆ

ç¬”è®°

éšç€SSRç¼“å­˜å¼€å¯ï¼ˆ`vue-storefront-api`æˆ–`vue-storefront`åº”ç”¨ï¼‰ï¼Œè¯·ç¡®ä¿ä½ ä½¿ç”¨çš„ä¸æ˜¯ä¸åŒå±‚ï¼ˆä¾‹å¦‚æ¸…æ¼†æˆ–nginxçš„ï¼‰ä¸Šçš„é«˜é€Ÿç¼“å­˜ã€‚å¦åˆ™ç¼“å­˜å¤±æ•ˆæœºåˆ¶å°†ä¸èµ·ä½œç”¨ã€‚

åŠ¨æ€æ ‡ç­¾é…ç½®é€‰é¡¹ï¼š`useOutputCacheTagging`- å¦‚æœè®¾ç½®ä¸º`true`ï¼ŒVue Storefront ä¼šç”Ÿæˆç‰¹æ®Šçš„ HTTP æ ‡å¤´`X-VS-Cache-Tags`

```js
res.setHeader('X-VS-Cache-Tags', cacheTags);
```

ç¼“å­˜æ ‡ç­¾æ˜¯æ ¹æ®ç‰¹å®šé¡µé¢ä¸Šä½¿ç”¨çš„äº§å“å’Œç±»åˆ«åˆ†é…çš„ã€‚ä¸€ä¸ªå…¸å‹çš„`X-VS-Cache-Tags`æ ‡ç­¾å¦‚ä¸‹æ‰€ç¤ºï¼š

```text
X-VS-Cache-Tags: P1852 P198 C20
```

å¦‚æœä½¿ç”¨ Varnish ç¼“å­˜ï¼Œè¿™äº›æ ‡ç­¾å¯ç”¨äºä½¿å…¶æ— æ•ˆã€‚[é˜…è¯»æ›´å¤š ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://www.drupal.org/docs/8/api/cache-api/cache-tags-varnish).

ç¬”è®°

æ‰€æœ‰å®˜æ–¹ Vue Storefront æ•°æ®ç´¢å¼•å™¨ï¼ŒåŒ…æ‹¬[magento1-vsbridge-indexer ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/divanteLtd/magento1-vsbridge-indexer)å’Œ[magento2-vsbridge-indexer ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/magento2-vsbridge-indexer)æ”¯æŒç¼“å­˜å¤±æ•ˆã€‚

å¦‚æœåœ¨ API å’Œ Vue Storefront å‰ç«¯åº”ç”¨ç¨‹åºä¸­éƒ½å¯ç”¨äº†ç¼“å­˜ï¼Œè¯·ç¡®ä¿æ­£ç¡®ä½¿ç”¨`config.server.invalidateCacheForwardUrl`config å˜é‡ï¼Œå› ä¸ºç´¢å¼•å™¨åªèƒ½å°†ç¼“å­˜æ— æ•ˆè¯·æ±‚å‘é€åˆ°ä¸€ä¸ª URLï¼ˆå‰ç«¯æˆ–åç«¯ï¼‰ï¼Œå¹¶ä¸”**åº”è¯¥è½¬å‘**åˆ°å¦ä¸€ä¸ª. è¯·æ£€æŸ¥ ä¸­çš„é»˜è®¤è½¬å‘ URL`default.json`å¹¶å°†`key`å‚æ•°è°ƒæ•´ä¸º çš„å€¼`server.invalidateCacheKey`ã€‚





## [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_3-avoiding-prices-desynchronization)3. é¿å…ä»·æ ¼ä¸åŒæ­¥

Vue Storefront ç´¢å¼•å™¨ ( `magento2-vsbridge-indexer`, `magento1-vsbridge-indexer`, `mage2vuestorefront`) éƒ½å°†äº§å“ä»·æ ¼ï¼ˆåº”ç”¨ç›®å½•è§„åˆ™ä¹‹å‰/ä¹‹åï¼‰å­˜å‚¨åˆ° Elasticsearch ä¸­ã€‚ä½†æ˜¯ Elasticsearch å¾ˆå®¹æ˜“ä¸åŒæ­¥æˆ–åŒæ­¥å¯èƒ½æ»åã€‚ä¸ºäº†é¿å…å‘å®¢æˆ·æ˜¾ç¤ºé”™è¯¯ä»·æ ¼çš„é£é™©ï¼ŒVue Storefront è‡³å°‘æœ‰ 3 ç§æœºåˆ¶â€”â€”`alwaysSyncPlatformPricesOver`åœ¨é¡¶éƒ¨ã€‚

ç¬”è®°

å¦‚æœæ‚¨ä½¿ç”¨`mage2vuestorefront`æ¥åŒæ­¥äº§å“ï¼Œè¯·ç¡®ä¿åœ¨åº”ç”¨**ç›®å½•è§„åˆ™å**åŒæ­¥ä»·æ ¼ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬è¦è®¾ç½®ç‰¹æ®Šæ ‡å¿—ï¼š

```bash
export PRODUCTS_SPECIAL_PRICES=true
export PRODUCTS_RENDER_PRICES=true
node --harmony cli.js products --removeNonExistent=true --partitions=1
```

### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#protip-3)ä¸“å®¶æç¤º

#### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_1-alwayssyncplatformpricesover-to-be-in-sync)1. *alwaysSyncPlatformPricesOver*ä¿æŒåŒæ­¥

å½“è¯¥`config.products.alwaysSyncPlatformPricesOver`é€‰é¡¹æ‰“å¼€æ—¶ï¼ŒVue Storefront å°†**ç›´æ¥ä»æºç½‘ç»œå•†åº—ï¼ˆä¾‹å¦‚ Magento ï¼‰**æ›´æ–°æ‰€æœ‰åˆ—è¡¨å’Œäº§å“è¯¦ç»†ä¿¡æ¯é¡µé¢ä¸Šçš„å¯è§ä»·æ ¼ã€‚ï¼ˆMagento ä»£è¡¨ä»¥ä¸‹æºç½‘ç»œå•†åº—ï¼‰è´Ÿè´£æ­¤æ“ä½œçš„ä»£ç ä½äº[`doPlatformPricesSync` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/48233bfa4575be218a51cccd2474ec358671fc01/core/modules/catalog/helpers/index.ts#L212)ä»è°ƒç”¨çš„åŠ©æ‰‹ [`tax/calculateTaxes` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/48233bfa4575be218a51cccd2474ec358671fc01/core/modules/catalog/store/tax/actions.ts#L74)è¡ŒåŠ¨ã€‚

ç¬”è®°

æ¯å½“åœ¨æœåŠ¡å™¨ç«¯æˆ–å®¢æˆ·ç«¯ï¼ˆ`config.tax.calculateServerSide`é€‰é¡¹ï¼‰è®¡ç®—ä»·æ ¼æ—¶ï¼Œæ­¤æ¨¡å¼éƒ½æœ‰æ•ˆã€‚

æ£€æŸ¥[Vue StorefrontåŒæ­¥ä»·æ ¼çš„æ–¹å¼ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/48233bfa4575be218a51cccd2474ec358671fc01/core/modules/catalog/helpers/index.ts#L216)æ­£æ˜¯æ‚¨æ‰€éœ€è¦çš„ï¼Œè€Œä¸æ˜¯[è¦†ç›–æ­¤æ“ä½œ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://docs.vuestorefront.io/guide/cookbook/module.html#_2-2-recipe-b-override-vuex-store-with-extendstore).

#### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_2-alwayssyncplatformpricesover-has-2-options)2. *alwaysSyncPlatformPricesOver*æœ‰ 2 ä¸ªé€‰é¡¹

è¯¥`alwaysSyncPlatformPricesOver`æ¨¡å¼æœ‰ä¸¤ä¸ªé™„åŠ é€‰é¡¹ï¼š

1. åŒæ­¥å‰æ¸…é™¤ä»·æ ¼ï¼š`config.products.clearPricesBeforePlatformSync`- å½“è®¾ç½®ä¸º æ—¶`true`ï¼Œç”¨æˆ·åœ¨ä» Magento è·å–æ–°ä»·æ ¼ä¹‹å‰ä¸ä¼šçœ‹åˆ°ç¼“å­˜åœ¨ Elasticsearch ä¸­çš„ä»·æ ¼
2. åŒæ­¥æ¨¡å¼ -`config.products.waitForPlatformSync`é»˜è®¤æƒ…å†µä¸‹ï¼Œä»·æ ¼åŒæ­¥ä¸æ˜¾ç¤ºäº§å“æˆ–ç±»åˆ«å†…å®¹å¹¶è¡Œè¿è¡Œï¼Œå³*å¼‚æ­¥*ã€‚æˆ‘ä»¬å¯ä»¥ä½¿å…¶åŒæ­¥ï¼ˆç­‰å¾…æ­¤è¿‡ç¨‹å®Œæˆï¼‰ï¼Œä»¥ä¾¿åœ¨ HTML æ ‡è®°ï¼ˆSSRï¼›å¦åˆ™ SSR ä¸­çš„ä»·æ ¼å°†æ¥è‡ª Elasticsearchï¼‰ä¸­å‘ˆç° Magento çš„å½“å‰ä»·æ ¼ã€‚

æ›´é‡è¦çš„æ˜¯ - Vue Storefront æ€»æ˜¯ä» Magento æˆ–ä»»ä½•å…¶ä»–åç«¯è·å–**å¹³å°æ€»è®¡**ï¼ˆè´­ç‰©è½¦å’Œè®¢å•æ‘˜è¦ä¸­å¯è§çš„æœ€ç»ˆä»·æ ¼ï¼‰ã€‚è¿™æ ·æ‚¨çš„å®¢æˆ·å°±æ²¡æœ‰é£é™©çœ‹åˆ°ä»·æ ¼ä¸æ­£ç¡®çš„äº§å“ã€‚





## [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_4-avoiding-stock-desynchronization)4. é¿å…åº“å­˜ä¸åŒæ­¥

ä¸äº§å“åº“å­˜çš„ä»·æ ¼å‡ ä¹ç›¸åŒçš„æƒ…å†µã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ç´¢å¼•å™¨éƒ½å°†[è‚¡ç¥¨ä¿¡æ¯æ­£ç¡®](https://github.com/vuestorefront/vue-storefront-integration-sdk/blob/tutorial/Format-product.md)è®¾ç½®[åˆ°äº§å“å¯¹è±¡ä¸­ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront-integration-sdk/blob/tutorial/Format-product.md)å¦‚ä¸‹ ï¼š

- åœ¨ä¸»è¦ç»“æ„ä¸­ `product.stock`
- åœ¨`product.configurable_children.stock`ä¸º`configurable_children`ã€‚

è¿™äº›ä¿¡æ¯å¯èƒ½å·²ç»è¿‡æ—¶ã€‚

### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#protip-4)ä¸“å®¶æç¤º

#### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_1-how-it-stays-in-sync-in-real-time)1.å¦‚ä½•ä¿æŒå®æ—¶åŒæ­¥

**åœ¨ä»¥ä¸‹æƒ…å†µä¸‹ï¼Œ** Vue Storefront**é»˜è®¤**æ£€æŸ¥å½“å‰åº“å­˜ä¿¡æ¯ï¼š

- [**ç”¨æˆ·å°†äº§å“æ·»åŠ åˆ°è´­ç‰©è½¦** ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/48233bfa4575be218a51cccd2474ec358671fc01/core/modules/cart/store/actions/itemActions.ts#L53)- è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥è¿‡ç¨‹ï¼ˆåœ¨æµè§ˆäº§å“å˜ä½“æ—¶è¿è¡Œç±»ä¼¼çš„è¿‡ç¨‹ - æ‚¨å¯ä»¥è·å¾—`0 items available`åˆ‡æ¢é¢œè‰²å’Œå°ºå¯¸æ—¶çš„ä¿¡æ¯ï¼‰ï¼›`Checkout.js`æ­£åœ¨ç­‰å¾…æ‰€æœ‰ç»“æœ[`stock/queueCheck` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/48233bfa4575be218a51cccd2474ec358671fc01/core/pages/Checkout.js#L69)è°ƒç”¨ã€‚
- å½“**è´­ç‰©è½¦**ä¸æœåŠ¡å™¨**åŒæ­¥**æ—¶ - ç”µå­å•†åŠ¡åç«¯[å†æ¬¡æ£€æŸ¥äº§å“å¯ç”¨æ€§ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/48233bfa4575be218a51cccd2474ec358671fc01/core/modules/cart/store/actions/mergeActions.ts#L45)å¹¶[é€šçŸ¥ç”¨æˆ· ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/48233bfa4575be218a51cccd2474ec358671fc01/core/modules/cart/components/AddToCart.ts#L31)å¦‚æœäº§å“æ— æ³•æ·»åŠ åˆ°è´­ç‰©è½¦æˆ–æ¢å¤ä¹‹å‰çš„æ•°é‡ï¼ˆå¦‚æœæ›´æ”¹ï¼‰ã€‚
- å½“`filterOutUnavailableVariants`æ¨¡å¼æ‰“å¼€å¹¶ä¸”ç”¨æˆ· a) è¿›å…¥äº§å“é¡µé¢ï¼Œb) æµè§ˆç±»åˆ«é¡µé¢æ—¶ã€‚

è¯¥`config.products.filterOutUnavailableVariants`æ¨¡å¼æ˜¯éå¸¸é‡è¦çš„ï¼Œå› ä¸ºåªæœ‰å…·å¤‡è¿™ç§æ¨¡å¼ä¸‹ä½ åˆ‡æ¢å¯ä»¥ç¡®ä¿æˆ‘ä»¬**ä¸æ˜¾ç¤ºä¸å¯ç”¨çš„å˜ä½“**ã€‚å½“å®ƒè®¾ç½®ä¸º`true`Vue Storefrontæ—¶ï¼Œä¼šå°†åº“å­˜ä¿¡æ¯ä» Magento ä¸­å–å‡ºå¹¶æ›´æ–°`product.stock`æ•´ä¸ªäº§å“åˆ—è¡¨ + äº§å“é¡µé¢ï¼ˆå½“å‰äº§å“ï¼‰çš„ä¿¡æ¯ã€‚ç„¶åå®ƒåˆ é™¤æ‰€æœ‰`configurable_children`ä¸å¯ç”¨çš„ã€‚[æŸ¥çœ‹è¯¦ç»†å®ç° ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/48233bfa4575be218a51cccd2474ec358671fc01/core/modules/catalog/helpers/index.ts#L121).

#### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_2-additional-options)2. é™„åŠ é€‰é¡¹

æ­¤æ¨¡å¼æœ‰ä¸¤ä¸ªé™„åŠ è®¾ç½®ï¼š

- `config.products.configurableChildrenStockPrefetchStatic`- åœ¨è¿™ç§æƒ…å†µä¸‹`true`ï¼ŒVue Storefront ä¸ºé™æ€è®¾ç½®çš„äº§å“æ•°é‡é¢„å–åº“å­˜ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡`config.products.configurableChildrenStockPrefetchStaticPrefetchCount`.
- `config.products.configurableChildrenStockPrefetchDynamic`- è®¾ç½®ä¸º true æ—¶ï¼ŒVue Storefront ä¼šé¢„å–ä»»ä½•å¯è§äº§å“çš„åº“å­˜ä¿¡æ¯ï¼›å®ƒæ˜¯åœ¨[`ProductTile.vue` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/48233bfa4575be218a51cccd2474ec358671fc01/src/themes/default/components/core/ProductTile.vue#L108)- ç¡®ä¿æ‚¨çš„ä¸»é¢˜æ”¯æŒè¿™ä¸€ç‚¹ã€‚

æˆ‘ä»¬åœ¨é»˜è®¤å®ç°ä¸­å¯¹ Magento MSI çš„æ”¯æŒæœ‰é™ã€‚[ç¡®ä¿åœ¨ Magento 2.3.x ä¸Šå¯ç”¨å®ƒ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront-api/pull/226).

ç¬”è®°

æ­¤åŠŸèƒ½éšåå¯ç”¨äºä¸[æç¤º 2-SSR ç¼“å­˜](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_2-ssr-output-cache)ç›¸å…³çš„**Donut ç¼“å­˜**ç­–ç•¥ã€‚

ç¬”è®°

å¦‚æœæ‚¨æƒ³ç»•è¿‡ Magento è‚¡ç¥¨è°ƒç”¨ï¼Œæœ‰ä¸€ç§æ–¹æ³•å¯ä»¥è·å–ä¸`https://vue-storefront-api/api/stock/list`è¿”å›æ•°æ®æ ¼å¼ç›¸åŒä½†æ¥è‡ª Elasticsearch çš„æ•°æ®ã€‚å®ƒåº”è¯¥æ˜¯ä¸€ä¸ªæ›¿ä»£å“ - æˆ‘çš„æ„æ€æ˜¯[æ”¹å˜`stock.endpoint` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/bb9044d6aaa36d4881733876f4646fabe7b6e102/config/default.json#L368)åˆ°è¿™ä¸ªæ–°çš„ã€‚ç­‰ç­‰ï¼šä½ è·³è¿‡è¯¢é—® Magentoï¼Œä»ç„¶æœ‰è¿™ä¸ªâ€œç¼“å­˜æ‰“å­”â€`config.products.filterOutUnavailableVariants`æ¨¡å¼

æœ‰ä¸€ä¸ªç°æˆçš„ç«¯ç‚¹å¯ä»¥ä» Elasticsearchï¼ˆä¸æ˜¯ä» Magentoï¼‰è·å–è‚¡ç¥¨[åœ¨è¿™é‡Œ#PR330 ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront-api/pull/330).

æ•…éšœæ’é™¤

å¦‚æœä¸å­˜åœ¨çš„å˜ä½“ä¸ä¼šæ¶ˆå¤±ï¼Œåˆ™æ„å‘³ç€æ‚¨éœ€è¦å®Œæˆä¸€äº›å‰ç«¯å·¥ä½œã€‚

æˆ‘çš„æ„æ€æ˜¯ - é€šè¿‡è¿™ä¸ª`filterOutUnavailableVariants`è®¾ç½®ï¼Œæˆ‘ä»¬å°†å½“å‰çš„è‚¡ç¥¨ä¿¡æ¯æ‹‰åˆ°`product.stock`å’Œ`product.configurable_children.stock`å±æ€§ã€‚éšç€è¿™äº›å±æ€§çš„æ›´æ–°ï¼Œæˆ‘ä»¬å°†åˆ é™¤è„±é”€çš„`configurable_children`. å¦‚æœå˜ä½“ä»ç„¶å¯ç”¨ï¼Œ[è¯·æŸ¥çœ‹æ­¤è¡Œ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/48233bfa4575be218a51cccd2474ec358671fc01/core/modules/catalog/store/product/actions.ts#L629)åº”è¯¥æœ‰ä¸€ä¸ªæ”¹å˜

ä»ï¼š

```js
if (isServer) {
  subloaders.push(context.dispatch('setupBreadcrumbs', { product: product }))
  subloaders.push(context.dispatch('filterUnavailableVariants', { product: product }))
} else {
  attributesPromise.then(() => context.dispatch('setupBreadcrumbs', { product: product })) // if this is client's side request postpone breadcrumbs setup till attributes are loaded to avoid too-early breadcrumb switch #2469
  context.dispatch('filterUnavailableVariants', { product: product }) // exec async
}
```

åˆ°ï¼š

```js
  subloaders.push(context.dispatch('filterUnavailableVariants', { product: product }))
if (isServer) {
  subloaders.push(context.dispatch('setupBreadcrumbs', { product: product }))
} else {
  attributesPromise.then(() => context.dispatch('setupBreadcrumbs', { product: product })) // if this is client's side request postpone breadcrumbs setup till attributes are loaded to avoid too-early breadcrumb switch #2469
}
```

åªæ˜¯ä¸ºäº†ç¡®ä¿åœ¨å‘ˆç° PDPï¼ˆäº§å“è¯¦ç»†ä¿¡æ¯é¡µé¢ï¼‰ä¹‹å‰å§‹ç»ˆè¿›è¡Œå±æ€§è¿‡æ»¤ã€‚





## [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_5-how-vue-storefront-calculates-prices-and-taxes)5. Vue Storefront å¦‚ä½•è®¡ç®—ä»·æ ¼å’Œç¨æ”¶

### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#protip-5)ä¸“å®¶æç¤º

#### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_1-two-modes-for-tax-calculation)1. ä¸¤ç§è®¡ç¨æ–¹å¼

Vue Storefront æœ‰ä¸¤ç§è®¡ç®—äº§å“ä»·æ ¼çš„æ¨¡å¼ï¼š

- å®¢æˆ·ç«¯ï¼ˆ`config.tax.calculateServerSide`è®¾ç½®ä¸º æ—¶`false`ï¼‰- å¦‚æœåº”æ ¹æ®åœ°å€æ›´æ”¹é‡æ–°è®¡ç®—ç¨æ¬¾ï¼Œè¿™å¯èƒ½å¾ˆæœ‰ç”¨ã€‚
- æœåŠ¡å™¨ç«¯ï¼ˆ`config.tax.calculateServerSide`è®¾ç½®ä¸º æ—¶`true`ï¼‰ - è¿™æ˜¯é»˜è®¤è®¾ç½®ã€‚

æ ¹æ®æ¨¡å¼ï¼Œç¨ç”±[`taxCalc.ts`å®¢æˆ·ç«¯è®¡ç®— ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/5f2b5cd6a8496a60884c091e8509d3b58b7a0358/core/modules/catalog/helpers/taxCalc.ts#L74)æˆ–[`taxcalc.js`æœåŠ¡å™¨ç«¯ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront-api/blob/d3d0e7892cd063bbd69e545f3f2b6fdd9843d524/src/lib/taxcalc.js#L251-L253).

æ‚¨å¯èƒ½ä¼šçœ‹åˆ°è¿™ä¸¤ä¸ªæ–‡ä»¶åº”ç”¨**å®Œå…¨ç›¸åŒ**çš„é€»è¾‘ã€‚

#### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_2-factors-considered-for-tax-rate)2. ç¨ç‡è€ƒè™‘å› ç´ 

ä¸ºäº†è®¡ç®—ä»·æ ¼å’Œç¨æ”¶ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦è·å¾—é€‚å½“çš„ç¨ç‡ã€‚å®ƒåŸºäº[`taxrate` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront-integration-sdk#taxrate-entity)å®ä½“ï¼Œå­˜å‚¨åœ¨ Elasticsearch ä¸­ã€‚æ¯ä¸ªäº§å“éƒ½å¯ä»¥æœ‰å±æ€§[`product.tax_class_id` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/5f2b5cd6a8496a60884c091e8509d3b58b7a0358/core/modules/catalog/helpers/taxCalc.ts#L213)æ”¾ã€‚æ ¹æ®å…¶ä»·å€¼ï¼ŒVueå…¬å¸åº—é¢åº”ç”¨`taxrate`åŠ[å›½å®¶å’Œåœ°åŒºçš„è¿‡æ»¤å™¨ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/5f2b5cd6a8496a60884c091e8509d3b58b7a0358/core/modules/catalog/helpers/taxCalc.ts#L226).

ç¬”è®°

æˆ‘ä»¬ç›®å‰ä¸æ”¯æŒé€šè¿‡æœç´¢æ—¢ä¸æ˜¯ç¨æ”¶è§„åˆ™`customer_tax_class_id`ï¼Œä¹Ÿä¸`tax_postcode`é¢†åŸŸ`taxrate`å®ä½“ã€‚éå¸¸æ¬¢è¿æ‹‰å–è¯·æ±‚ ğŸ˜‰

#### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_3-calculation)3. è®¡ç®—

è·å¾—æ­£ç¡®çš„ç¨ç‡åï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—ä»·æ ¼ã€‚

æˆ‘ä»¬åœ¨ VSF ä¸­ä¼˜å…ˆè€ƒè™‘äº†ä»¥ä¸‹ä»·æ ¼å­—æ®µï¼š

- `final_price`- å¦‚æœè®¾ç½®ï¼Œå–å†³äº`config.tax.finalPriceIncludesTax`- å®ƒè¢«è§†ä¸ºæœ€ç»ˆä»·æ ¼æˆ–å‡€æœ€ç»ˆä»·æ ¼ï¼Œ
- `special_price`- å¦‚æœå®ƒè¢«è®¾ç½®å¹¶ä¸”ä½äº`price`å®ƒå°†æ›¿æ¢`price`å¹¶ä¸”è¯¥`price`å€¼å°†è¢«è®¾ç½®åˆ°`original_price`å±æ€§ä¸­ï¼Œ
- `price`- å¦‚æœè®¾ç½®ï¼Œå–å†³äº`config.tax.sourcePriceIncludesTax`- å®ƒè¢«è§†ä¸ºæœ€ç»ˆä»·æ ¼æˆ–å‡€æœ€ç»ˆä»·æ ¼ã€‚

æ ¹æ®`config.tax.finalPriceIncludesTax`å’Œ`config.tax.sourcePriceIncludesTax`è®¾ç½®ï¼ŒVue Storefront è®¡ç®—ä»·æ ¼å¹¶å°†å…¶å­˜å‚¨åˆ°ä»¥ä¸‹å­—æ®µä¸­ã€‚

äº§å“ç‰¹ä»·ï¼š

- `special_price` - å¯é€‰ï¼Œå¦‚æœè®¾ç½® - å®ƒæ€»æ˜¯å‡€ä»·ï¼Œ
- `special_price_incl_tax` - å¯é€‰ï¼Œå¦‚æœè®¾ç½® - å®ƒæ€»æ˜¯ç¨åä»·æ ¼ï¼Œ
- `special_price_tax` - å¯é€‰ï¼Œå¦‚æœè®¾ç½®ä¸ºç¨é¢ã€‚

äº§å“æ­£å¸¸ä»·æ ¼ï¼š

- `price` - éœ€è¦ï¼Œå¦‚æœè®¾ç½® - å®ƒæ€»æ˜¯å‡€ä»·ï¼Œ
- `price_incl_tax` - éœ€è¦ï¼Œå¦‚æœè®¾ç½® - å®ƒæ€»æ˜¯ç¨åä»·æ ¼ï¼Œ
- `price_tax` - å¿…å¡«ï¼Œå¦‚æœè®¾ç½®ä¸ºç¨é¢ï¼Œ

äº§å“æœ€ç»ˆä»·æ ¼ï¼š

- `final_price` - å¯é€‰ï¼Œå¦‚æœè®¾ç½® - å®ƒæ€»æ˜¯å‡€ä»·ï¼Œ
- `final_price_incl_tax` - å¯é€‰ï¼Œå¦‚æœè®¾ç½® - å®ƒæ€»æ˜¯ç¨åä»·æ ¼ï¼Œ
- `final_price_tax` - å¯é€‰ï¼Œå¦‚æœè®¾ç½®ä¸ºç¨é¢ï¼Œ

äº§å“åŸä»·ï¼ˆä»…å½“`final_price`æˆ–`special_price`ä½äº æ—¶è®¾ç½®`price`ï¼‰ï¼š

- `original_price` - å¯é€‰ï¼Œå¦‚æœè®¾ç½® - å®ƒæ€»æ˜¯å‡€ä»·ï¼Œ
- `original_price_incl_tax` - å¯é€‰ï¼Œå¦‚æœè®¾ç½® - å®ƒæ€»æ˜¯ç¨åä»·æ ¼ï¼Œ
- `original_price_tax` - å¯é€‰ï¼Œå¦‚æœè®¾ç½®ä¸ºç¨é¢ã€‚

ç¬”è®°

ä»·æ ¼`configurable_children`ä»¥å®Œå…¨ç›¸åŒçš„æ ¼å¼ä¸ºæ‰€æœ‰äººè®¾å®š

ç¬”è®°

å¦‚æœå…¶ä¸­ä»»ä½•`configurable_children`ä¸€ä¸ªä»·æ ¼ä½äºä¸»äº§å“ï¼Œä¸»äº§å“ä»·æ ¼å°†ç›¸åº”æ›´æ–°ã€‚





## [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_6-limiting-ssr-html-size-a-k-a-initial-state-optimization)6. é™åˆ¶ SSR HTML å¤§å°ï¼Œå³ INITIAL_STATE ä¼˜åŒ–

[æœåŠ¡å™¨ç«¯æ¸²æŸ“](https://vuejs.org/v2/guide/ssr.html)çš„ä¸»è¦å‰¯ä½œç”¨ä¹‹ä¸€[ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://vuejs.org/v2/guide/ssr.html)æ˜¯éœ€è¦åœ¨é¡µé¢æ°´åˆä¹‹å‰å‘æµè§ˆå™¨æä¾›åˆå§‹ Vuex çŠ¶æ€ã€‚

Hydration æ„å‘³ç€ - Vue.js ä½¿ç”¨è™šæ‹Ÿç”Ÿæˆçš„ (CSR) Vue.js ç»„ä»¶æ ‘å¡«å……é™æ€ç”Ÿæˆçš„ HTML æ ‡è®°ã€‚**åªæœ‰ç»è¿‡è¿™ä¸ªè¿‡ç¨‹ï¼Œç½‘ç«™æ‰æˆä¸ºäº’åŠ¨çš„**ã€‚å³ä½¿æ ‡è®°ç•¥æœ‰ä¸åŒï¼Œä¹Ÿå¯èƒ½å¯¼è‡´ SSR æ°´åˆé”™è¯¯ã€‚å› æ­¤ï¼ŒVue.js è¦æ±‚æˆ‘ä»¬[è¾“å‡º`window.__INITIAL_STATE__` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/8f3ce717a823ef3a5c7469082b8a8bcb36abb5c1/core/client-entry.ts#L29)ç„¶åç”¨äº**æ›¿æ¢**Vuex åˆå§‹çŠ¶æ€ã€‚ç„¶åï¼Œ[åº”ç”¨ç¨‹åºå˜å¾—æ°´æ¶¦ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/develop/core/client-entry.ts#L111)é€šè¿‡`app.mount()`ç”µè¯ã€‚

å”¯ä¸€çš„é—®é¢˜æ˜¯ï¼Œè¿™`__INITIAL_STATE__`çœŸçš„å¾ˆ huuuuuuugeã€‚åœ¨ç±»åˆ«é¡µé¢ä¸Šï¼ŒåŒ…æ‹¬è®¸å¤šäº§å“åˆ—è¡¨ï¼Œå®ƒå¯ä»¥ä»¥å…†å­—èŠ‚ä¸ºå•ä½ï¼Vue Storefront ä¸ºæ‚¨æä¾›äº†ä¸€äº›æ§åˆ¶åˆå§‹çŠ¶æ€çš„æœºåˆ¶ã€‚

### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#protip-6)ä¸“å®¶æç¤º

#### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_1-filter-initial-state)1.è¿‡æ»¤ `__INITIAL_STATE__`

1. Vue Storefront ä¸ºæ‚¨æä¾›äº†ä¸€ç§æœºåˆ¶æ¥æ§åˆ¶`__INITIAL_STATE__` [åŸºäº`config.ssr.initialStateFilter` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/8f3ce717a823ef3a5c7469082b8a8bcb36abb5c1/core/scripts/utils/ssr-renderer.js#L40)å­—æ®µåˆ—è¡¨ã€‚å› æ­¤ï¼Œæ‚¨å¯ä»¥ä»ä¸­åˆ é™¤å­—æ®µ`__INITIAL_STATE__`- å³ä½¿ä½¿ç”¨`.`ç¬¦å·ã€‚å› æ­¤ï¼Œæ‚¨å¯ä»¥`attribute`åŠ å…¥åˆ—è¡¨ä»¥åˆ é™¤`attribute`Vuex æ¨¡å—çš„æ•´ä¸ªçŠ¶æ€ï¼Œæˆ–è€…æ‚¨å¯ä»¥æŒ‡å®š`attribute.list_by_code`ä»…åˆ é™¤è¯¥çŠ¶æ€ã€‚é€šè¿‡ä½¿ç”¨è¿™ç§æœºåˆ¶ï¼Œæ‚¨å¯ä»¥åœ¨ SSR ä¸­å¤„ç†æ¯”å‘é€åˆ°æµè§ˆå™¨æ›´å¤šçš„æ•°æ®ï¼ˆå‚è§ç¬¬ 2 ç‚¹ï¼Œå®ƒä¸é™åˆ¶å¤„ç†ä¿¡æ¯é›†çš„æ–¹æ³•æ­£å¥½ç›¸åï¼‰ã€‚
2. æ‚¨å¯èƒ½è¿˜æƒ³ä½¿ç”¨ [`config.entities.*.includeFields` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/8f3ce717a823ef3a5c7469082b8a8bcb36abb5c1/config/default.json#L170)ç­›é€‰ã€‚è¿™äº›å­—æ®µåˆ—è¡¨è®¾ç½®ä¸ºé™åˆ¶[ä» Elasticsearch åŠ è½½](https://github.com/vuestorefront/vue-storefront/blob/8f3ce717a823ef3a5c7469082b8a8bcb36abb5c1/core/lib/search.ts#L31)çš„å­—æ®µæ•°[ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/8f3ce717a823ef3a5c7469082b8a8bcb36abb5c1/core/lib/search.ts#L31). ä½†æ˜¯ï¼Œå¦‚æœæ‚¨å‘å®ä½“æ·»åŠ ä»»ä½•æ–°å­—æ®µï¼Œè¯·ç¡®ä¿æ‚¨ä¹Ÿå°†å…¶åŒ…å«åœ¨`includeFields`åˆ—è¡¨ä¸­ã€‚

è­¦å‘Š

æœ‰äº†è¿™äº›æœºåˆ¶ï¼Œæ‚¨å¿…é¡»å……åˆ†æ„è¯†åˆ°å®ƒä»¬å¯èƒ½é€ æˆçš„**æ°´åˆä½œç”¨æŸå®³**ã€‚ä¸ºäº†é˜²æ­¢ä»»ä½•æ°´åˆä½œç”¨é—®é¢˜ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨[`lazy-hydrate` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/maoberlehner/vue-lazy-hydration)è¿™å°†è®©æ‚¨æ§åˆ¶é¡µé¢ä¸Šç‰¹å®šéƒ¨ä»¶ï¼ˆç»„ä»¶ï¼‰çš„æ°´åŒ–æµã€‚å°¤å…¶æ˜¯[æ‰‹åŠ¨è¡¥æ°´ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/maoberlehner/vue-lazy-hydration#manually-trigger-hydration)å¯èƒ½æœ‰ç”¨ã€‚

ä¸€èˆ¬çš„ç»éªŒæ³•åˆ™æ˜¯ï¼Œ**å½“æ‚¨ä»åˆå§‹çŠ¶æ€ä¸­åˆ é™¤ä»»ä½•å†…å®¹æ—¶ï¼Œ**æ‚¨åº”è¯¥ï¼š

- å°½å¿«åœ¨å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ in `beforeMount`ï¼‰åŠ è½½æ­¤æ•°æ®ã€‚
- **ä»…åœ¨**åŠ è½½æ•°æ®**åæ‰**å¯¹ç»„ä»¶è¿›è¡Œæ°´åˆã€‚

### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_2-best-practice-for-hydration-from-core-team)2. æ ¸å¿ƒå›¢é˜Ÿè¡¥æ°´æœ€ä½³å®è·µ

çœ‹çœ‹æˆ‘ä»¬æ˜¯å¦‚ä½•åšåˆ°çš„ [`Category.vue` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/ab27bfbd8abef5f1d37666a38fa0387f50ba6eca/src/themes/default/pages/Category.vue#L70)- æ°´åˆä½œç”¨æ˜¯ç”±æ‰‹åŠ¨è§¦å‘çš„ [`loading` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/ab27bfbd8abef5f1d37666a38fa0387f50ba6eca/src/themes/default/pages/Category.vue#L70)æ——å¸œã€‚

æç¤º

è¯·ç¡®ä¿æ‚¨æ˜¯å¦æ­£åœ¨åŠ¨æ€åŠ è½½ç±»åˆ«æ ‘ - å› ä¸ºåŒ…å«æ‰€æœ‰è¿™äº›å­ç±»åˆ«çš„ç±»åˆ«æ ‘å¯èƒ½çœŸçš„å¾ˆé‡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒVue Storefront[ä» v1.7](https://docs.vuestorefront.io/v1/guide/basics/configuration.html#dynamic-categories-prefetching)æä¾›è¿™ç§[åŠ¨æ€ç±»åˆ«é¢„å–](https://docs.vuestorefront.io/v1/guide/basics/configuration.html#dynamic-categories-prefetching)ã€‚

æ‚¨æœ€å¤šå¯ä»¥èŠ‚çœ 30-40% çš„é¡µé¢å¤§å°ï¼Œä»è€Œç§¯ææé«˜ Lighthouse/Pagespeed åˆ†æ•°ã€‚ç„¶è€Œå¹¶ä¸æ€»æ˜¯èƒ½æ”¹å–„ç”¨æˆ·ä½“éªŒâ€”â€”å› ä¸ºæ‡’æƒ°é€šå¸¸éœ€è¦æ‚¨é€šè¿‡å¦ä¸€ä¸ªç½‘ç»œè°ƒç”¨è·å–æ‰€éœ€çš„æ•°æ®ï¼ˆå¯ä»¥é€šè¿‡åˆå§‹çŠ¶æ€æœºåˆ¶è·³è¿‡ï¼‰ã€‚

å½“ç„¶ï¼Œæœ€åè¯·ç¡®ä¿æ‚¨å‹ç¼© (gzip + minify) SSR è¾“å‡º - å¯èƒ½åœ¨[nginx çº§åˆ« ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://www.digitalocean.com/community/tutorials/how-to-increase-pagespeed-score-by-changing-your-nginx-configuration-on-ubuntu-16-04)æˆ–ä½¿ç”¨[å‹ç¼© ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://www.npmjs.com/package/compression)å’Œ/æˆ–[ç¼©å° ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://www.npmjs.com/package/express-minify)ä¸­é—´ä»¶æ·»åŠ åˆ° [`core/scripts/server.js`ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/8f3ce717a823ef3a5c7469082b8a8bcb36abb5c1/core/scripts/server.js#L116)



## [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_7-url-dispatcher-explained)7. Url Dispatcher è§£é‡Š

ä» Vue Storefront 1.9 å¼€å§‹ï¼Œæˆ‘ä»¬æ”¯æŒ[è‡ªå®šä¹‰ url ç»“æ„ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://docs.vuestorefront.io/guide/basics/url.html). `UrlDispatcher`åœ¨é»˜è®¤æƒ…å†µä¸‹å¯ç”¨[`config.seo.useUrlDispatcher` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/3e4191e5e4b1bfc5b349f5d7cff919c695168125/config/default.json#L29).

è°ƒåº¦å™¨çš„ä¸šåŠ¡é€»è¾‘å·²ç»å®ç°ä¸º[Vueè·¯ç”±å™¨å®ˆå« ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://router.vuejs.org/guide/advanced/navigation-guards.html)â€”â€” [`beforeEach` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/3e4191e5e4b1bfc5b349f5d7cff919c695168125/core/modules/url/router/beforeEach.ts#L41).

è°ƒåº¦å‘˜é¦–å…ˆè¿è¡Œ [`url/mapUrl` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/3e4191e5e4b1bfc5b349f5d7cff919c695168125/core/modules/url/store/actions.ts#L42). æ­¤æ“ä½œé¦–å…ˆæ£€æŸ¥`state.dispatcherMap`ä¹‹å‰æ³¨å†Œçš„ URL æ˜ å°„ã€‚å¦‚æœæœªè®¾ç½®æ˜ å°„ï¼Œåˆ™è°ƒåº¦ç¨‹åºæ£€æŸ¥[`localStorage`ç¼“å­˜ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/3e4191e5e4b1bfc5b349f5d7cff919c695168125/core/modules/url/store/actions.ts#L51)åªæœ‰åœ¨æ­¤ä¹‹å`mappingFallback`æ‰ä¼šè°ƒç”¨è¯¥æ“ä½œã€‚

è¿™æ˜¯çœŸæ­£æ˜ å°„å‘ç”Ÿçš„åœ°æ–¹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒVue Storefront é¦–å…ˆæ ¹æ® Elasticsearch`product`å®ä½“æ£€æŸ¥ URL - ä½¿ç”¨`url_path`ä½œä¸ºè¿‡æ»¤å™¨ã€‚å¦‚æœæœªæ‰¾åˆ°ï¼ˆç»Ÿè®¡ä¸Šï¼Œç”±äºäº§å“æ•°é‡çš„åŸå› ï¼Œäº§å“é€šè¿‡ URL æµè§ˆçš„é¢‘ç‡æ˜¯ç±»åˆ«çš„ 10 å€ï¼‰ï¼Œåˆ™å‘å‡º`category`æ”¶é›†è¯·æ±‚ã€‚

ä¸€æ—¦è·¯çº¿è¢«æ˜ å°„ï¼Œå®ƒå°±ä¼šè¢«[æ³¨å†Œ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/3e4191e5e4b1bfc5b349f5d7cff919c695168125/core/modules/url/store/actions.ts#L56)åœ¨`dispatcherMap`ä»¥ä¸æ‰§è¡Œåœ¨æœªæ¥æ›´å¤šçš„ç½‘ç»œè¯·æ±‚ã€‚

ä¼˜åŒ–æŠ€å·§æ˜¯ [`category-next/loadCategoryProducts` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/3e4191e5e4b1bfc5b349f5d7cff919c695168125/core/modules/catalog-next/store/category/actions.ts#L100)å·²ç»æ³¨å†Œäº†æ˜ å°„ - å› æ­¤ä»ç±»åˆ«åˆ—è¡¨ä¸­å•å‡»äº§å“ä¸éœ€è¦ä»»ä½•ç½‘ç»œè°ƒç”¨æ¥è·å–æ­£ç¡®çš„è·¯çº¿æ•°æ®ã€‚

æ­£å¦‚æ‚¨å¯èƒ½å·²ç»çœ‹åˆ°çš„é‚£æ ·ï¼Œ`url/mapUrl`è¿”å›æ•°æ®çš„æ ¼å¼ä¸ vue-router ä½¿ç”¨çš„è·¯ç”±é›†åˆéå¸¸ç›¸ä¼¼ã€‚**ä¸è¿‡ï¼Œè¿™ä¸æ˜¯çœŸæ­£çš„è·¯çº¿**ã€‚åœ¨ç”±è·¯ç”±å™¨æœ¬èº«å¤„ç†ä¹‹å‰ï¼Œå®ƒ`Route`ç”±`processDynamicRoute`åŠ©æ‰‹è½¬æ¢ä¸ºå¯¹è±¡ã€‚ä¸ºäº†é¿å…æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨çš„ä»»ä½•ç”¨æˆ·é‡å®šå‘`RouterManager`åˆ°[è¯¥è·¯ç”±æ·»åŠ åˆ°`vue-router`è·¯ç”±è¡¨ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/3e4191e5e4b1bfc5b349f5d7cff919c695168125/core/modules/url/router/beforeEach.ts#L43)å¹¶å°†ç”¨æˆ·è½¬å‘åˆ°è¿™ä¸ªæ–°çš„ã€å®Œå…¨åŒ¹é…çš„è·¯ç”±ä»¥å‘ˆç°æ­£ç¡®çš„é¡µé¢ã€‚

è¿™ç§æœºåˆ¶éå¸¸çµæ´»ï¼Œå› ä¸ºæ‚¨å¯ä»¥å³æ—¶æ·»åŠ åŠ¨æ€è·¯ç”±ã€‚ç”šè‡³è¿˜æœ‰ä¸€ä¸ª[ç¤¾åŒºæ¨¡å— ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/kodbruket/vsf-mapping-fallback)è®©æ‚¨ä»¥ç¼–ç¨‹æ–¹å¼æ˜ å°„ url è·¯ç”±ã€‚

ç¬”è®°

è¿™ [`processDynamicRoute` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/3e4191e5e4b1bfc5b349f5d7cff919c695168125/core/modules/url/helpers/index.ts#L26)ç¡®å®å°†`routeData`fromè½¬æ¢`url/mapUrl`ä¸º**çœŸæ­£çš„**vue`Route`å¯¹è±¡ã€‚å®ƒçš„å·¥ä½œåŸç†å°±åƒæœç´¢æ‰€æœ‰ç”±`theme`å’Œæ³¨å†Œçš„è·¯ç”±`modules`ã€‚ä¾‹å­ï¼š

å¦‚æœæ‚¨çš„è·¯çº¿æ•°æ®æ˜¯ ( `routeData`)ï¼š

```js
{
  name: 'configurable-product',
  params: {
    slug: product.slug,
    parentSku: product.sku,
    childSku: params['childSku'] ? params['childSku'] : product.sku
}
```

å¹¶ä¸”æ‚¨`theme/router/index.js`çš„å®šä¹‰åŒ…å«ä»¥ä¸‹å®šä¹‰ï¼š( `userRoute`)

```js
  { name: 'configurable-product', path: '/p/:parentSku/:slug/:childSku', component: Product }
```

ç„¶å`processDynamicRoute`åŠ©æ‰‹å°†è¿”å›`Route`é€šè¿‡åˆå¹¶`userRoute`ä¸åˆ›å»ºçš„å¯¹è±¡`routeData`

```js
  Object.assign({}, userRoute, routeData, { path: '/' + fullRootPath, name: `urldispatcher-${fullRootPath}` })
```

`fullRootPath`æ˜¯è°ƒåº¦ç¨‹åºå¤„ç†çš„ urlã€‚è¿™ä¸ªæ–°çš„è™šæ‹Ÿè·¯ç”±è¢«æ·»åŠ åˆ° vue-router è·¯ç”±è¡¨ä¸­ï¼Œç”¨æˆ·è¢«è½¬å‘åˆ°å®ƒã€‚å› æ­¤ï¼Œæ‚¨å¯èƒ½ä¼šçœ‹åˆ°è¯¥`url`æ¨¡å—å¯ä»¥è½»æ¾æ‰“å¼€/å…³é—­ï¼Œå› ä¸ºå®ƒä½¿ç”¨ç°æœ‰ vue-router ä¸Šçš„é¡¶éƒ¨æœºåˆ¶ - å°†è™šæ‹Ÿ url æ˜ å°„åˆ°ç°æœ‰ä¸»é¢˜æˆ–æ¨¡å—è·¯ç”±ã€‚

ç¬”è®°

ä¸ºäº†è®©å®ƒå¯åŠ¨å¹¶è¿è¡Œï¼Œè¯·ç¡®ä¿æ‚¨çš„`products`å’Œ`categories`ç¡®å®æœ‰`url_path`æ­£ç¡®çš„è®¾ç½®å’Œç‹¬ç‰¹çš„ã€‚





## [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_8-multistore-configuration-explained)8. Multistore é…ç½®è¯´æ˜

æ‚¨å¯ä»¥[åœ¨å®˜æ–¹æ–‡æ¡£ä¸­](https://docs.vuestorefront.io/v1/guide/integrations/multistore.html#changing-the-ui-for-specific-store-views)äº†è§£[åŸºæœ¬çš„ Multistore é…ç½®](https://docs.vuestorefront.io/v1/guide/integrations/multistore.html#changing-the-ui-for-specific-store-views)ã€‚Vue Storefront æ”¯æŒåŸºäº`StoreView`çº§åˆ«çš„å¤šåº—ã€‚

`StoreView` æ˜¯ä¸€ä¸ªé…ç½®ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œç”± Vue Storefront ä¸ºæ¯ä¸ªè¯·æ±‚è®¾ç½® - å¯é€šè¿‡ [`currentStoreView()` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/9dca392a832ba45e9b1c3589eb84f51fbc2e8d6e/core/lib/multistore.ts#L33)å¸®æ‰‹æ¥è‡ª [`multistore.ts` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/develop/core/lib/multistore.ts).

ä¸€ç§`StoreView`é€šå¸¸æ„å‘³ç€è¯­è¨€ + è´§å¸çš„ç»„åˆã€‚

ä¾‹å­

å¦‚æœæ‚¨åœ¨æ¯ä¸ªå›½å®¶/åœ°åŒºéƒ½æœ‰ä¸€å®¶æ”¯æŒä¸¤ç§è¯­è¨€çš„å•†åº—ï¼ˆä¾‹å¦‚ç‘å£«æ”¯æŒæ¬§å…ƒè´§å¸ä»¥åŠæ³•è¯­ + å¾·è¯­ï¼‰ï¼Œæ‚¨æœ€ç»ˆå¯èƒ½ä¼šå¾—åˆ°ä¸€å¯¹ä¸¤ä¸ª`StoreViews`ï¼š(EUR; DE) + (EUR; FR)ã€‚æ¯ä¸ª`StoreView`éƒ½æœ‰è‡ªå·±çš„å”¯ä¸€åç§°ï¼Œç”¨äºåŒºåˆ†å’Œåˆ‡æ¢ç«™ç‚¹ã€‚

Vue Storefront`StoreViews`å…è®¸æ‚¨åŒºåˆ†æ¯ä¸ªç‰¹å®šç«™ç‚¹çš„æ‰€æœ‰åŸºæœ¬è®¾ç½®ã€‚[æŸ¥çœ‹é…ç½® ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/af640f3aa0372308db534786fea587b24e8e87d3/config/default.json#L91)ï¼š

```json
 "storeViews": {
      "multistore": false,
      "commonCache": true,
      "mapStoreUrlsFor": ["de", "it"],
      "de": {
        "storeCode": "de",
        "disabled": true,
        "storeId": 3,
        "name": "German Store",
        "url": "/de",
        "appendStoreCode": true,
        "elasticsearch": {
          "host": "/api/catalog",
          "index": "vue_storefront_catalog_de"
        },
        "tax": {
          "sourcePriceIncludesTax": false,
          "defaultCountry": "DE",
          "defaultRegion": "",
          "calculateServerSide": true
        },
        "i18n": {
          "fullCountryName": "Germany",
          "fullLanguageName": "German",
          "defaultLanguage": "DE",
          "defaultCountry": "DE",
          "defaultLocale": "de-DE",
          "currencyCode": "EUR",
          "currencySign": "EUR",
          "dateFormat": "HH:mm D-M-YYYY"
        }
      },
      "it": {
        "storeCode": "it",
        "disabled": true,
        "storeId": 4,
        "name": "Italian Store",
        "url": "/it",
        "appendStoreCode": true,
        "elasticsearch": {
          "host": "/api/catalog",
          "index": "vue_storefront_catalog_it"
        },
        "tax": {
          "sourcePriceIncludesTax": false,
          "defaultCountry": "IT",
          "defaultRegion": "",
          "calculateServerSide": true
        },
        "i18n": {
          "fullCountryName": "Italy",
          "fullLanguageName": "Italian",
          "defaultCountry": "IT",
          "defaultLanguage": "IT",
          "defaultLocale": "it-IT",
          "currencyCode": "EUR",
          "currencySign": "EUR",
          "dateFormat": "HH:mm D-M-YYYY"
        }
      }
    }
```

### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#protip-7)ä¸“å®¶æç¤º

#### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_1-create-the-individual-indexes-per-each-specific-storeview)1. ä¸ºæ¯ä¸ªç‰¹å®šåˆ›å»ºå•ç‹¬çš„ç´¢å¼• `StoreView`

é¦–å…ˆ - æ¯ä¸ª storeView éƒ½æœ‰ä¸€ä¸ªå•ç‹¬çš„ Elasticsearch é…ç½®ã€‚è¿™æ„å‘³ç€æ‚¨å¯ä»¥ç¿»è¯‘å’Œå­˜å‚¨`product`,`categories`å’Œ`attributes`text å±æ€§ - æ¯ä¸ªå±æ€§éƒ½åœ¨å•ç‹¬çš„ Elasticsearch ç´¢å¼•ä¸­ã€‚

æˆ‘ä»¬çš„[é»˜è®¤ç´¢å¼•å™¨ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/mage2vuestorefront#multistore-setup)å’Œ[magento2-vsbridge-indexer ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/magento2-vsbridge-indexer)ä¸¤è€…éƒ½æ”¯æŒå¤šå­˜å‚¨ç´¢å¼•ã€‚

#### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_2-setup-the-storeviews-section-in-the-config-local-json)2.è®¾ç½®`storeViews`éƒ¨åˆ†`config/local.json`

æ¯ä¸ª*storeView*å¿…é¡»æœ‰ç‹¬ç‰¹çš„`code`ï¼ˆ`it`å’Œ`de`åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼‰ç»„+ elasticsearchéƒ¨æŒ‡å‘ç›¸åº”ç´¢å¼•ã€‚

ç¬”è®°

è¯·è®°ä½[åœ¨](https://github.com/vuestorefront/vue-storefront-api/blob/b4198929ef435e20162a192ea2a02cb25e552d45/config/default.json#L50)[é…ç½®æ–‡ä»¶ä¸­](https://github.com/vuestorefront/vue-storefront-api/blob/b4198929ef435e20162a192ea2a02cb25e552d45/config/default.json#L50)å¡«å……ç›¸åŒçš„é…ç½®[`vue-storefront-api` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront-api/blob/b4198929ef435e20162a192ea2a02cb25e552d45/config/default.json#L50). è¯·ç¡®ä¿è¯¥`config.availableStores`é›†åˆä¹ŸåŒ…å«`storeCodes`æ‚¨å°†ä¼ é€’ç»™ API çš„æ‰€æœ‰å†…å®¹ã€‚

ç¬”è®°

ä»…å½“`config.storeViews.multistore`è®¾ç½®ä¸º`true`ï¼ˆé»˜è®¤å€¼ä¸ºï¼šï¼‰æ—¶æ‰åº”ç”¨å¤šå•†åº—ä¸šåŠ¡é€»è¾‘`false`ã€‚

è¯¥`storeCode`å‚æ•°[å°†ä½œä¸ºæŸ¥è¯¢å‚æ•° ( `?storeCode`) ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/9dca392a832ba45e9b1c3589eb84f51fbc2e8d6e/core/lib/multistore.ts#L105)åˆ°æ‰€æœ‰`vue-storefront-api`è®© API çŸ¥é“è¦æŸ¥è¯¢å“ªä¸ªåç«¯ API ç«¯ç‚¹çš„è¯·æ±‚ã€‚é»˜è®¤æƒ…å†µä¸‹ - åœ¨ Magento 2 ä¸­ï¼Œ[æˆ‘ä»¬å°†é€‚å½“çš„æ·»åŠ `storeCode`åˆ° API è¯·æ±‚è°ƒç”¨ä¸­ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront-api/blob/b4198929ef435e20162a192ea2a02cb25e552d45/src/platform/magento2/util.js#L7). ä½†æ˜¯ï¼Œ[å¦‚æœæ‚¨æ„¿æ„ï¼Œ](https://github.com/vuestorefront/vue-storefront-api/blob/b4198929ef435e20162a192ea2a02cb25e552d45/src/platform/magento2/util.js#L20)æ‚¨ç”šè‡³å¯ä»¥[åŒºåˆ†åŸºæœ¬ url æˆ– Magento 2 API å‡­æ® ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront-api/blob/b4198929ef435e20162a192ea2a02cb25e552d45/src/platform/magento2/util.js#L20).

#### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_3-vue-storefront-storecode-resolver)3.Vue Storefront`storeCode`è§£æå™¨

Vue Storefront å°†`currentStoreView`valueè®¾ç½®ä¸ºå¤„ç†è¯·æ±‚çš„ç¬¬ä¸€ä»¶äº‹ã€‚å®ƒæ˜¯åœ¨[`app.ts:createStore` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/af640f3aa0372308db534786fea587b24e8e87d3/core/app.ts#L73)åŠŸèƒ½ã€‚åœ¨`storeCode`ä»retrived[æœåŠ¡å™¨ä¸Šä¸‹æ–‡ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/af640f3aa0372308db534786fea587b24e8e87d3/core/server-entry.ts#L63)æˆ–[ä»å½“å‰è·¯çº¿ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/af640f3aa0372308db534786fea587b24e8e87d3/core/server-entry.ts#L67).

è¿™ [`storeCodeFromRoute` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/develop/core/lib/storeCodeFromRoute.ts)helper æ”¯æŒä¸¤ç§è·å–å½“å‰åº—é“ºä»£ç çš„æ–¹å¼ï¼š

1. ä» url è·¯å¾„ï¼šhttps://test.storefrontcloud.io/de vs. https://test.storefrontcloud.io/it
2. ä»[urlåŸŸåå’Œè·¯å¾„ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/9dca392a832ba45e9b1c3589eb84f51fbc2e8d6e/core/lib/storeCodeFromRoute.ts#L30); é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ‚¨å¯ä»¥åœ¨å¤šä¸ªåŸŸä¸Šè¿è¡Œ Vue Storefront multistoreã€‚

ç¬”è®°

æ‚¨ä¹Ÿå¯ä»¥ä¼ é€’`storeCode`via æœåŠ¡å™¨ä¸Šä¸‹æ–‡ã€‚æœåŠ¡å™¨ä¸Šä¸‹æ–‡ç”±[`core/scripts/server.ts` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/9dca392a832ba45e9b1c3589eb84f51fbc2e8d6e/core/scripts/utils/ssr-renderer.js#L110)- å®ƒæ¥è‡ª`ENV.STORE_CODE`æˆ–è€…å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ HTTP ä»£ç†ï¼ˆå¦‚ nginxï¼‰ - æ¥è‡ª`x-vs-store-code`. é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ‚¨å¯ä»¥é€šè¿‡å¤šç§ä¸åŒçš„æ–¹å¼æ¥åŒºåˆ†å•†åº—è§†å›¾å®ä¾‹ï¼Œè€Œä¸ä»…ä»…æ˜¯é€šè¿‡åŸŸ/urlã€‚

#### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_4-routing)4. è·¯ç”±

Vue Storefront ä½¿ç”¨[å½“å‰](https://github.com/vuestorefront/vue-storefront/blob/9dca392a832ba45e9b1c3589eb84f51fbc2e8d6e/src/themes/default/index.js#L31)[ä»£ç å‰ç¼€](https://github.com/vuestorefront/vue-storefront/blob/9dca392a832ba45e9b1c3589eb84f51fbc2e8d6e/src/themes/default/index.js#L31)å°†æ‰€æœ‰è·¯ç”±æ·»åŠ åˆ°è·¯ç”±è¡¨ä¸­[`storeView` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/9dca392a832ba45e9b1c3589eb84f51fbc2e8d6e/src/themes/default/index.js#L31). å¦‚æœä½ çš„[ä¸»é¢˜/è·¯ç”±å™¨/index.js ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/develop/src/themes/default/router/index.js)å®šä¹‰äº†ä»¥ä¸‹è·¯ç”±ï¼Œå¹¶ä¸” `currentStoreVioew().storeCode === 'de'`

```js
 let routes = [
  { name: 'checkout', path: '/checkout', component: Checkout },
  { name: 'legal', path: '/legal', component: Static, props: {page: 'lorem', title: 'Legal Notice'}, meta: {title: 'Legal Notice', description: 'Legal Notice - example of description usage'} },
  { name: 'privacy', path: '/privacy', component: Static, props: {page: 'lorem', title: 'Privacy'} },
```

é‚£ä¹ˆ [`setupMultistoreRoutes` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/9dca392a832ba45e9b1c3589eb84f51fbc2e8d6e/core/lib/multistore.ts#L172)helper å°†è¿™äº›è·¯ç”±æ·»åŠ åˆ°`vue-router`ï¼š

```js
 let routes = [
  { name: 'checkout', path: '/de/checkout', component: Checkout },
  { name: 'legal', path: '/de/legal', component: Static, props: {page: 'lorem', title: 'Legal Notice'}, meta: {title: 'Legal Notice', description: 'Legal Notice - example of description usage'} },
  { name: 'privacy', path: '/de/privacy', component: Static, props: {page: 'lorem', title: 'Privacy'} },
```

ä¿®æ”¹è·¯ç”±é…ç½®çš„ä¸šåŠ¡é€»è¾‘åµŒå…¥åœ¨ [`localizedRouteConfig` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/9dca392a832ba45e9b1c3589eb84f51fbc2e8d6e/core/lib/multistore.ts#L189)å¸®æ‰‹ã€‚

ç¬”è®°

å½“æ‚¨ä½¿ç”¨çš„`storeCode`è§£æå™¨ï¼ŒåŸºäº`domain + path`æ¨¡å¼ï¼Œé‚£ä¹ˆä½ åº”è¯¥å°†`config.storeViews.*.appendStoreCode`åˆ°`false`ã€‚æ­¤é€‰é¡¹å¯é˜²æ­¢`localizedRouteConfig`å¸®åŠ©ç¨‹åºå°† æ·»åŠ `storeCode`ä¸ºè·¯å¾„ï¼Œå› æ­¤å¯ä»¥æ ¹æ®`currentStoreView().url`æ›¿ä»£æ¥åŒºåˆ†å•†åº—è§†å›¾- æ”¯æŒ`domain + path`.

ç¬”è®°

è¯·ç¡®ä¿æ‚¨ä½¿ç”¨ç›¸åŒçš„`localizedRoute`å¸®åŠ©ç¨‹åºåœ¨æ‚¨çš„ä¸»é¢˜ä¸­åˆ›å»ºé“¾æ¥ã€‚æ­¤å¸®åŠ©ç¨‹åºæ”¯æŒå­—ç¬¦ä¸² URLï¼š

```html
<router-link :to="localizedRoute(page.link)" class="cl-accent relative">{{
  page.title
}}</router-link>
```

æˆ–è·¯ç”±å¯¹è±¡ï¼š

```html
<router-link
  :to="
    localizedRoute({
      name: product.type_id + '-product',
      params: {
        parentSku: product.parentSku ? product.parentSku : product.sku,
        slug: product.slug,
        childSku: product.sku,
      },
    })
  "
></router-link>
```

ç¬”è®°

`UrlDispatcher`Vue Storefront 1.9 æä¾›çš„åŠŸèƒ½ä¹Ÿæ”¯æŒå¤šå•†åº—è·¯ç”±ã€‚è¯¥`url_path`å­—æ®µä¼ é€’ç»™[`url/mapUrl` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/9dca392a832ba45e9b1c3589eb84f51fbc2e8d6e/core/modules/url/store/actions.ts#L46)action é‡‡ç”¨å®Œæ•´çš„ url - åŒ…æ‹¬`storeCode`ä½œä¸ºå…¥å£å‚æ•°ã€‚æ‚¨å¯èƒ½æƒ³ä½¿ç”¨[vsf-mapping-fallback ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/kodbruket/vsf-mapping-fallback)å¯¹äºæŸäº›è¦†ç›–ã€‚

#### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_5-customizing-the-theme-per-store-view)5.è‡ªå®šä¹‰æ¯ä¸ªå•†åº—è§†å›¾çš„ä¸»é¢˜

æ‚¨å¯ä»¥`StoreViews`åœ¨ä¸€ä¸ªå•ä¸€çš„ Vue Storefront å®ä¾‹ä¸­è¿è¡Œæ‰€æœ‰è¿™äº›ã€‚è¿™æ˜¯é»˜è®¤æ¨¡å¼ã€‚åœ¨`StoreViews`ç„¶ååŸºäºè¯¥URL /è·¯å¾„/æ¥ç”µè¯·æ±‚å¤´æˆ–é€‰å®šçš„`env`å˜é‡ã€‚å°½å¯èƒ½ç®€å•ï¼Œæ­¤æ¨¡å¼ä¸ä¼šè®©æ‚¨ä¸ºæ¯ä¸ªäººåº”ç”¨å®Œå…¨ä¸åŒçš„ä¸»é¢˜`StoreView`ã€‚è¿™æ˜¯å› ä¸ºä¸»é¢˜æ–‡ä»¶æ†ç»‘åœ¨`app.js`æä¾›ç»™å®¢æˆ·ç«¯çš„æ†ç»‘åŒ…ä¸­ã€‚å°†æ‰€æœ‰ä¸»é¢˜æ†ç»‘åœ¨ä¸€èµ·ä¼šç”Ÿæˆä¸€ä¸ªéå¸¸å¤§çš„ JS åŒ…å¹¶æœ€ç»ˆå‡æ…¢é¡µé¢é€Ÿåº¦ã€‚

æ‚¨ä»ç„¶å¯ä»¥`storeView`ä½¿ç”¨æ¡ä»¶`v-if`é€»è¾‘å’Œåœ¨å•ä¸ªä¸»é¢˜ä¸­åŠ è½½ç‰¹å®šç»„ä»¶æ¥è‡ªå®šä¹‰ä¸€äº› UI å…ƒç´ ã€‚

ç¬”è®°

æ‚¨è¿˜å¯ä»¥é€šè¿‡ç›´æ¥åœ¨è·¯ç”±è¡¨ä¸­æ·»åŠ ç‰¹å®šçš„åŸºäºå•†åº—è§†å›¾çš„ url`pages/Category.vue`æ¥ä¿®æ”¹`theme/router/index.js`è·¯ç”±æ¶æ„æ¥è¦†ç›–ä¸€äº›æ ¹çº§ç»„ä»¶ï¼ˆå¦‚ï¼‰ã€‚

å¦‚æœæ‚¨çœŸçš„éœ€è¦ä¸ºæ¯ä¸ªäººä½¿ç”¨ä¸åŒçš„ä¸»é¢˜`storeView`ï¼Œé‚£ä¹ˆæœ€å¥½çš„æ–¹æ³•æ˜¯ä¸ºæ¯ä¸ªå•†åº—è§†å›¾éƒ¨ç½²å’Œæ‰§è¡Œå•ç‹¬çš„ Vue Storefront èŠ‚ç‚¹å®ä¾‹ï¼ˆä¾‹å¦‚`de`ï¼Œåœ¨ç«¯å£ 3000ã€3001`it`ä¸Šè¿è¡Œç­‰ï¼‰ï¼›ç„¶åç¡®ä¿æ‚¨çš„ä»£ç†æœåŠ¡å°†è¯·æ±‚è·¯ç”±åˆ°æ­£ç¡®çš„å®ä¾‹ã€‚å®ä¾‹å¯ä»¥æœ‰ä¸åŒçš„é…ç½®ï¼ŒåŒ…æ‹¬ä¸åŒçš„`config.theme`å‚æ•°ã€‚

æ‚¨`nginx`å¯¹æ­¤æ–¹æ¡ˆçš„é…ç½®å°†æ˜¯è¿™æ ·çš„ï¼š

```text
ProxyPass / http://localhost:3000/
ProxyPassReverse / http://localhost:3000/

ProxyPass /de http://localhost:3001/de
ProxyPassReverse /de http://localhost:3001/de

ProxyPass /it http://localhost:3002/it
ProxyPassReverse /it http://localhost:3002/it
```





## [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_9-html-minimization-compression-headers)9. HTML æœ€å°åŒ–ã€å‹ç¼©ã€æ ‡é¢˜

Vue Storefront ç”Ÿæˆçš„ HTML å¯ä»¥å¾ˆæ¼‚äº®â€¦â€¦å¾ˆé•¿ ğŸ˜ƒ æˆ‘ä»¬åœ¨è¿™ä¸ªå•ä¸ªæ–‡ä»¶ä¸­æ”¾å…¥äº†å¾ˆå¤š CSS å’Œ JSã€‚ä¸ä»…å¦‚æ­¤ï¼Œ`window.__INITIAL_STATE__`è½¬å‚¨ä¸­è¿˜åŒ…å«æ•´ä¸ª Vuex çŠ¶æ€ï¼Œä»¥æ”¯æŒå®¢æˆ·ç«¯æ•°æ®æ°´åŒ–ã€‚

ä¸ºäº†æœ€å¤§é™åº¦åœ°å‡å°‘æµè§ˆå™¨ä¸‹è½½åˆå§‹ SSR å‘ˆç°çš„ HTML æ‰€éœ€çš„æ—¶é—´ï¼Œæœ‰ä¸€äº›æŠ€å·§éœ€è¦å®ç°ã€‚

### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#protip-8)ä¸“å®¶æç¤º

#### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_1-compression)1. å‹ç¼©

æ‚¨å¯èƒ½å¸Œæœ›åœ¨æ‚¨é€‰æ‹©çš„ç¬¬ä¸€è¡Œ HTTP æœåŠ¡å™¨ä¸­å¯ç”¨`gzip/deflate`æˆ–`brotli`å‹ç¼©ï¼š`nginx`,`varnish`æˆ–`apache`ã€‚å¥½æ¶ˆæ¯æ˜¯ Vue Storefront ä¹Ÿæ”¯æŒ`gzip`ä½¿ç”¨[Express.js ä¸­é—´ä»¶](https://github.com/expressjs/compression)çš„å‹ç¼©[`compression` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/expressjs/compression). å®ƒ[åœ¨ç”Ÿäº§æ¨¡å¼](https://github.com/vuestorefront/vue-storefront/blob/develop/src/modules/compress/server.ts)ä¸‹é»˜è®¤å¯ç”¨[ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/develop/src/modules/compress/server.ts).

#### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_2-html-minimization)2. HTML æœ€å°åŒ–

ç¬¬äºŒç§é€‰æ‹©æ˜¯é€šè¿‡åˆ é™¤ç™½è‰²å­—ç¬¦æ¥æœ€å°åŒ– HTMLã€CSS å’Œ JSã€‚æ­¤é€‰é¡¹é»˜è®¤å¼€å¯ - ç”±[`config.server.useHtmlMinifier` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/5f1e36d611c983de252ce08dea78726b6e10044d/config/default.json#L8)è½¬å˜ã€‚æˆ‘ä»¬ä½¿ç”¨[html-minifier ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://www.npmjs.com/package/html-minifier)npm åŒ…ä»¥ä¾¿åœ¨è¿™é‡Œå®Œæˆå·¥ä½œã€‚æ‚¨å¯èƒ½éœ€è¦è°ƒæ•´[`html-minifier`é…ç½® ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://www.npmjs.com/package/html-minifier#options-quick-reference)é€šè¿‡è°ƒæ•´`config.server.htmlMinifierOptions`å±æ€§ã€‚

#### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_3-headers)3. æ ‡é¢˜

æ‚¨å¯ä»¥è®¾ç½®å„ç§ä¸åŒçš„ HTTP æ ‡å¤´ï¼Œä»¥ä¾¿ä½¿ç”¨ CDN/ä»£ç†è°ƒæ•´è¾¹ç¼˜ç¼“å­˜ç­–ç•¥ã€‚æ‚¨å¯ä»¥åœ¨`asyncData`ä»»ä½•æ ¹çº§ç»„ä»¶çš„ ä¸­è®¾ç½®è¾“å‡ºæ ‡å¤´ã€‚

```js
<script>
export default {
  name: 'RawOutputExample',
  asyncData ({ store, route, context }) {
    context.server.response.setHeader('ETag', 'custom-value')
    context.server.response.setHeader('Cache-Control', 'max-age=533280')
    return new Promise((resolve, reject) => {
      resolve()
    })
  },
  components: {
  }
}
</script>
```





## [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_10-production-catalog-indexing-cache-invalidation)10.ç”Ÿäº§ç›®å½•ç´¢å¼•+ç¼“å­˜å¤±æ•ˆ

è™½ç„¶å¾ˆå¤š Vue Storefornt é¡¹ç›®éƒ½æ˜¯ä½¿ç”¨[mage2vuestorefront](https://github.com/vuestorefront/mage2vuestorefront/tree/master/src)å¼€å‘çš„[ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/mage2vuestorefront/tree/master/src)ç´¢å¼•å™¨ - å®ƒç»å¯¹ä¸æ˜¯ç”Ÿäº§å°±ç»ªçš„è§£å†³æ–¹æ¡ˆã€‚ä¸»è¦æ˜¯å› ä¸ºæ€§èƒ½ï¼Œå®ƒä¸å®Œå…¨æ”¯æŒæŒ‰éœ€ç´¢å¼•ï¼ˆä»…å®æ—¶ç´¢å¼•äº§å“å’Œç±»åˆ«çš„å˜åŒ–ï¼‰ã€‚

ç”±äºè¿™ä¸ªé™åˆ¶ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ç»„[æœ¬åœ°ç´¢å¼•å™¨ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://medium.com/the-vue-storefront-journal/native-magento-data-indexer-aec3c9ebfb).

ç´¢å¼•å™¨å¯ç”¨äºï¼š

- [Magento 1ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/divanteLtd/magento1-vsbridge-indexer)
- [Magento 2ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/magento2-vsbridge-indexer)

æœ¬æœºç´¢å¼•å™¨ä»¥ä¸`mage2vuestorefront`. æˆ‘ä»¬çš„ç›®çš„æ˜¯åŠ å¿«ç´¢å¼•è¿‡ç¨‹å¹¶ä½¿å…¶æ›´å¯é ã€‚é€šè¿‡åŸç”Ÿç´¢å¼•å™¨ï¼Œæˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨ Magento 2 ORM å’Œäº‹ä»¶æ¥ä¼˜åŒ–ç´¢å¼•è¿‡ç¨‹ã€‚`mage2vuestorefront`å¦‚æœæ‚¨é‡åˆ°æœ‰å…³ç´¢å¼•æ€§èƒ½çš„ä»»ä½•é—®é¢˜ï¼Œè¯·åŠ¡å¿…ä½¿ç”¨æ­¤æ¨¡å—ã€‚è¿™ä¸¤ä¸ªé¡¹ç›®ç›®å‰éƒ½å¾—åˆ°äº† Vue Storefront Core å›¢é˜Ÿçš„å®˜æ–¹æ”¯æŒã€‚

å¯ç”¨ SSR ç¼“å­˜åï¼ˆè¯·å‚é˜…[æç¤º 2](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_2-ssr-output-cache)ï¼‰ï¼Œæ‚¨éœ€è¦ç¡®ä¿æ­£ç¡®é…ç½®ç´¢å¼•å™¨ä»¥å‡†ç¡®åˆ·æ–°æ›´æ”¹çš„é¡µé¢ã€‚

æˆ‘ä»¬ç”¨[äº§å“](https://github.com/vuestorefront/vue-storefront/blob/e96bc3c0d1ef8239bc2e64c399f1fe924cebed36/core/modules/catalog/helpers/search.ts#L69)æ ‡è®°è¾“å‡ºé¡µé¢[ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/e96bc3c0d1ef8239bc2e64c399f1fe924cebed36/core/modules/catalog/helpers/search.ts#L69)å’Œ[ç±»åˆ« ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/e96bc3c0d1ef8239bc2e64c399f1fe924cebed36/core/modules/catalog/store/category/actions.ts#L121)æ ‡ç­¾ã€‚ç„¶åæ‰€æœ‰ç´¢å¼•å™¨ï¼ŒåŒ…æ‹¬ï¼š`magento1-vsbridge-indexer`, `mage2vuestorefront`,`magento2-vsbridge-indexer`å°†æ ¹æ®ç‰¹å®šäº§å“æˆ–ç±»åˆ« ID ä½¿ç¼“å­˜æ— æ•ˆã€‚è¿™æ„å‘³ç€ï¼Œè¯¥[`invalidate` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/e96bc3c0d1ef8239bc2e64c399f1fe924cebed36/core/scripts/server.js#L156)æ–¹æ³•å°†æ¸…é™¤æ ‡è®°æœ‰æ­¤ç‰¹å®šäº§å“ ID çš„ç¼“å­˜é¡µé¢ã€‚

ç¬”è®°

æ­¤ URL è¦æ±‚æ‚¨ä¼ é€’[é…ç½®ä¸­](https://github.com/vuestorefront/vue-storefront/blob/e96bc3c0d1ef8239bc2e64c399f1fe924cebed36/config/default.json#L12)è®¾ç½®çš„å¤±æ•ˆä»¤ç‰Œ[ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/e96bc3c0d1ef8239bc2e64c399f1fe924cebed36/config/default.json#L12).

å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨ Varnish ç¼“å­˜ï¼Œåˆ™æ ‡ç­¾å¯ç”¨äºä½¿å…¶æ— æ•ˆã€‚[é˜…è¯»æ›´å¤š ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://www.drupal.org/docs/8/api/cache-api/cache-tags-varnish).

ç¬”è®°

æ‰€æœ‰å®˜æ–¹ Vue Storefront æ•°æ®ç´¢å¼•å™¨ï¼ŒåŒ…æ‹¬[magento1-vsbridge-indexer ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/divanteLtd/magento1-vsbridge-indexer), [magento2-vsbridge-indexer ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/magento2-vsbridge-indexer)æ”¯æŒç¼“å­˜å¤±æ•ˆã€‚å¦‚æœåœ¨ API å’Œ Vue Storefront å‰ç«¯åº”ç”¨ç¨‹åºä¸­éƒ½å¯ç”¨äº†ç¼“å­˜ï¼Œè¯·ç¡®ä¿æ‚¨æ­£ç¡®ä½¿ç”¨äº†`config.server.invalidateCacheForwardUrl`config å˜é‡ï¼Œå› ä¸ºç´¢å¼•å™¨åªèƒ½å°†ç¼“å­˜æ— æ•ˆè¯·æ±‚å‘é€åˆ°ä¸€ä¸ª URLï¼ˆå‰ç«¯æˆ–åç«¯ï¼‰ï¼Œå¹¶ä¸”å®ƒ**åº”è¯¥è¢«è½¬å‘**åˆ°å…¶ä»–ã€‚è¯·æ£€æŸ¥ ä¸­çš„é»˜è®¤è½¬å‘ URL`default.json`å¹¶å°†`key`å‚æ•°è°ƒæ•´ä¸º çš„å€¼`server.invalidateCacheKey`ã€‚





## [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_11-using-magento-checkout)11. ä½¿ç”¨ Magento Checkout

Vue Storefront Checkout å·²å‡†å¤‡å¥½éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ã€‚ç„¶è€Œï¼Œé—®é¢˜æ˜¯ï¼Œä¸ºäº†å®Œæˆï¼Œæ‚¨éœ€è¦**å°† Vue Storefront ä¸æ”¯ä»˜æä¾›å•†é›†æˆ**ã€‚ä¸å¹¸çš„æ˜¯ï¼Œä¸€äº›æµè¡Œçš„ Vue Storefront æ”¯ä»˜æ¨¡å—ï¼ˆ[Stripe ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://forum.vuestorefront.io/t/stripe-payment-integration/155),[æ”¯ä»˜å® ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://forum.vuestorefront.io/t/paypal-payment-integration/152)) ä¸æ”¯æŒ**çŠ¶æ€é€šçŸ¥**æ›´æ”¹ã€‚è¿™ä¸»è¦æ˜¯å› ä¸ºæ”¯ä»˜æ¨¡å—ä¹Ÿä¸**å¹³å°æ— å…³**ã€‚çŠ¶æ€é€šçŸ¥æ›´æ”¹å¿…é¡»ç”±æ‚¨è‡ªå·±å®æ–½ï¼Œå…·ä½“å–å†³äºå¹³å°ã€‚

è¯è™½å¦‚æ­¤ - Checkout é›†æˆçš„å…¶ä»–å¯è¡Œé€‰é¡¹ä¹‹ä¸€æ˜¯[**Magento Checkout Fallback** ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://forum.vuestorefront.io/t/external-checkout/150)æ¨¡å—ï¼Œç”±[Vendic](http://vendic.nl/)ç»´æŠ¤[ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](http://vendic.nl/).

ä½¿ç”¨æ­¤æ¨¡å—æ—¶ï¼Œè¯·ç¡®ä¿æ‚¨å·²æˆåŠŸåˆ†æ´¾`cart/sync`(VSF 1.11)ã€`cart/serverPull`(VSF 1.10) æ“ä½œå¹¶ä¸”åŒæ­¥è¿‡ç¨‹å·²å®Œæˆã€‚å¦åˆ™ï¼Œå¯èƒ½ä¼šå‡ºç°åŒæ­¥å°šæœªå®Œå…¨æ‰§è¡Œä¸”ç”¨æˆ·åœ¨ Magento ç»“è´¦æ—¶å‘ç° Magento å’Œ Vue Storefront è´­ç‰©è½¦ä¹‹é—´å­˜åœ¨ä¸€äº›å·®å¼‚çš„æƒ…å†µã€‚ä¾‹å¦‚ - æ·»åŠ åˆ° VSF è´­ç‰©è½¦çš„äº§å“å°šæœªæ·»åŠ åˆ° Magento è´­ç‰©è½¦ã€‚

ä¸ºé¿å…è¿™ç§æƒ…å†µï¼Œæ‚¨åº”è¯¥ä¿®æ”¹[beforeEach ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/Vendic/vsf-external-checkout/blob/baeefd179038b2bd9b4a1a00c95b82b131b61b65/router/beforeEach.ts#L14)ï¼š

```js
export function beforeEach(to: Route, from: Route, next) {
  const cartToken: string = rootStore.state.cart.cartServerToken;
  const userToken: string = rootStore.state.user.token;
  const externalCheckoutConfig = {...config.externalCheckout};
  const cmsUrl: string = externalCheckoutConfig.cmsUrl;
  const stores = externalCheckoutConfig.stores;
  const storeCode = currentStoreView().storeCode
  const multistoreEnabled: boolean = config.storeViews.multistore

  if (multistoreEnabled) {
    await rootStore.dispatch('cart/sync')
    if (storeCode in stores && to.name === storeCode + '-checkout') {
      window.location.replace(stores[storeCode].cmsUrl + '/vue/cart/sync/token/' + userToken + '/cart/' + cartToken)
    } else if (storeCode in stores && to.name === 'checkout' && stores[storeCode].cmsUrl !== undefined) {
      window.location.replace(stores[storeCode].cmsUrl + '/vue/cart/sync/token/' + userToken + '/cart/' + cartToken)
    } else {
      next()
    }
  } else {
    if (to.name === 'checkout') {
      window.location.replace(cmsUrl + '/vue/cart/sync/token/' + userToken + '/cart/' + cartToken)
    } else {
      next()
    }
  }
}
```





## [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_12-elasticsearch-production-setup)12. Elasticsearch ç”Ÿäº§è®¾ç½®

Elasticsearch æ˜¯ [`vue-storefront-api` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront-api)ä¸­é—´ä»¶æ•°æ®æºã€‚åŒ…å«çš„ Docker æ–‡ä»¶åº”è¯¥åœ¨å¼€å‘æ¨¡å¼ä¸‹ä½¿ç”¨ï¼Œå®ƒä»¬è¿˜æ²¡æœ‰å‡†å¤‡å¥½ç”¨äºç”Ÿäº§ã€‚

Elasticsearch åº”è¯¥åœ¨é›†ç¾¤æ¨¡å¼ä¸‹è¿è¡Œï¼Œè‡³å°‘æœ‰ 3 ä¸ªèŠ‚ç‚¹å¹¶ä¸”æœ‰è¶³å¤Ÿçš„å†…å­˜é™åˆ¶ï¼ˆé€šå¸¸æ¯ä¸ªèŠ‚ç‚¹æœ€å°å¤§çº¦ 8GBï¼‰ã€‚å¦åˆ™ Elasticsearch æœåŠ¡å°†æ— æ³•æä¾›æ‰€éœ€çš„é«˜å¯ç”¨æ€§çº§åˆ«ã€‚

ç”±äº Elasticsearch æ˜¯ä¸€é¡¹ Java æœåŠ¡ï¼Œå…³é”®è®¾ç½®æ˜¯ Java å †å¤§å°é™åˆ¶ - éœ€è¦å°†é™åˆ¶è®¾ç½®ä¸ºä¸º Elasticsearch æä¾›è¶³å¤Ÿå†…å­˜ç”¨äºæœç´¢æ“ä½œæ‰€éœ€çš„ä¸Šé™ï¼Œä»¥åŠæ“ä½œç³»ç»Ÿå…¶ä»–éƒ¨åˆ†æ‰€éœ€çš„æœ€ä½é™åˆ¶/æœåŠ¡ä»¥ä¿æŒè¿è¡Œã€‚ä¸ºäº†ä¸è¶…è¿‡å®¹å™¨å†…å­˜é™åˆ¶ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼ŒElasticsearch å‘Šè¯‰ JVM ä½¿ç”¨æœ€å°å’Œæœ€å¤§å¤§å°ä¸º 1 GB çš„å †ã€‚è¿ç§»åˆ°ç”Ÿäº§ç¯å¢ƒæ—¶ï¼Œé‡è¦çš„æ˜¯é…ç½®å †å¤§å°ä»¥ç¡®ä¿ Elasticsearch æœ‰è¶³å¤Ÿçš„å¯ç”¨å †ã€‚

[å¼•](https://www.elastic.co/guide/en/elasticsearch/reference/current/heap-size.html)è‡ª[ElasticSearch æ–‡æ¡£ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://www.elastic.co/guide/en/elasticsearch/reference/current/heap-size.html)

è¿™äº›è®¾ç½®çš„å€¼å–å†³äºæœåŠ¡å™¨ä¸Šå¯ç”¨çš„ RAM é‡ï¼š

- è®¾ç½®`Xmx`å’Œ`Xms`ä½ çš„ç‰©ç†å†…å­˜ä¸è¶…è¿‡50ï¼…ã€‚Elasticsearch éœ€è¦å†…å­˜ç”¨äº JVM å †ä»¥å¤–çš„ç”¨é€”ï¼Œä¸ºæ­¤ç•™å‡ºç©ºé—´å¾ˆé‡è¦ã€‚ä¾‹å¦‚ï¼ŒElasticsearch ä½¿ç”¨å †å¤–ç¼“å†²åŒºæ¥å®ç°é«˜æ•ˆçš„ç½‘ç»œé€šä¿¡ï¼Œä¾é æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿç¼“å­˜æ¥é«˜æ•ˆè®¿é—®æ–‡ä»¶ï¼Œå¹¶ä¸” JVM æœ¬èº«ä¹Ÿéœ€è¦ä¸€äº›å†…å­˜ã€‚è§‚å¯Ÿ Elasticsearch è¿›ç¨‹ä½¿ç”¨çš„å†…å­˜è¶…è¿‡ä½¿ç”¨`Xmx`è®¾ç½®é…ç½®çš„é™åˆ¶æ˜¯æ­£å¸¸çš„ã€‚è®¾ç½®`Xmx`å¹¶ä¸”`Xms`ä¸è¶…è¿‡ JVM ç”¨äºå‹ç¼©å¯¹è±¡æŒ‡é’ˆï¼ˆå‹ç¼© oopsï¼‰çš„é˜ˆå€¼ï¼›ç¡®åˆ‡çš„é˜ˆå€¼æœ‰æ‰€ä¸åŒï¼Œä½†æ¥è¿‘ 32 GBã€‚æ‚¨å¯ä»¥é€šè¿‡åœ¨æ—¥å¿—ä¸­æŸ¥æ‰¾å¦‚ä¸‹ä¸€è¡Œæ¥éªŒè¯æ‚¨æ˜¯å¦ä½äºé˜ˆå€¼ï¼š
- å †çš„å¤§å°`1.9gb`ï¼Œå‹ç¼©æ™®é€šå¯¹è±¡æŒ‡é’ˆ`true` ç†æƒ³åœ°è®¾ç½®`Xmx`å¹¶`Xms`ä»¥ä¸è¶…è¿‡è¯¥é˜ˆå€¼çš„å¤šä¸ªé›¶åŸºäºå‹ç¼©ç³Ÿç³•; ç¡®åˆ‡çš„é˜ˆå€¼å„ä¸ç›¸åŒï¼Œä½† 26 GB åœ¨å¤§å¤šæ•°ç³»ç»Ÿä¸Šæ˜¯å®‰å…¨çš„ï¼Œä½†åœ¨æŸäº›ç³»ç»Ÿä¸Šå¯èƒ½é«˜è¾¾ 30 GBã€‚æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨ JVM é€‰é¡¹`-XX:+UnlockDiagnosticVMOptions -XX:`+PrintCompressedOopsModeå¯åŠ¨ Elasticsearchå¹¶æŸ¥æ‰¾å¦‚ä¸‹æ‰€ç¤ºçš„è¡Œæ¥éªŒè¯æ‚¨æ˜¯å¦ä½äºæ­¤é˜ˆå€¼ï¼š

```log
heap address: 0x000000011be00000, size: 27648 MB, zero based Compressed Oops
showing that zero-based compressed oops are enabled. If zero-based compressed oops are not enabled then you will see a line like the following instead:

heap address: 0x0000000118400000, size: 28672 MB, Compressed Oops with base: 0x00000001183ff000
```

é˜…è¯»æœ‰å…³[Elasticsearch éƒ¨ç½²æœ€ä½³å®è·µçš„æ›´å¤šä¿¡æ¯ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://medium.com/@abhidrona/elasticsearch-deployment-best-practices-d6c1323b25d7)





## [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_13-htaccess-server-side-redirects-http-codes-and-headers-middlewares)13. .htaccessã€æœåŠ¡å™¨ç«¯é‡å®šå‘ã€HTTP ä»£ç å’Œæ ‡å¤´ã€ä¸­é—´ä»¶

æˆ‘ä»¬å¼ºçƒˆå»ºè®®åœ¨ Vue Storefront å‰ä½¿ç”¨æŸç§ HTTP æœåŠ¡å™¨ä½œä¸ºä»£ç†ã€‚è®©å®ƒæˆä¸º`nginx`ï¼ˆåœ¨æˆ‘ä»¬çš„[ç”Ÿäº§è®¾ç½®æ–‡æ¡£ä¸­](https://docs.vuestorefront.io/v1/guide/installation/production-setup.html)å»ºè®®ï¼‰`Varnish`æˆ–ä»€è‡³`Apache`. è¿™äº› HTTP æœåŠ¡å™¨ä¸­çš„ä»»ä½•ä¸€ä¸ªéƒ½å…è®¸æ‚¨åœ¨ Vue Storefront ä¹‹å‰æ·»åŠ ä¸€äº›æˆæƒæˆ–é‡å®šå‘å±‚ã€‚

è¿™æ˜¯æ¨èçš„æ–¹å¼ã€‚

### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#protip-9)ä¸“å®¶æç¤º

#### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_1-advanced-output-processing)1. é«˜çº§è¾“å‡ºå¤„ç†

ä½†æ˜¯ï¼Œé€šè¿‡ä½¿ç”¨[é«˜çº§è¾“å‡ºå¤„ç†ï¼Œ](https://docs.vuestorefront.io/v1/guide/core-themes/layouts.html#how-it-works)æ‚¨å¯ä»¥è½»æ¾åœ°ä»æ‚¨æƒ³è¦çš„ Vue Storefront ç«™ç‚¹ç”Ÿæˆä»»ä½•æ–‡æœ¬æ•°æ®è¾“å‡ºã€‚åŒ…æ‹¬ JSONã€XML ç­‰ã€‚è¿™æ˜¯ä¸€ç§ç”Ÿæˆç«™ç‚¹åœ°å›¾å’Œå…¶ä»–åŸºäºæ•°æ®çš„æ–‡æ¡£çš„æ–¹æ³•ã€‚

#### [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_2-express-js-middleware)2.`Express.js`ä¸­é—´ä»¶

å¦ä¸€ç§é€‰æ‹©æ˜¯åˆ›å»ºä¸€ä¸ª`Express.js`ä¸­é—´ä»¶ã€‚æˆ‘ä»¬`core/scripts/server.ts`æ˜¯ä¸€ä¸ªç»å…¸çš„ Node.js åº”ç”¨ç¨‹åºï¼Œæ‰€ä»¥å®ƒåº”è¯¥å¾ˆå®¹æ˜“ã€‚ä¸ºæ­¤ï¼Œæ‚¨å¯èƒ½éœ€è¦åˆ›å»ºä¸€ä¸ª[æœåŠ¡å™¨æ¨¡å— ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/develop/src/modules/compress/server.ts).

æœåŠ¡å™¨æ¨¡å—ä½äº`src/modules`å¹¶å§‹ç»ˆå…·æœ‰`server.ts`å“åº”å°‘æ•°æœåŠ¡å™¨å…¥å£ç‚¹ä¹‹ä¸€çš„å…¥å£ç‚¹ï¼š

- `afterProcessStarted`-[åœ¨æœåŠ¡å™¨å¯åŠ¨åç«‹å³](https://github.com/vuestorefront/vue-storefront/blob/2c6e0e1c8e73952beabf550fe4530344a6bcce15/core/scripts/server.ts#L13)æ‰§è¡Œ[ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/2c6e0e1c8e73952beabf550fe4530344a6bcce15/core/scripts/server.ts#L13).
- `afterApplicationInitialized`-[åœ¨ Express åº”ç”¨ç¨‹åºåˆå§‹åŒ–åç«‹å³](https://github.com/vuestorefront/vue-storefront/blob/2c6e0e1c8e73952beabf550fe4530344a6bcce15/core/scripts/server.ts#L34)æ‰§è¡Œ[ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/2c6e0e1c8e73952beabf550fe4530344a6bcce15/core/scripts/server.ts#L34). è¿™æ˜¯ç»‘å®šæ–°è¯·æ±‚å¤„ç†ç¨‹åº ( `app.get(...)`, `app.use(...)`)çš„ä¸€ä¸ªå¾ˆå¥½çš„åˆ‡å…¥ç‚¹ã€‚é˜…è¯»æœ‰å…³[Express.js è¯·æ±‚å¤„ç†ç¨‹åºå’Œè·¯ç”±çš„æ›´å¤šä¿¡æ¯ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://expressjs.com/en/guide/routing.html).
- `beforeOutputRenderedResponse`-[åœ¨ SSR æ¸²æŸ“å®Œæˆå](https://github.com/vuestorefront/vue-storefront/blob/2c6e0e1c8e73952beabf550fe4530344a6bcce15/core/scripts/server.ts#L189)æ‰§è¡Œ[ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/2c6e0e1c8e73952beabf550fe4530344a6bcce15/core/scripts/server.ts#L189)ä½†åœ¨å°†å…¶å‘é€åˆ°æµè§ˆå™¨ä¹‹å‰ï¼›å®ƒå…è®¸æ‚¨ç”¨è‡ªå·±çš„å†…å®¹è¦†ç›–å‘ˆç°çš„ SSR å†…å®¹ã€‚
- `afterOutputRenderedResponse`-[åœ¨é«˜çº§è¾“å‡ºå¤„ç†ç®¡é“ä¹‹å](https://github.com/vuestorefront/vue-storefront/blob/2c6e0e1c8e73952beabf550fe4530344a6bcce15/core/scripts/server.ts#L212)æ‰§è¡Œ[ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/2c6e0e1c8e73952beabf550fe4530344a6bcce15/core/scripts/server.ts#L212)æ‰§è¡Œã€‚
- `beforeCacheInvalidated`, `afterCacheInvalidated`-[åœ¨ç¼“å­˜å¤±æ•ˆä¹‹å‰å’Œä¹‹å](https://github.com/vuestorefront/vue-storefront/blob/2c6e0e1c8e73952beabf550fe4530344a6bcce15/core/scripts/server.ts#L76)æ‰§è¡Œ[ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/2c6e0e1c8e73952beabf550fe4530344a6bcce15/core/scripts/server.ts#L76)

è¿™æ˜¯ä¸€ä¸ª[å¦‚ä½•ç»‘å®š](https://github.com/vuestorefront/vue-storefront/blob/develop/src/modules/google-cloud-trace/server.ts)çš„[ç¤ºä¾‹ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/develop/src/modules/google-cloud-trace/server.ts)æœåŠ¡å™¨è¿›ç¨‹å¯åŠ¨åçš„è·Ÿè¸ªæ¨¡å—ï¼š

```js
import { serverHooks } from '@vue-storefront/core/server/hooks'

serverHooks.afterProcessStarted((config) => {
  let trace = require('@google-cloud/trace-agent')
  if (config.has('trace') && config.get('trace.enabled')) {
    trace.start(config.get('trace.config'))
  }
})
```

[å¦ä¸€ä¸ªä¾‹å­ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/develop/src/modules/compress/server.ts)- éå¸¸å¸¸è§çš„æƒ…å†µ - åœ¨ SSR æ¸²æŸ“ç®¡é“ï¼ˆåŒ…æ‹¬è‡ªå®šä¹‰ URL åœ°å€ï¼‰å¤„ç†æ‰€æœ‰ç”¨æˆ·è¯·æ±‚ä¹‹å‰ï¼Œç»‘å®šæ–°çš„ Express ä¸­é—´ä»¶æ¥å¤„ç†æ‰€æœ‰ç”¨æˆ·è¯·æ±‚ï¼š

```js
import { serverHooks } from '@vue-storefront/core/server/hooks'

const compression = require('compression')
serverHooks.afterApplicationInitialized(({ app, isProd }) => {
  if (isProd) {
    console.log('Output Compression is enabled')
    app.use(compression({ enabled: isProd }))
  }
})
```

å¦‚æœä½ æƒ³ç»‘å®šè‡ªå®šä¹‰ URL åœ°å€ï¼Œè¿™ä¸ªä¾‹å­å¯ä»¥è¿™æ ·ä¿®æ”¹ï¼š

```js
import { serverHooks } from '@vue-storefront/core/server/hooks'

serverHooks.afterApplicationInitialized(({ app, isProd }) => {
  app.get('/custom-url-address', (req, res) => {
    res.end('Custom response')
  })
})
```





## [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_14-which-fields-of-product-category-and-attribute-are-really-used-by-vsf)14. VSF çœŸæ­£ä½¿ç”¨çš„äº§å“ã€ç±»åˆ«å’Œå±æ€§çš„å“ªäº›å­—æ®µ

Vue Storefront ç”¨äºäº§å“å’Œç±»åˆ«çš„æ•°æ®æ ¼å¼éå¸¸å¤æ‚ï¼ŒåŒ…å«ä¸€ç³»åˆ—å¯é€‰å­—æ®µã€‚ä¸ºäº†æ›´å¥½åœ°äº†è§£å“ªäº›å­—æ®µæ˜¯çœŸæ­£éœ€è¦çš„ä»¥åŠå®ƒä»¬æ˜¯å¦‚ä½•å·¥ä½œçš„ - è¯·æŸ¥çœ‹[storefront-api ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/storefront-api/)æ–‡æ¡£ï¼š

- [GraphQL æ¶æ„ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://divanteltd.github.io/storefront-graphql-api-schema/)å®ƒæè¿°äº†å…·æœ‰åç»­ç±»å‹çš„äº§å“å’Œç±»åˆ«å®ä½“ã€‚
- [äº§å“å®ä½“ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://sfa-docs.now.sh/guide/integration/format-product.html#product-entity)- æœ€å°çš„äº§å“å­—æ®µé›†ä»¥åŠ VSF å¦‚ä½•ä½¿ç”¨å®ƒä»¬ã€‚
- [ç±»åˆ«å®ä½“ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://sfa-docs.now.sh/guide/integration/format-category.html)- æœ€å°çš„ç±»åˆ«å­—æ®µé›†ä»¥åŠ VSF å¦‚ä½•ä½¿ç”¨å®ƒä»¬ã€‚
- [å±æ€§å®ä½“ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://sfa-docs.now.sh/guide/integration/format-attribute.html)- æœ€å°çš„å±æ€§å­—æ®µé›†ä»¥åŠ VSF å¦‚ä½•ä½¿ç”¨å®ƒä»¬ã€‚





## [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_15-quite-handy-features-in-config-file-properties)15. é…ç½®æ–‡ä»¶å±æ€§ä¸­éå¸¸æ–¹ä¾¿çš„åŠŸèƒ½

Vue Storefront åŒ…å«ä¸€äº›éå¸¸æœ‰ç”¨çš„é…ç½®å˜é‡ï¼Œè¿™äº›å˜é‡æœ‰æ—¶ä¼šè¢«é—æ¼ï¼Œä½†å¯èƒ½éå¸¸æœ‰ç”¨ï¼ˆå€¼å¾—ä¸€æä¸¤æ¬¡ï¼ï¼‰ï¼š

- `dynamicConfigReload` - é»˜è®¤æƒ…å†µä¸‹ï¼Œé…ç½®æ–‡ä»¶ç”± [`node-config` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/lorenwest/node-config)ä»…åœ¨æ„å»ºè¿‡ç¨‹ä¸­ï¼›æ¯å½“æ‚¨ä¿®æ”¹é…ç½®æ–‡ä»¶æ—¶ï¼Œéƒ½å¿…é¡»é‡æ–°ç¼–è¯‘å¹¶æ†ç»‘åˆ°`app.js`. ä½†æ˜¯ï¼Œåœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œ[`core/scripts/server.ts` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/77efcdc40a1a69191f8d96c381535517e801820d/core/scripts/server.ts#L271)æ¯æ¬¡è¯·æ±‚éƒ½é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ã€‚è¿™å¯¹äºå¯ä¼¸ç¼©æ€§ç›®çš„å’Œåœ¨æ„å»ºè¿‡ç¨‹ä¸­ä¼ é€’ä¸€äº›åŠ¨æ€ä¿¡æ¯å¯èƒ½éå¸¸æœ‰ç”¨ã€‚é€šè¿‡ä¿®æ”¹`dynamicConfigExclude`å’Œ`dynamicConfigInclude`æ•°ç»„ï¼Œæ‚¨å¯ä»¥æ›´æ”¹é…ç½®æ–‡ä»¶çš„å“ªäº›ç‰¹å®šéƒ¨åˆ†æä¾›ç»™ç”¨æˆ·æµè§ˆå™¨ï¼Œå“ªäº›ä¸æä¾›ã€‚é…ç½®é€šè¿‡`window.__INITIAL_STATE__`.
- `useExactUrlsNoProxy`- è®¾ç½®ä¸º æ—¶`true`ï¼Œåœ¨äº§å“å±æ€§ä¸­è®¾ç½®çš„å­—ç¬¦ä¸²ï¼š`thumbnail`, `image`... ç”¨äº`<img`æ²¡æœ‰`/api/img`ä¸­é—´ä»¶çš„æ ‡ç­¾- ä½œä¸ºåŸå§‹å­—ç¬¦ä¸²ã€‚





## [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_16-cloudflare-autopurge)16. Cloudflare è‡ªåŠ¨æ¸…é™¤

æ‚¨ä¸ä»…å¯ä»¥ä½¿ç”¨ CDN æ¥æä¾› dist å’Œèµ„äº§ç›®å½•ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ SSR è¾“å‡ºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“ Cloudflare ä¸­çš„ç¼“å­˜åœ¨ Varnish ä¸­è¢«æ¸…é™¤æ—¶ï¼Œæ‚¨å¯èƒ½å¸Œæœ›åŠ¨æ€åœ°æ¸…é™¤å®ƒã€‚æœ‰ä¸€ä¸ªä¸“é—¨ç”¨äºæ­¤çš„ç¬¬ 3 æ–¹æ¨¡å—ï¼åœ¨[æ­¤å¤„](https://github.com/new-fantastic/vsf-cloudflare)å®‰è£…æ¨¡å—[ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/new-fantastic/vsf-cloudflare)





## [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_17-vsf-cache-varnish)17. VSF ç¼“å­˜æ¸…æ¼†

é»˜è®¤æƒ…å†µä¸‹ï¼ŒVSF èƒ½å¤Ÿåœ¨ Redis ç¼“å­˜ä¸­ç¼“å­˜ SSR è¾“å‡ºã€‚è¯¥æ¨¡å—å°†åœ¨ Varnish ä¸­ç¼“å­˜ Redis è¾“å‡ºã€‚å› æ­¤ï¼Œç”šè‡³ä¸ä½¿ç”¨ Node.js æœåŠ¡å™¨æ¥åŠ è½½ Redis çš„è¾“å‡ºã€‚å®ƒä½¿æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„é¦–æ¬¡åŠ è½½é€Ÿåº¦æ›´å¿«ï¼æŒ‰ç…§[æ­¤å¤„](https://github.com/new-fantastic/vsf-cache-varnish)çš„è¯´æ˜è¿›è¡Œæ“ä½œ[ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/new-fantastic/vsf-cache-varnish)





## [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_18-vsf-cache-nginx)18.VSFç¼“å­˜NGINX

é»˜è®¤æƒ…å†µä¸‹ï¼ŒVSF èƒ½å¤Ÿåœ¨ Redis ç¼“å­˜ä¸­ç¼“å­˜ SSR è¾“å‡ºã€‚è¯¥æ¨¡å—å°†åœ¨ NGINX ä¸­ç¼“å­˜ Redis è¾“å‡ºã€‚å› æ­¤ï¼Œç”šè‡³ä¸ä½¿ç”¨ Node.js æœåŠ¡å™¨æ¥åŠ è½½ Redis çš„è¾“å‡ºã€‚å®ƒä½¿æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„é¦–æ¬¡åŠ è½½é€Ÿåº¦æ›´å¿«ï¼æŒ‰ç…§[æ­¤å¤„](https://github.com/new-fantastic/vsf-cache-nginx)çš„è¯´æ˜è¿›è¡Œæ“ä½œ[ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/new-fantastic/vsf-cache-nginx)





## [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_19-vue-storefront-1-config-validator-for-magento-1-and-magento-2)19. é€‚ç”¨äº Magento 1 å’Œ Magento 2 çš„ Vue Storefront 1 é…ç½®éªŒè¯å™¨

æœ‰ä¸€ä¸ªç®€å•çš„ PHP CLI å·¥å…·å¯ä»¥æ£€æŸ¥æ‚¨çš„ Vue Storefront PWA é…ç½®æ˜¯å¦ä¸æ‚¨çš„ Magento ç«™ç‚¹çš„ç»“æ„åŒ¹é…ã€‚æ— è®ºæ‚¨çš„ VSF ä¸ Magento 1 è¿˜æ˜¯ Magento 2 æ— ç¼é…åˆï¼Œæ‚¨éƒ½å¯ä»¥æ”¾å¿ƒã€‚è¯·æŒ‰ç…§[æ­¤å¤„](https://github.com/yireo/vsf-config-validator)å®‰è£…[ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/yireo/vsf-config-validator)





## [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_20-a-sample-theme-to-start-with)20. ä¸€ä¸ªç¤ºä¾‹ä¸»é¢˜å¼€å§‹

è¿™ä¸ª[ç¤ºä¾‹ä¸»é¢˜ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/yireo-training/vsf-yireo-theme)å¯ä»¥å¸®åŠ©æ‚¨ä» Webpack é…ç½®å¼€å§‹ï¼Œä»¥å…è®¸ç®€å•çš„çˆ¶/å­ä¸»é¢˜ã€‚





## [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_21-optimized-webpack-configuration-for-vue-storefront-1-development)21ã€é’ˆå¯¹Vue Storefront 1å¼€å‘ä¼˜åŒ–Webpacké…ç½®

Vue Storefront 1 çš„é»˜è®¤ Webpack é…ç½®å…è®¸å®Œå…¨æµ‹è¯•æ‰€æœ‰åŠŸèƒ½ã€‚ä½†æ˜¯ï¼Œç”±äºå„ç§åŸå› ï¼Œè¿™ä¼šå¯¼è‡´ç¼–è¯‘æ—¶é—´å˜æ…¢ï¼Œä»è€Œå¯¼è‡´å¼€å‘äººå‘˜ä½“éªŒä¸ä½³ã€‚è¿™ä¸ª[å­˜å‚¨åº“ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/yireo-training/vsf1-local-webpack)åŒ…å«ä¸€ä¸ªå•ç‹¬çš„ Webpack

## [#](https://docs.vuestorefront.io/v1/guide/cookbook/checklist.html#_22-get-rid-of-depracatedactions-in-vsf-1-12)22. åœ¨ VSF 1.12+ ä¸­æ‘†è„± depracatedActions

æˆ‘ä»¬ä¸æƒ³è¿›è¡Œ**é‡å¤§æ›´æ”¹**ï¼ˆä»…åœ¨ç‰¹æ®Šæƒ…å†µä¸‹ï¼‰ã€‚è¿™å°±æ˜¯æˆ‘ä»¬åœ¨äº§å“çš„ vuex æ¨¡å—ä¸­ç•™ä¸‹*depracatedActions*çš„åŸå› ã€‚å¦‚æœä½ åœ¨ 1.12 å¼€å§‹ä½ çš„é¡¹ç›®ï¼Œä½ å‡ ä¹å¯ä»¥ 100% ç¡®å®šä½ å¯ä»¥æ‘†è„±è¿™ä¸ªæ–‡ä»¶ï¼Œè¿™å°†å¯¼è‡´app.js åŒ…å‡å°‘**31.75KB**ï¼ç®€è€Œè¨€ä¹‹ï¼Œå¦‚æœæ‚¨çš„åº”ç”¨ä¸ä½¿ç”¨ä»»ä½•*depracatedActions*ï¼Œæ‚¨å°±å¯ä»¥åšåˆ°è¿™*ä¸€ç‚¹*ã€‚

è¦åšåˆ°è¿™ä¸€ç‚¹ï¼š

1. æ¶ˆé™¤ `core/modules/catalog/store/product/deprecatedActions.ts`
2. åœ¨ ä¸­`core/modules/catalog/store/product/actions.ts`ï¼Œåˆ é™¤ 317-318 è¡Œï¼š

```ts
/** Below actions are not used from 1.12 and can be removed to reduce bundle */
  ...require('./deprecatedActions').default
```