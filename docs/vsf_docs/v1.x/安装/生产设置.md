# ç”Ÿäº§è®¾ç½®

å¦‚æœæ‚¨æƒ³å¼€å§‹ä½¿ç”¨ Vue Storefront å¼€å‘ç«™ç‚¹ï¼Œæ‚¨åº”è¯¥ä»[å®‰è£…æŒ‡å—](https://docs.vuestorefront.io/v1/guide/installation/linux-mac.html)å¼€å§‹ã€‚å‡ºäºå¼€å‘ç›®çš„ï¼Œæ‚¨å¯èƒ½ä¼šä½¿ç”¨è¯¥`yarn install`åºåˆ—ï¼Œå®ƒå°†ä½¿ç”¨è‡ªåŠ¨å®‰è£…ç¨‹åºåœ¨æœ¬åœ°è®¾ç½® Vue Storefrontï¼Œå¹¶å‡†å¤‡å¥½ Docker æ˜ åƒä»¥è·å¾— Elasticsearch å’Œ Redis æ”¯æŒã€‚

å¼€å‘æ¨¡å¼æ„å‘³ç€æ‚¨ä½¿ç”¨åŸºäº node.js çš„æœåŠ¡å™¨ä½œä¸º HTTP æœåŠ¡å¹¶åœ¨`3000`TCP ç«¯å£ä¸Šè¿è¡Œåº”ç”¨ç¨‹åºã€‚ç”±äºå®ƒéå¸¸é€‚åˆæœ¬åœ°æµ‹è¯•ï¼Œå› æ­¤ä¸å»ºè®®åœ¨ç”Ÿäº§é…ç½®ä¸­ä½¿ç”¨å®‰è£…ç¨‹åºå’Œç›´æ¥ç”¨æˆ·è®¿é—® node.jsã€‚

## [#](https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#production-setup-bare-vps)ç”Ÿäº§è®¾ç½®ï¼šè£¸ VPS

è¦åœ¨æ²¡æœ‰ Docker/Kubernetes çš„ç”Ÿäº§æ¨¡å¼ä¸‹è¿è¡Œ Vue Storefrontï¼Œæ‚¨éœ€è¦å…·æœ‰`root`è®¿é—®æƒé™çš„è™šæ‹Ÿä¸“ç”¨æœåŠ¡å™¨ï¼ˆç”¨äºè®¾ç½®ç›®çš„ï¼‰ã€‚æˆ‘ä»¬å‡è®¾æ‚¨`Debian GNU Linux`åœ¨ä»¥ä¸‹æ­¥éª¤ä¸­ä½¿ç”¨ã€‚

æœ¬æ•™ç¨‹å…¶ä½™éƒ¨åˆ†çš„å‡è®¾ï¼š

- æ‚¨æ‹¥æœ‰ Debian Linux æœºå™¨çš„ root è®¿é—®æƒé™ã€‚
- æˆ‘ä»¬å°†ä½¿ç”¨é»˜è®¤çš„æœ¬åœ°ç«¯å£`3000`ä¸º[`vue-storefront` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront)å¹¶`8080`ä¸º[`vue-storefront-api` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront-api); ç«¯å£**ä¸åº”æš´éœ²**ï¼Œå› ä¸ºå®ƒä»¬å°†éšè—åœ¨**NGINX ä»£ç†ä¹‹å**ã€‚
- æˆ‘ä»¬ä½¿ç”¨**prod.vuestorefront.io**ä½œä¸ºåŸŸåã€‚è¯·å°†å…¶æ›¿æ¢ä¸ºæ‚¨çš„ä¸»æœº URL åœ°å€ã€‚
- æˆ‘ä»¬å‡è®¾æ‚¨æ‹¥æœ‰**prod.vuestorefront.io**ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥æ˜¯æ‚¨çš„åŸŸï¼‰çš„ SSL è¯ä¹¦ã€‚PWA å’Œ Service Workers éœ€è¦ SSL åŠ å¯†ã€‚

é€šç”¨æ–¹æ¡ˆæ¶æ„ï¼š *USER -> NGINX ä»£ç† -> vue-storefront / vue-storefront-api*

æˆ‘ä»¬å°†éšè—NGINX ä»£ç†èƒŒåçš„`vue-storefront`å’Œ`vue-storefront-api`æœåŠ¡ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ NGINX æ¥ç¼“å­˜ä»£ç†ï¼Œä½†åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå®ƒåªä¼šè½¬å‘æ²¡æœ‰ç¼“å­˜çš„è¯·æ±‚ï¼ˆå› ä¸º VS éå¸¸å¿«å¹¶ä¸”ä¸éœ€è¦ç¼“å­˜ï¼‰ã€‚æˆ‘ä»¬ä½¿ç”¨çš„ä¸»è¦åŠŸèƒ½æ˜¯ï¼šSSL åŠ å¯†ã€gzip ç¼–ç å’Œ URL è·¯ç”±ï¼ˆåœ¨ä¸€ä¸ªåŸŸä¸‹åˆå¹¶`vue-storefront`å’Œ`vue-storefront-api`æœåŠ¡ï¼‰ã€‚

### [#](https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#prerequisites)å…ˆå†³æ¡ä»¶

ç¬”è®°

æœ¬æŒ‡å—åœ¨*Ubuntu 18.04*å’Œå…¶ä»–ä¸»è¦å‘è¡Œç‰ˆä¸Šè¿›è¡Œäº†æµ‹è¯•ã€‚è¯¥åˆ—è¡¨å°†ä¸æ–­æ›´æ–°ã€‚

Vue Storefront éœ€è¦å®‰è£…**Elasticsearch**å’Œ**Redis æœåŠ¡å™¨**ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼Œè¿™ä¸¤ä¸ªä¾èµ–é¡¹éƒ½éš`docker-compose.yml`Docker é•œåƒä¸€èµ·æä¾›ã€‚ä½†æ˜¯ï¼Œå‡ºäºç”Ÿäº§ç›®çš„ï¼Œæˆ‘ä»¬å»ºè®®æœ¬åœ°å®‰è£…æœåŠ¡å™¨ã€‚

å‡ºäºæœ¬æ•™ç¨‹çš„ç›®çš„ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸ Debian æ“ä½œç³»ç»Ÿä¸€èµ·åˆ†å‘çš„é»˜è®¤åŒ…ï¼Œæ²¡æœ‰ä»»ä½•å®‰å…¨åŠ å›ºã€é…ç½®åŠ å›ºæ“ä½œã€‚

**è¯·ç¡®ä¿**æ‚¨çš„å®‰å…¨/å¼€å‘è¿è¥å›¢é˜Ÿå·²æŸ¥çœ‹æ‚¨æ­£åœ¨ä½¿ç”¨çš„é…ç½®ï¼Œå¹¶åœ¨å…¬å¼€å‘å¸ƒæ‚¨çš„åº”ç”¨ç¨‹åºä¹‹å‰å¼ºåŒ–æœåŠ¡å™¨é…ç½®ï¼

é¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ›å»ºç”¨æˆ·ï¼ˆä½œä¸º root ç”¨æˆ·ï¼‰ï¼š

```bash
mkdir /home/www
useradd -m -d /home/www/vuestorefront vuestorefront
```

ç„¶åå®‰è£… Elasticsearch å’Œ Redisï¼ˆä»¥ root ç”¨æˆ·èº«ä»½ï¼‰ï¼š

```bash
apt-get update
apt-get install curl
apt-get install git

curl -sL https://deb.nodesource.com/setup_10.x | bash -
apt-get install -y nodejs
npm install -g yarn

apt-get install redis-server

apt-get install openjdk-8-jre
curl -L -O https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.6.16.deb
dpkg -i elasticsearch-5.6.16.deb
/etc/init.d/elasticsearch start

apt-get install imagemagick
apt-get install nginx
```

### [#](https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#nginx)nginx

æˆ‘ä»¬å†³å®šä½¿ç”¨**NGINX**ä½œä¸º HTTP ä»£ç†ï¼Œæš´éœ²åœ¨ç”¨æˆ·é¢å‰ï¼Œå¤„ç†ç½‘ç»œæµé‡ï¼Œå¹¶ä½œä¸ºåç«¯å¤„ç†åº”ç”¨ç¨‹åº`vue-storefront`å’Œ`vue-storefront-api`åº”ç”¨ç¨‹åºã€‚

è¿™æ˜¯è®¾ç½®ç”Ÿäº§ node.js åº”ç”¨ç¨‹åºçš„ä¸€èˆ¬è§„åˆ™ï¼Œå®ƒåœ¨ SSLã€gzip å‹ç¼©ã€URL è·¯ç”±å’Œå…¶ä»–é…ç½®æŠ€æœ¯æ–¹é¢ä¸ºæ‚¨æä¾›äº†å¾ˆå¤§çš„çµæ´»æ€§ï¼Œè€Œæ— éœ€é¢å¤–éº»çƒ¦ã€‚ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»»ä½•å…¶ä»–ä»£ç†æœåŠ¡å™¨ï¼Œä¾‹å¦‚ Varnish æˆ– Apache2 + mod_proxyã€‚

ä¸€äº›é¢å¤–çš„ææ–™ï¼š

- [å¦‚ä½•åœ¨ Digital Ocean ç¯å¢ƒ (Ubuntu 16) ä¸­è®¾ç½®ç”Ÿäº§ Node.js åº”ç”¨ç¨‹åºï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://www.digitalocean.com/community/tutorials/how-to-set-up-a-node-js-application-for-production-on-ubuntu-16-04)
- [å¦‚ä½•è®¾ç½® NGINX åå‘ä»£ç†ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://docs.nginx.com/nginx/admin-guide/web-server/reverse-proxy/)

#### [#](https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#nginx-configuration)NGINX é…ç½®

å¯é€‰çš„

å¦‚æœæ‚¨å·²ç»åœ¨è‡ªå·±çš„åŸŸä¸Šè®¾ç½®äº† SSLï¼Œè¯·è·³åˆ°[ä¸‹ä¸€æ­¥](https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#now-you-can-run-the-nginx-with-ssl-applied)ã€‚

ä»æ¨¡æ¿åˆ›å»º NGINX é…ç½®æ–‡ä»¶ï¼ˆè¯·ä»¥ root ç”¨æˆ·èº«ä»½è¿è¡Œï¼‰ï¼š

```bash
curl https://raw.githubusercontent.com/DivanteLtd/vue-storefront/develop/docs/guide/installation/prod.vuestorefront.io > /etc/nginx/sites-available/prod.vuestorefront.io
ln -s /etc/nginx/sites-available/prod.vuestorefront.io /etc/nginx/sites-enabled/prod.vuestorefront.io
```

æ‚¨éœ€è¦å°†åˆšåˆšä¸‹è½½çš„ä¸¤è¡Œé…ç½®æ›¿æ¢ä¸ºè¯ä¹¦æ–‡ä»¶çš„å®é™…è·¯å¾„åŠå…¶å¯†é’¥ã€‚

**å®‰è£… SSL è¯ä¹¦**

æ ¹æ®å…¶è§„èŒƒï¼ŒSSL å®‰å…¨è¿æ¥æ˜¯PWA å’ŒæœåŠ¡å·¥ä½œè€…çš„***å¿…å¤‡æ¡ä»¶***ã€‚

åœ¨æœ¬æŒ‡å—ä¸­ï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å…è´¹çš„***Let's Enrypt***æœåŠ¡æ¥è·å– SSL è¯ä¹¦ã€‚ä¸ºäº†ä½¿ç”¨***Let's Encrypt***ï¼Œæ‚¨éœ€è¦å®‰è£…`certbot`ï¼ŒæŒ‡å—åœ¨[è¿™é‡Œ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://certbot.eff.org/lets-encrypt/ubuntubionic-nginx).

ç¬”è®°

å¯ä»¥è‚¯å®šçš„æ˜¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æœ€é€‚åˆæ‚¨éœ€è¦çš„ä»»ä½•å…¶ä»– SSL æœåŠ¡æä¾›å•†ã€‚ä¸è¿‡å¤§éƒ¨åˆ†æ—¶é—´éƒ½ä¸æ˜¯å…è´¹çš„ã€‚

ä¸€æ—¦`certbot`å®‰è£…å®Œæˆåï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥è·å–è¯ä¹¦ä¿¡æ¯ã€‚

```bash
certbot certificates
```

ç»“æœå¦‚ä¸‹ï¼š

```bash
Saving debug log to /var/log/letsencrypt/letsencrypt.log

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Found the following certs:
  Certificate Name: prod.vuestorefront.io
    Domains: prod.vuestorefront.io
    Expiry Date: 2020-04-19 22:47:19+00:00 (VALID: 89 days)
    Certificate Path: /etc/letsencrypt/live/prod.vuestorefront.io/fullchain.pem
    Private Key Path: /etc/letsencrypt/live/prod.vuestorefront.io/privkey.pem
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
```

ç”¨`/etc/nginx/sites-available/prod.vuestorefront.io`ä¸Šé¢çš„ä¿¡æ¯æ›¿æ¢è¯ä¹¦åŠå…¶å¯†é’¥çš„è·¯å¾„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š







 

 







```bash
# ... abridged

  ssl on;

  ssl_certificate /etc/letsencrypt/live/prod.vuestorefront.io/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/live/prod.vuestorefront.io/privkey.pem;

  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;

# abridged ...
```

ç¬”è®°

```bash
server {
  listen 80;
  server_name prod.vuestorefront.io; 
  return 301 https://prod.vuestorefront.io$request_uri;
}
```

æœ¬èŠ‚è¿è¡Œæ ‡å‡†`http://prod.vuestorefront.io`å¹¶ä»`http://prod.vuestorefront.io/*`->åˆ›å»ºé€šé…ç¬¦é‡å®šå‘`https://prod.vuestorefront.io/*`ã€‚

#### [#](https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#now-you-can-run-the-nginx-with-ssl-applied)ç°åœ¨ä½ å¯ä»¥åœ¨åº”ç”¨äº† SSL çš„æƒ…å†µä¸‹è¿è¡Œ NGINXï¼š

```bash
/etc/init.d/nginx restart
```

æç¤º

ä¹‹åä½ å®‰è£…ï¼Œå†æ¬¡å¼€åš`/etc/nginx/sites-available/prod.vuestorefront.io`ï¼Œå¹¶æ·»åŠ `http2`åçš„`listen 443 ssl`ï¼ˆä½†ä¹‹å‰åˆ†å·ï¼ï¼‰ã€‚å®ƒåº”è¯¥æ˜¯è¿™æ ·çš„ï¼š

```text
server {
    listen 443 ssl http2;
    server_name prod.vuestorefront.io;

	ssl on;
	(...the rest of the config...)
}
```

`http2`ä¸æ˜¯å¿…éœ€çš„ï¼Œä½†å¯ä»¥ä¼˜åŒ–æ”¯æŒå®ƒçš„æµè§ˆå™¨çš„ä½“éªŒã€‚å¯ä»¥åœ¨[æ­¤å¤„](https://developers.google.com/web/fundamentals/performance/http2/)æ‰¾åˆ°æœ‰å…³ http/2 çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯[ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://developers.google.com/web/fundamentals/performance/http2/)

#### [#](https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#some-notes-on-the-provided-nginx-config)å…³äºæä¾›çš„ nginx é…ç½®çš„ä¸€äº›è¯´æ˜

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ ¹æ®è¿‡å»çš„æœ€ä½³ç»éªŒä½¿ç”¨ SSL è®¾ç½®ã€‚è¯·é˜…è¯»[NGINX æ–‡æ¡£ä¸­çš„](http://nginx.org/en/docs/http/configuring_https_servers.html)è¯¦ç»†ä¿¡æ¯ [ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](http://nginx.org/en/docs/http/configuring_https_servers.html)å¦‚æœä½ å–œæ¬¢ğŸ˜‰

```text
  gzip on;
  gzip_proxied any;
  gzip_types
  text/css
  text/javascript
  text/xml
  application/javascript
  application/json
  text/json;
```

Vue Storefront SSR å“åº”åŒ…å«å®Œæ•´çš„æ ‡è®°å’Œ JSON å¯¹è±¡ï¼Œç”¨äºåŠ å¿«ç¬¬ä¸€ä¸ªé¡µé¢çš„æµè§ˆé€Ÿåº¦ã€‚ä¸å¹¸çš„æ˜¯ï¼Œç”±äº JS åŒ…çš„å¤§å°å¾ˆå¤§ï¼Œå®ƒä¼šäº§ç”Ÿå¤§é‡çš„ç½‘ç»œè´Ÿè½½ã€‚æˆ‘ä»¬æ­£åœ¨é€šè¿‡ä½¿ç”¨ gzip å‹ç¼©æœåŠ¡å™¨ç«¯å¯¹å…¶è¿›è¡Œä¼˜åŒ–ã€‚

```text
location / {
  proxy_pass http://localhost:3000/;
}
```

æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ [`proxy_pass` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass)ä»`ngx_http_proxy_module`ä¼ é€’æ¥è‡ª Vue Storefront node.js æœåŠ¡å™¨çš„å†…å®¹ã€‚æ ¹æ®é…ç½®ï¼Œå†…å®¹åº”è¯¥åœ¨***https://prod.vuestorefront.io/***ä¸‹å¯ç”¨ã€‚

```text
location /assets/ {
  proxy_pass http://localhost:3000/assets/;
}
```

å®ƒä¹Ÿä¸å­ç›®å½•çš„å·¥ä½œæ–¹å¼ç›¸åŒã€‚

```text
location /api/ {
  proxy_pass http://localhost:8080/api/;
}
```

ä¸‹ä¸€ä¸ªä»£ç†éƒ¨åˆ†ç”¨äºæä¾› APIã€‚è¿™æ˜¯ä¸€ä¸ªä»£ç†[`vue-storefront-api` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront-api)åœ¨`8080`ç«¯å£ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºï¼ˆé»˜è®¤é…ç½®ï¼‰ã€‚API å°†åœ¨***https://prod.vuestorefront.io/api***ä¸‹å¯ç”¨

```text
location /img/ {
  proxy_pass http://localhost:8080/img/;
}
```

æœ€åä¸€ä¸ªä»£ç†ç”¨äºæä¾›äº§å“å›¾åƒã€‚è¿™æ˜¯ä¸€ä¸ªä»£ç†[`vue-storefront-api` ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront-api)åœ¨`8080`ç«¯å£ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºï¼ˆé»˜è®¤é…ç½®ï¼‰ã€‚å›¾ç‰‡å°†åœ¨***https://prod.vuestorefront.io/img***ä¸‹æä¾›

#### [#](https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#apache2-configuration)Apache2 é…ç½®

å¦‚æœæ‚¨å·²ç»åœ¨æ‚¨çš„ç¯å¢ƒä¸­ä½¿ç”¨ apache2 Web æœåŠ¡å™¨å¹¶ä¸”ä¸èƒ½ï¼ˆæˆ–ä¸æƒ³ï¼‰ä½¿ç”¨ NGINXï¼Œæ‚¨è¿˜å¯ä»¥å°† apache2 è®¾ç½®ä¸ºåå‘ä»£ç†è€Œä¸æ˜¯ NGINXã€‚è¿™æ˜¯é€šè¿‡å°†æ­¤å—æ·»åŠ åˆ°æ‚¨çš„ apache2 è™šæ‹Ÿä¸»æœºæ¥å®Œæˆçš„ã€‚

```text
ProxyRequests off

ProxyPass /api/ http://localhost:8080/api/
ProxyPassReverse /api http://localhost:8080/api/

ProxyPass /img/ http://localhost:8080/img/
ProxyPassReverse /img http://localhost:8080/img/

ProxyPass /assets/ http://localhost:3000/assets/
ProxyPassReverse /assets http://localhost:3000/assets/

ProxyPass / http://localhost:3000/
ProxyPassReverse / http://localhost:3000/
```

æ‚¨è¿˜éœ€è¦å¯ç”¨[mod_proxy ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://httpd.apache.org/docs/current/mod/mod_proxy.html)ä¸ºäº†è¿™ã€‚

### [#](https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#vue-storefront-and-vue-storefront-api)Vue åº—é¢å’Œ Vue åº—é¢ API

è®¾ç½®å¥½ NGINX åï¼Œæ‚¨åº”è¯¥`502 error`åœ¨è®¿é—® https://prod.vuestorefront.io æ—¶å¾—åˆ°ä¸€ä¸ªã€‚è¿™å®Œå…¨æ²¡é—®é¢˜ï¼æˆ‘ä»¬åˆšåˆšé”™è¿‡äº†æœ€é‡è¦çš„ä¸€æ­¥ï¼Œå³è¿è¡Œåç«¯æœåŠ¡ï¼Œä¸ºæˆ‘ä»¬çš„å®‰è£…æä¾›åŠ¨åŠ›ã€‚ç°åœ¨ NGINX æ­£åœ¨å°è¯•è¿æ¥`localhost:3000`for`vue-storefront`å’Œ`localhost:8080`for ï¼Œ`vue-storefront-api`ä½†æ²¡æœ‰ä»»ä½•æˆåŠŸã€‚

æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º`vuestorefront`å¹¶è½¬åˆ°`/home/www/vuestorefront`æˆ‘ä»¬çš„ä¸»ç›®å½•çš„ Linux ç”¨æˆ·ã€‚

æ‚¨éœ€è¦ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç›¸åº”åœ°å…‹éš†`vue-storefront`å’Œå­˜å‚¨`vue-storefront-api`åº“ï¼š

```bash
su vuestorefront
cd /home/www/vuestorefront
git clone --single-branch --branch master https://github.com/vuestorefront/vue-storefront.git
git clone https://github.com/vuestorefront/vue-storefront-api.git
```

ç„¶åï¼Œæ‚¨éœ€è¦å®‰è£…æ‰€éœ€çš„èŠ‚ç‚¹åŒ…ï¼š

```bash
cd /home/www/vuestorefront/vue-storefront-api
yarn install
```

... å’Œ ...

```bash
cd /home/www/vuestorefront/vue-storefront
yarn install
```

å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´ã€‚phantomjs ä¾èµ–éœ€è¦å®‰è£… bzip2ã€‚å®‰è£…æ¨¡å—åï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºè¿™ä¸¤ä¸ªæœåŠ¡è®¾ç½®é…ç½®æ–‡ä»¶ã€‚

#### [#](https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#vue-storefront-configuration)Vueåº—é¢é…ç½®

å®Œæ•´çš„é…ç½®æ–‡ä»¶å¯ä»¥åœ¨è¿™é‡Œä¸‹è½½ï¼š[vue-storefront ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/develop/docs/guide/installation/vue-storefront/config)å’Œ[vue-storefront-api ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/develop/docs/guide/installation/vue-storefront-api/config).

è¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤é€šè¿‡å°† default.json å¤åˆ¶åˆ° local.json æ¥ç›¸åº”åœ°åˆ›å»º`vue-storefront-api/config/local.json`å’Œ`vue-storefront/config/local.json`æ–‡ä»¶`cp`ï¼š

```bash
cp /home/www/vuestorefront/vue-storefront-api/config/default.json /home/www/vuestorefront/vue-storefront-api/config/local.json
```

...å’Œ ...

```bash
cp /home/www/vuestorefront/vue-storefront/config/default.json /home/www/vuestorefront/vue-storefront/config/local.json
```

è¯·æ‰¾åˆ°`vue-storefront/config/local.json`ä¸‹é¢æè¿°çš„æ–‡ä»¶çš„å…³é”®éƒ¨åˆ†ï¼š

```json
"elasticsearch": {
    "httpAuth": "",
    "host": "https://prod.vuestorefront.io/api/catalog",
    "index": "vue_storefront_catalog"
},
"storeViews": {
    "mapStoreUrlsFor": [
        "de",
        "it"
    ],
    "multistore": true,
    "de": {
        "elasticsearch": {
            "httpAuth": "",
            "host": "https://prod.vuestorefront.io/api/catalog",
            "index": "vue_storefront_catalog_de"
        }
    },
    "it": {
        "elasticsearch": {
            "httpAuth": "",
            "host": "https://prod.vuestorefront.io/api/catalog",
            "index": "vue_storefront_catalog_it"
        }
    }
},
```

æˆ‘ä»¬æ­£åœ¨å°†äº§å“çš„ç«¯ç‚¹è®¾ç½®ä¸º https://prod.vuestorefront.io/api/catalogï¼ˆå½“ç„¶è¯·ç›¸åº”åœ°ä½¿ç”¨æ‚¨çš„åŸŸï¼‰ã€‚æ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°ï¼Œè¯¥`/api`url ç”± NGINX ä»£ç†åˆ°`localhost:8080`- æˆ‘ä»¬çš„`vue-storefront-api`å®ä¾‹ã€‚

```json
"cart": {
      "synchronize": true,
      "synchronize_totals": true,
      "create_endpoint": "https://prod.vuestorefront.io/api/cart/create?token={{token}}",
      "updateitem_endpoint": "https://prod.vuestorefront.io/api/cart/update?token={{token}}&cartId={{cartId}}",
      "deleteitem_endpoint": "https://prod.vuestorefront.io/api/cart/delete?token={{token}}&cartId={{cartId}}",
      "pull_endpoint": "https://prod.vuestorefront.io/api/cart/pull?token={{token}}&cartId={{cartId}}",
      "totals_endpoint": "https://prod.vuestorefront.io/api/cart/totals?token={{token}}&cartId={{cartId}}",
      "paymentmethods_endpoint": "https://prod.vuestorefront.io/api/cart/payment-methods?token={{token}}&cartId={{cartId}}",
      "shippingmethods_endpoint": "https://prod.vuestorefront.io/api/cart/shipping-methods?token={{token}}&cartId={{cartId}}",
      "shippinginfo_endpoint": "https://prod.vuestorefront.io/api/cart/shipping-information?token={{token}}&cartId={{cartId}}",
      "collecttotals_endpoint": "https://prod.vuestorefront.io/api/cart/collect-totals?token={{token}}&cartId={{cartId}}",
      "deletecoupon_endpoint": "https://prod.vuestorefront.io/api/cart/delete-coupon?token={{token}}&cartId={{cartId}}",
      "applycoupon_endpoint": "https://prod.vuestorefront.io/api/cart/apply-coupon?token={{token}}&cartId={{cartId}}&coupon={{coupon}}"
  },
```

`prod.vuestorefront.io`åœ¨æ­¤æ–‡ä»¶ä¸­ï¼Œè¿˜æœ‰ 27 ä¸ªè¦æ›¿æ¢ä¸ºæ‚¨çš„ç”Ÿäº§ URL åœ°å€çš„å®ä¾‹ã€‚è¯·å°±è¿™æ ·å§ğŸ˜ƒ

å¦‚æœæ‚¨æƒ³æŸ¥çœ‹ä¿®æ”¹åçš„ local.json åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­ï¼Œæˆ‘ä»¬å‡†å¤‡çš„é…ç½®`prod.vuestorefront.io`å¯ä»¥åœ¨ä»¥ä¸‹ä½ç½®æ‰¾åˆ°ï¼š

[Vueåº—é¢local.jsonï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://raw.githubusercontent.com/DivanteLtd/vue-storefront/develop/docs/guide/installation/vue-storefront-api/config/local.json)

[vue-storefront-api local.jsonï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://raw.githubusercontent.com/DivanteLtd/vue-storefront/develop/docs/guide/installation/vue-storefront/config/local.json)

#### [#](https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#vue-storefront-api-configuration)Vue Storefront API é…ç½®

åœ¨[æä¾›VUEçš„åº—é¢-APIé…ç½® ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/vue-storefront/blob/develop/docs/guide/installation/vue-storefront-api/config)å‡ ä¹ä¸éœ€è¦æ”¹å˜ã€‚

æ‚¨éœ€è¦æ›´æ”¹çš„å”¯ä¸€è¡Œæ˜¯ï¼š

```json
"imageable": {
    "namespace": "",
    "maxListeners": 512,
    "imageSizeLimit": 1024,
    "timeouts": {
        "convert": 5000,
        "identify": 100,
        "download": 1000
    },
    "whitelist": {
        "allowedHosts": [
            ".*divante.pl",
            ".*vuestorefront.io"
        ]
    },
    "keepDownloads": true,
    "maxDownloadCacheSize": 1000,
    "tmpPathRoot": "/tmp"
},
"elasticsearch": {
    "host": "localhost",
    "port": "9200",
    "indices": [
        "vue_storefront_catalog",
        "vue_storefront_catalog_it",
        "vue_storefront_catalog_de"
    ]
}
```

æ‚¨åº”è¯¥åœ¨æ­¤å¤„`allowedHosts`æ”¾ç½®*å¯æˆåƒ*èŠ‚ç‚¹ä»¥ä¸‹è½½äº§å“å›¾åƒã€‚åŸŸåæŒ‡å‘å›¾åƒæ¥æºçš„ Magento 2 å®ä¾‹ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒMagento 2 åœ¨**http://demo-magento2.vuestorefront.io**ä¸‹è¿è¡Œã€‚

#### [#](https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#using-your-own-magento-2-instance)ä½¿ç”¨æ‚¨è‡ªå·±çš„ Magento 2 å®ä¾‹

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¿…é¡»`magento2`åœ¨ vue-storefront-api é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨æ­£ç¡®çš„ä¸»æœºåæ›´æ–°é…ç½®èŠ‚ç‚¹ã€‚è¦è·å–`api`èŠ‚ç‚¹çš„æ‰€æœ‰å¿…è¦ Magento 2 API æ•°æ®ï¼Œè¯·å¯¼èˆªåˆ° Magento 2 ç®¡ç†ä¸­çš„ç³»ç»Ÿ -> æ‰©å±• -> é›†æˆã€‚èŠ‚ç‚¹ï¼Œå¯¼èˆªåˆ° Magento 2 ç®¡ç†ä¸­çš„ç³»ç»Ÿ -> æ‰©å±• -> é›†æˆã€‚

- å•å‡»æ·»åŠ æ–°é›†æˆ
- æ£€æŸ¥å¿…è¦çš„æƒé™ï¼ˆæ£€æŸ¥ API æƒé™é€‰é¡¹å¡ä¸Šçš„ç›®å½•ã€é”€å”®ã€æˆ‘çš„å¸æˆ·å’Œè´­ç‰©è½¦ï¼‰
- ç‚¹å‡»æ¿€æ´»
- å°†å¿…è¦çš„å¯†é’¥ã€ç§˜å¯†å’Œä»¤ç‰Œå¤åˆ¶åˆ° vue-storefront-api é…ç½®çš„ api éƒ¨åˆ†

#### [#](https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#build-vs)æ„å»º VS

åœ¨æˆ‘ä»¬å¯ä»¥è¿è¡Œ Vue Storefront å’Œ Vue Storefront API ä¹‹å‰ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨ç”Ÿäº§æ¨¡å¼ä¸‹æ„å»ºå®ƒã€‚ä¸ºæ­¤ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
cd /home/www/vuestorefront/vue-storefront/
yarn build
cd /home/www/vuestorefront/vue-storefront-api/
yarn build
```

#### [#](https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#data-import)æ•°æ®å¯¼å…¥

Vue Storefront éœ€è¦åœ¨ Elasticsearch ä¸­æœ‰ä¸€äº›æ•°æ®æ‰èƒ½æ­£ç¡®æ˜¾ç¤ºäº§å“å’Œç±»åˆ«ã€‚å½“ç„¶ä½ å¯ä»¥å®‰è£…[mage2vuestorefront ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/vuestorefront/mage2vuestorefront)å¹¶é…ç½®æ•°æ®æ³µä»¥åœ¨ Magento ä¸­æ›´æ”¹æ•°æ®æ—¶åŒæ­¥å’Œæ›´æ–° Elasticsearch ç´¢å¼•ã€‚å‡ºäºæœ¬æ•™ç¨‹çš„ç›®çš„ï¼Œæˆ‘ä»¬å°†ä»…ä» JSON æ–‡ä»¶ä¸­æ¢å¤æ•°æ®ã€‚

æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼ˆæ‚¨çš„æœ¬åœ°å®‰è£…ï¼‰è½»æ¾è½¬å‚¨å½“å‰çš„ VS ç´¢å¼•ï¼š

```bash
cd vue-storefront-api
rm var/catalog.json
yarn dump
```

ç°åœ¨ï¼Œ`var/catalog.json`æ‚¨æ‹¥æœ‰å½“å‰çš„æ•°æ®åº“è½¬å‚¨ã€‚è¯·å°†æ­¤æ–‡ä»¶ä¼ è¾“åˆ°æœåŠ¡å™¨â€”â€”ä¾‹å¦‚ï¼Œä½¿ç”¨ä»¥ä¸‹ ssh å‘½ä»¤ï¼š

```bash
ssh vuestorefront@prod.vuestorefront.io rm ~/vue-storefront-api/var/catalog.json
scp vue-storefront-api/var/catalog.json vuestorefront@prod.vuestorefront.io:~/vue-storefront-api/var/catalog.json
```

ç„¶åï¼Œåœ¨ä»¥`prod.vuestorefront.io`èº«ä»½ç™»å½•åˆ°æ‚¨çš„æœåŠ¡å™¨å`vuestorefront`ï¼Œæ‚¨å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å¯¼å…¥æ•°æ®ï¼š

```bash
cd vue-storefront-api
yarn db new
yarn restore2main
yarn db rebuild
```

#### [#](https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#running-the-vue-storefront-and-vue-storefront-api)è¿è¡Œ Vue Storefront å’Œ Vue Storefront API

ä¸€åˆ‡è®¾ç½®å¥½åï¼Œæ‚¨å°±å¯ä»¥å¯åŠ¨`vue-storefront`and äº†`vue-storefront-api`ï¼š

```bash
cd vue-storefront-api
yarn start
cd vue-storefront
yarn start
```

ä¸¤ä¸ªåº”ç”¨ç¨‹åºéƒ½ä½¿ç”¨[`PM2`è¿›ç¨‹ç®¡ç†å™¨ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://pm2.keymetrics.io/docs/usage/process-management/)åœ¨ç”Ÿäº§æ¨¡å¼ï¼ˆ`start`å‘½ä»¤ï¼‰ä¸­åœ¨éœ€è¦æ—¶ç®¡ç†å’Œé‡æ–°ç”Ÿæˆ node.js è¿›ç¨‹ã€‚

## [#](https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#cache-strategies)ç¼“å­˜ç­–ç•¥

### [#](https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#varnish-cache-for-vsf)VSF çš„æ¸…æ¼†ç¼“å­˜

*Vue Storefront*æœ‰å¤šå±‚ç¼“å­˜ï¼Œæœ€å‰é¢çš„ç¼“å­˜æ˜¯*Varnish*ï¼Œä¸€æ—¦è¯·æ±‚è¢«ç‚¹å‡»ï¼Œå®ƒå°±ä¼šåƒé™æ€ HTML é¡µé¢ä¸€æ ·å¿«é€Ÿåœ°å¤„ç†è¯·æ±‚ã€‚ä½ å¯ä»¥ä»[è¿™é‡Œ](https://github.com/new-fantastic/vsf-cache-varnish)å®‰è£…å®ƒ[ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/new-fantastic/vsf-cache-varnish).

### [#](https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#vue-storefront-proxy)Vue åº—é¢ä»£ç†

*Vue Storefront*å¯ä»¥ä½¿ç”¨[OpenResty](http://openresty.org/en/)è¿›è¡Œè®¾ç½®[ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](http://openresty.org/en/)åŸºäºåå‘ä»£ç†ä» Redis æä¾›ç¼“å­˜é¡µé¢ï¼Œæ— éœ€ Vue StoreFrontï¼ˆVSF æˆ– VSF APIï¼‰è°ƒç”¨ï¼Œä½¿ç”¨ LUAã€‚[è¿™é‡Œ ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰](https://github.com/ClickAndMortar/docker/tree/master/vue-storefront/proxy)æ˜¯ github ä»“åº“ã€‚

## [#](https://docs.vuestorefront.io/v1/guide/installation/production-setup.html#production-setup-using-docker-kubernetes)ç”Ÿäº§è®¾ç½® - ä½¿ç”¨ Docker / Kubernetes

åšå¥½å‡†å¤‡ã€‚